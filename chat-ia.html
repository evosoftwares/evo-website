<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat com IA - Evo</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css">

    <style>
        /* ================================
           CHAT IA - DESIGN SYSTEM
           ================================ */

        :root {
            /* Cores do site */
            --color-primary: #0055cc;
            --color-primary-dark: #408cf7;
            --color-secondary: #4892ec;
            --color-accent: #dae100;

            --color-text-dark: #1a1a1a;
            --color-text-medium: #333333;
            --color-text-light: #666666;
            --color-text-gray: #999999;

            --color-white: #ffffff;
            --color-bg-section: #f5f5f5;
            --color-bg-light: #ebf0f4;
            --color-border: #e5e7eb;

            /* Typography */
            --font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;

            /* Border Radius - Bastante roundness */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);

            /* Transitions */
            --transition-fast: 150ms ease-in-out;
            --transition-normal: 300ms ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, #f5f7fa 0%, #ebf0f4 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Container Principal */
        .chat-container {
            width: 100%;
            max-width: 900px;
            height: 90vh;
            max-height: 800px;
            background: var(--color-white);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header do Chat */
        .chat-header {
            background: var(--color-white);
            padding: 24px 28px 20px;
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid var(--color-border);
        }

        .chat-header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .chat-header-text h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-text-dark);
            margin-bottom: 4px;
        }

        .chat-header-text p {
            font-size: 14px;
            color: var(--color-text-light);
            font-weight: 400;
        }

        .chat-close {
            width: 36px;
            height: 36px;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--color-text-light);
            font-size: 24px;
            flex-shrink: 0;
        }

        .chat-close:hover {
            background: var(--color-bg-section);
            color: var(--color-text-dark);
        }

        /* Barra de Progresso */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--color-bg-section);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-primary);
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
            width: 33%;
        }

        .progress-text {
            font-size: 12px;
            color: var(--color-text-gray);
            text-align: center;
        }

        /* √Årea de Mensagens */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: var(--color-white);
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: var(--radius-full);
        }

        /* Mensagem da IA */
        .message-ai {
            display: flex;
            animation: slideInLeft 0.3s ease;
            margin-bottom: 4px;
        }

        .message-content {
            max-width: 80%;
        }

        .message-bubble {
            background: var(--color-bg-section);
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            color: var(--color-text-dark);
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        /* Mensagem do Usu√°rio */
        .message-user {
            display: flex;
            justify-content: flex-end;
            animation: slideInRight 0.3s ease;
            margin-bottom: 4px;
        }

        .message-user .message-content {
            max-width: 80%;
        }

        .message-user .message-bubble {
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: 0 2px 8px rgba(0, 85, 204, 0.15);
        }

        /* Box de Resumo */
        .summary-box {
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%);
            border: 2px solid var(--color-primary);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin: 20px 0;
            animation: slideInLeft 0.4s ease;
        }

        .summary-box h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text-dark);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-box h3::before {
            content: "‚úì";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
        }

        .summary-list {
            list-style: none;
            padding: 0;
            margin: 0 0 16px 0;
        }

        .summary-list li {
            font-size: 14px;
            color: var(--color-text-medium);
            padding: 6px 0;
            padding-left: 24px;
            position: relative;
        }

        .summary-list li::before {
            content: "‚Ä¢";
            position: absolute;
            left: 8px;
            color: var(--color-primary);
            font-weight: bold;
        }

        /* CTA Forte */
        .cta-button {
            background: var(--color-primary);
            color: var(--color-white);
            border: none;
            padding: 14px 24px;
            border-radius: var(--radius-lg);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            width: 100%;
            box-shadow: 0 4px 12px rgba(0, 85, 204, 0.2);
        }

        .cta-button:hover {
            background: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 85, 204, 0.3);
        }

        .cta-secondary {
            background: transparent;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
            margin-top: 8px;
            box-shadow: none;
        }

        .cta-secondary:hover {
            background: var(--color-primary);
            color: var(--color-white);
        }

        /* Sugest√µes de Resposta */
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .suggestion-chip {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            padding: 10px 16px;
            border-radius: var(--radius-lg);
            font-size: 14px;
            color: var(--color-text-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 400;
        }

        .suggestion-chip:hover {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        /* ================================
           NLU v3.0: Estilos de Desambigua√ß√£o
           ================================ */
        .disambiguation-message {
            animation: disambiguationPulse 0.5s ease-out;
        }

        @keyframes disambiguationPulse {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .disambiguation-bubble {
            background: linear-gradient(135deg, #fff8e1 0%, #fff3cd 100%) !important;
            border: 1px solid #ffc107 !important;
            position: relative;
        }

        .disambiguation-icon {
            margin-right: 8px;
            font-size: 18px;
        }

        .disambiguation-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            padding-top: 8px;
        }

        .disambiguation-chip {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 2px solid var(--color-primary);
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 14px;
            color: var(--color-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .disambiguation-chip:hover {
            background: var(--color-primary);
            color: var(--color-white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .disambiguation-chip.selected {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .disambiguation-chip.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .disambiguation-chip.disabled:hover {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            color: var(--color-primary);
        }

        .disambiguation-chip.selected.disabled {
            opacity: 1;
            background: var(--color-primary);
            color: var(--color-white);
        }

        /* ================================
           Groq AI Response Styles
           ================================ */
        .groq-response .message-bubble {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 3px solid #0ea5e9;
            position: relative;
        }

        .groq-response .message-bubble::before {
            content: '';
            position: absolute;
            top: 8px;
            left: -24px;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.4);
        }

        .groq-cached {
            position: absolute;
            top: 4px;
            right: 8px;
            font-size: 12px;
            opacity: 0.6;
        }

        /* Mensagem Inicial */
        .welcome-message {
            text-align: left;
            padding: 20px 0;
            color: var(--color-text-light);
        }

        .welcome-message h2 {
            font-size: 20px;
            color: var(--color-text-dark);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .welcome-message p {
            font-size: 15px;
            line-height: 1.6;
            color: var(--color-text-light);
        }

        /* √Årea de Input */
        .chat-input-area {
            padding: 20px 28px;
            background: var(--color-white);
            border-top: 1px solid var(--color-border);
            border-radius: 0 0 var(--radius-2xl) var(--radius-2xl);
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .quick-actions::-webkit-scrollbar {
            height: 4px;
        }

        .quick-actions::-webkit-scrollbar-track {
            background: transparent;
        }

        .quick-actions::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: var(--radius-full);
        }

        .quick-action-btn {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            padding: 10px 16px;
            border-radius: var(--radius-lg);
            font-size: 13px;
            color: var(--color-text-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
            font-weight: 400;
        }

        .quick-action-btn:hover {
            background: var(--color-bg-section);
            border-color: var(--color-text-light);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: var(--color-bg-section);
            border: 2px solid transparent;
            border-radius: var(--radius-xl);
            padding: 14px 20px;
            font-family: var(--font-family);
            font-size: 15px;
            color: var(--color-text-dark);
            resize: none;
            max-height: 120px;
            transition: all var(--transition-fast);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--color-primary);
            background: var(--color-white);
            box-shadow: 0 0 0 4px rgba(0, 85, 204, 0.1);
        }

        .chat-input::placeholder {
            color: var(--color-text-gray);
        }

        .send-button {
            width: 52px;
            height: 52px;
            background: var(--color-primary);
            border: none;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
            font-size: 20px;
            color: var(--color-white);
        }

        .send-button:hover {
            background: var(--color-primary-dark);
        }

        .send-button:active {
            transform: scale(0.98);
        }

        /* Anima√ß√µes */
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .typing-dots {
            background: var(--color-bg-section);
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            display: flex;
            gap: 6px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--color-text-gray);
            border-radius: var(--radius-full);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-8px);
                opacity: 1;
            }
        }

        /* Mensagem de Status */
        .status-message {
            text-align: center;
            padding: 12px;
            margin: 16px 0;
            background: var(--color-bg-section);
            border-radius: var(--radius-lg);
            font-size: 13px;
            color: var(--color-text-gray);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Escape Hatch - Falar com Humano */
        .human-chat-button {
            position: fixed;
            bottom: 24px;
            left: 24px;
            background: var(--color-white);
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
            padding: 12px 20px;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all var(--transition-fast);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .human-chat-button:hover {
            background: var(--color-primary);
            color: var(--color-white);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        /* Checkmark de confirma√ß√£o */
        .message-confirmed {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
            font-size: 12px;
            color: #10b981;
            animation: fadeIn 0.3s ease;
        }

        .message-confirmed::before {
            content: "‚úì";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: #10b981;
            color: white;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
        }

        /* Modal de retorno */
        .return-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .return-modal-content {
            background: var(--color-white);
            padding: 32px;
            border-radius: var(--radius-2xl);
            max-width: 400px;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .return-modal-content h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--color-text-dark);
        }

        .return-modal-content p {
            font-size: 15px;
            color: var(--color-text-light);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .return-modal-buttons {
            display: flex;
            gap: 12px;
        }

        /* ================================
           MELHORIAS - COMPARA√á√ÉO DE PACOTES
           ================================ */

        /* Modal de Compara√ß√£o */
        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            animation: fadeIn 0.3s ease;
            padding: 20px;
        }

        .comparison-content {
            background: var(--color-white);
            border-radius: var(--radius-2xl);
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .comparison-header {
            padding: 24px 28px;
            border-bottom: 2px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .comparison-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-text-dark);
        }

        .comparison-close {
            width: 36px;
            height: 36px;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 24px;
            color: var(--color-text-gray);
            transition: all var(--transition-fast);
        }

        .comparison-close:hover {
            background: var(--color-bg-section);
            color: var(--color-text-dark);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table thead {
            background: var(--color-bg-section);
            position: sticky;
            top: 76px;
            z-index: 5;
        }

        .comparison-table th {
            padding: 16px;
            text-align: left;
            font-weight: 700;
            font-size: 14px;
            border-bottom: 2px solid var(--color-border);
        }

        .comparison-table th:first-child {
            width: 40%;
        }

        .comparison-table th.package-col {
            text-align: center;
            width: 20%;
        }

        .comparison-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .comparison-table td:first-child {
            font-weight: 500;
            color: var(--color-text-dark);
        }

        .comparison-table td.feature-check {
            text-align: center;
            font-size: 20px;
        }

        .comparison-table .check-yes {
            color: #10b981;
        }

        .comparison-table .check-no {
            color: #d1d5db;
        }

        .comparison-table tr:hover {
            background: #f9fafb;
        }

        .comparison-footer {
            padding: 24px 28px;
            background: var(--color-bg-section);
            border-top: 2px solid var(--color-border);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
        }

        .package-select-btn {
            padding: 14px 20px;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
        }

        .package-select-btn.starter {
            background: var(--color-primary);
            color: white;
        }

        .package-select-btn.growth {
            background: #ff9500;
            color: white;
        }

        .package-select-btn.scale {
            background: #8b5cf6;
            color: white;
        }

        .package-select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .category-header {
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%);
            font-weight: 700;
            color: var(--color-primary);
        }

        .category-header td {
            padding: 16px;
            font-size: 15px;
        }

        /* Social Proof */
        .social-proof-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #10b981;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin: 20px 0;
            animation: slideInLeft 0.4s ease;
        }

        .social-proof-section h4 {
            font-size: 18px;
            font-weight: 700;
            color: #065f46;
            margin: 0 0 20px 0;
            text-align: center;
        }

        .testimonial-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            margin-bottom: 16px;
        }

        .testimonial-card:last-child {
            margin-bottom: 0;
        }

        .testimonial-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .testimonial-avatar {
            font-size: 40px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 50%;
        }

        .testimonial-info {
            flex: 1;
        }

        .testimonial-name {
            font-size: 15px;
            font-weight: 700;
            color: var(--color-text-dark);
            margin: 0 0 4px 0;
        }

        .testimonial-type {
            font-size: 12px;
            color: var(--color-text-gray);
            margin: 0 0 6px 0;
        }

        .testimonial-stars {
            font-size: 14px;
            color: #fbbf24;
        }

        .testimonial-result {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .testimonial-result p {
            font-size: 14px;
            font-weight: 700;
            color: #78350f;
            margin: 0;
        }

        .testimonial-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-text-body);
            margin: 0 0 16px 0;
            font-style: italic;
        }

        .testimonial-package {
            font-size: 12px;
            color: var(--color-primary);
            font-weight: 600;
            padding: 8px 12px;
            background: var(--color-bg-section);
            border-radius: 6px;
            display: inline-block;
        }

        .stats-badge {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            margin-top: 16px;
            border: 1px solid #d1fae5;
        }

        .stats-badge p {
            font-size: 13px;
            font-weight: 600;
            color: #065f46;
            margin: 0;
        }

        /* Pr√≥ximos Passos Timeline */
        .next-steps-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid var(--color-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin: 20px 0;
            animation: slideInLeft 0.4s ease;
        }

        .next-steps-section h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-primary);
            margin: 0 0 24px 0;
            text-align: center;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #0055cc, #4892ec);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            opacity: 0.6;
        }

        .timeline-item.active {
            opacity: 1;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-marker {
            position: absolute;
            left: -33px;
            width: 30px;
            height: 30px;
            background: white;
            border: 3px solid #0055cc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #0055cc;
            font-size: 14px;
        }

        .timeline-item.active .timeline-marker {
            background: #0055cc;
            color: white;
        }

        .timeline-content {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        }

        .timeline-content h4 {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text-dark);
            margin: 0 0 8px 0;
        }

        .timeline-time {
            font-size: 12px;
            color: var(--color-primary);
            font-weight: 600;
            margin: 0 0 8px 0;
            display: block;
        }

        .timeline-content p {
            font-size: 14px;
            color: var(--color-text-body);
            margin: 0 0 12px 0;
            line-height: 1.5;
        }

        .timeline-content ul {
            list-style: none;
            padding: 0;
            margin: 8px 0 0 0;
        }

        .timeline-content ul li {
            font-size: 13px;
            color: var(--color-text-body);
            padding: 4px 0;
            line-height: 1.4;
        }

        .timeline-cta {
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .cta-button-small {
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .cta-button-small:hover {
            background: #0044aa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 85, 204, 0.3);
        }

        .availability {
            font-size: 12px;
            color: #10b981;
            font-weight: 600;
        }

        .guarantee-badge {
            background: white;
            border: 2px solid #10b981;
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            margin-top: 20px;
        }

        .guarantee-badge strong {
            color: #10b981;
        }

        /* Op√ß√£o Adicionar Depois */
        .add-later-badge {
            font-size: 11px;
            color: #f59e0b;
            font-weight: 600;
            background: #fef3c7;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-left: 8px;
        }

        .flexibility-section {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
            border: 2px solid #f59e0b;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin: 20px 0;
            animation: slideInLeft 0.4s ease;
        }

        .flexibility-section h4 {
            font-size: 18px;
            font-weight: 700;
            color: #92400e;
            margin: 0 0 12px 0;
            text-align: center;
        }

        .flexibility-section > p {
            font-size: 14px;
            color: #78350f;
            text-align: center;
            margin: 0 0 20px 0;
        }

        .flexibility-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .flexibility-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        }

        .flexibility-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .flexibility-card h5 {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-text-dark);
            margin: 0 0 8px 0;
        }

        .flexibility-card p {
            font-size: 12px;
            color: var(--color-text-body);
            margin: 0;
            line-height: 1.4;
        }

        .flexibility-cta {
            text-align: center;
        }

        .cta-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .cta-secondary:hover {
            background: var(--color-bg-section);
            border-color: #0044aa;
            color: #0044aa;
        }

        .add-later-pricing {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            margin-top: 20px;
        }

        .add-later-pricing h5 {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-text-dark);
            margin: 0 0 12px 0;
        }

        .pricing-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .pricing-table th {
            background: var(--color-bg-section);
            padding: 8px;
            text-align: left;
            font-weight: 600;
            color: var(--color-text-dark);
            border-bottom: 2px solid var(--color-border);
        }

        .pricing-table td {
            padding: 8px;
            border-bottom: 1px solid var(--color-border);
            color: var(--color-text-body);
        }

        .pricing-note {
            font-size: 11px;
            color: #10b981;
            font-weight: 600;
            margin: 12px 0 0 0;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
            }

            .chat-header {
                border-radius: 0;
                padding: 20px;
            }

            .chat-messages {
                padding: 20px;
            }

            .chat-input-area {
                padding: 16px 20px;
                border-radius: 0;
            }

            .message-content {
                max-width: 85%;
            }

            .message-user .message-content {
                max-width: 85%;
            }

            .human-chat-button {
                bottom: 16px;
                left: 16px;
                padding: 10px 16px;
                font-size: 13px;
            }

            .comparison-content {
                max-height: 100vh;
                border-radius: 0;
            }

            .comparison-table {
                font-size: 12px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px;
            }

            .comparison-footer {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Bot√£o Escape Hatch -->
    <button class="human-chat-button" onclick="talkToHuman()">
        üí¨ Falar com consultor
    </button>

    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="chat-header-top">
                <div class="chat-header-text">
                    <h1>Assistente Evo</h1>
                    <p>Conte sua ideia e vamos criar juntos</p>
                </div>
                <button class="chat-close" onclick="window.location.href='index.html'">√ó</button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Etapa 1 de 3: Conte sua ideia</p>
        </div>

        <!-- Mensagens -->
        <div class="chat-messages" id="chatMessages">
            <!-- Mensagem de boas-vindas -->
            <div class="welcome-message">
                <h2>Ol√°! Vamos come√ßar?</h2>
                <p>Conte-me sobre sua ideia de aplicativo. Quanto mais detalhes, melhor poderei ajudar!</p>
            </div>

            <!-- Exemplo de mensagem da IA -->
            <div class="message-ai">
                <div class="message-content">
                    <div class="message-bubble">
                        Ol√°! Sou o assistente da Evo. Estou aqui para ajudar voc√™ a transformar sua ideia em realidade. Que tipo de aplicativo voc√™ est√° pensando em criar?
                    </div>
                    <div class="suggestions">
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üçï Delivery</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üõí E-commerce</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üìö Educa√ß√£o</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üíö Sa√∫de</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üíº Gest√£o</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üí™ Fitness</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üè† Imobili√°rio</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">‚úÇÔ∏è Servi√ßos</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üí∞ Finan√ßas</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üë• Social</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üöó Transporte</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üêæ Pets</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üé¨ Entretenimento</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">‚úàÔ∏è Viagens</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üíÑ Beleza</button>
                        <button class="suggestion-chip" onclick="selectSuggestion(this)">üéØ Outro</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- √Årea de Input -->
        <div class="chat-input-area">
            <!-- Input -->
            <div class="input-wrapper">
                <textarea
                    class="chat-input"
                    id="chatInput"
                    placeholder="Digite sua mensagem aqui..."
                    rows="1"
                    onkeypress="handleKeyPress(event)"
                ></textarea>
                <button class="send-button" onclick="sendMessage()">‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Keywords expandidas (1000+) -->
    <script src="keywords-nichos.js"></script>
    <script src="keywords-chat.js"></script>

    <!-- NLU Engine - Motor de Intelig√™ncia Artificial -->
    <script src="nlu-engine.js"></script>
    <script src="nlu-integration.js"></script>
    <script src="groq-integration.js"></script>

    <script>
        // Estado da conversa
        let conversationState = {
            stage: 1,
            messageCount: 0,
            userName: null,
            userInfo: {
                appType: null,
                appTypeKey: null, // delivery, ecommerce, educacao, saude, gestao, fitness, imobiliario, servicos, financas, social, transporte, pets, entretenimento, viagens, beleza
                detectedNiche: null, // nicho espec√≠fico detectado (ex: barbearia, pizzaria, etc)
                nicheSubcategory: null, // subcategoria do nicho
                features: [],
                selectedFeatures: [],
                functionPoints: 0,
                packageType: null,
                budget: null,
                timeline: null,
                objective: null, // validar, crescer, dominar
                differentials: [],
                businessContext: null // contexto do neg√≥cio
            },
            messages: [],
            // Sistema inteligente para "Outro tipo de app"
            outroTipoAttempts: 0,
            waitingForOutroTipoDescription: false,
            lastSuggestedCategory: null,
            // Fluxo consultivo expandido
            conversationStep: 'app_type' // app_type ‚Üí niche_detail ‚Üí objective ‚Üí timeline ‚Üí differentials ‚Üí budget ‚Üí packages
        };

        // ================================
        // SISTEMA DE PONTOS DE FUN√á√ÉO
        // ================================

        // Tabela de features e pontos de fun√ß√£o por tipo de app
        const featuresCatalog = {
            delivery: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Autentica√ß√£o de usu√°rios' },
                    { id: 'menu', name: 'Card√°pio/Cat√°logo digital', points: 13, description: 'Exibi√ß√£o de produtos' },
                    { id: 'cart', name: 'Carrinho de compras', points: 10, description: 'Adicionar/remover itens' },
                    { id: 'checkout', name: 'Finaliza√ß√£o de pedido', points: 15, description: 'Checkout e pagamento' },
                    { id: 'tracking', name: 'Rastreamento em tempo real', points: 21, description: 'Acompanhar pedido no mapa' },
                    { id: 'notifications', name: 'Notifica√ß√µes push', points: 8, description: 'Alertas de pedido' }
                ],
                intermediate: [
                    { id: 'multi_payment', name: 'M√∫ltiplas formas de pagamento', points: 13, description: 'PIX, cart√£o, dinheiro' },
                    { id: 'ratings', name: 'Avalia√ß√µes e coment√°rios', points: 10, description: 'Review de pedidos' },
                    { id: 'chat', name: 'Chat cliente-entregador', points: 13, description: 'Comunica√ß√£o em tempo real' },
                    { id: 'schedule', name: 'Agendamento de pedido', points: 10, description: 'Pedir para depois' },
                    { id: 'promo', name: 'Sistema de cupons/promo√ß√µes', points: 13, description: 'Descontos e ofertas' },
                    { id: 'history', name: 'Hist√≥rico de pedidos', points: 8, description: 'Ver pedidos anteriores' }
                ],
                advanced: [
                    { id: 'loyalty', name: 'Programa de fidelidade', points: 13, description: 'Pontos e recompensas' },
                    { id: 'ai_recommendations', name: 'Recomenda√ß√µes por IA', points: 21, description: 'Sugest√µes personalizadas' },
                    { id: 'multi_restaurant', name: 'Multi-restaurantes', points: 21, description: 'Marketplace completo' },
                    { id: 'driver_app', name: 'App do entregador separado', points: 34, description: 'Sistema completo de delivery' },
                    { id: 'admin_panel', name: 'Painel administrativo', points: 21, description: 'Dashboard de gest√£o' },
                    { id: 'analytics', name: 'Analytics avan√ßado', points: 13, description: 'Relat√≥rios e m√©tricas' }
                ]
            },
            ecommerce: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Autentica√ß√£o de usu√°rios' },
                    { id: 'catalog', name: 'Cat√°logo de produtos', points: 13, description: 'Listagem com filtros' },
                    { id: 'product_detail', name: 'Detalhes do produto', points: 8, description: 'Fotos, descri√ß√£o, pre√ßo' },
                    { id: 'cart', name: 'Carrinho de compras', points: 10, description: 'Gerenciar itens' },
                    { id: 'checkout', name: 'Checkout', points: 15, description: 'Finaliza√ß√£o de compra' },
                    { id: 'orders', name: 'Gest√£o de pedidos', points: 13, description: 'Acompanhar status' }
                ],
                intermediate: [
                    { id: 'search', name: 'Busca avan√ßada', points: 10, description: 'Filtros e ordena√ß√£o' },
                    { id: 'wishlist', name: 'Lista de desejos', points: 8, description: 'Favoritar produtos' },
                    { id: 'reviews', name: 'Reviews de produtos', points: 10, description: 'Avalia√ß√µes de clientes' },
                    { id: 'shipping', name: 'C√°lculo de frete', points: 13, description: 'Integra√ß√£o Correios' },
                    { id: 'coupons', name: 'Cupons de desconto', points: 10, description: 'Sistema de promo√ß√µes' },
                    { id: 'variations', name: 'Varia√ß√µes de produto', points: 13, description: 'Cores, tamanhos, etc' }
                ],
                advanced: [
                    { id: 'marketplace', name: 'Marketplace multi-vendedor', points: 34, description: 'V√°rios sellers' },
                    { id: 'inventory', name: 'Controle de estoque', points: 13, description: 'Gest√£o de invent√°rio' },
                    { id: 'crm', name: 'CRM integrado', points: 21, description: 'Gest√£o de clientes' },
                    { id: 'recommendations', name: 'Recomenda√ß√µes IA', points: 21, description: 'Produtos sugeridos' },
                    { id: 'admin', name: 'Painel administrativo', points: 21, description: 'Dashboard completo' },
                    { id: 'erp_integration', name: 'Integra√ß√£o com ERP', points: 21, description: 'Sincroniza√ß√£o de dados' }
                ]
            },
            educacao: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Alunos e professores' },
                    { id: 'courses', name: 'Biblioteca de cursos', points: 13, description: 'Cat√°logo de cursos' },
                    { id: 'video_player', name: 'Player de v√≠deo', points: 13, description: 'Assistir aulas' },
                    { id: 'progress', name: 'Progresso do aluno', points: 10, description: 'Acompanhar evolu√ß√£o' },
                    { id: 'certificates', name: 'Certificados', points: 8, description: 'Emiss√£o autom√°tica' },
                    { id: 'enrollment', name: 'Sistema de matr√≠cula', points: 13, description: 'Inscri√ß√£o em cursos' }
                ],
                intermediate: [
                    { id: 'live_classes', name: 'Aulas ao vivo', points: 21, description: 'Streaming de v√≠deo' },
                    { id: 'quiz', name: 'Quizzes e avalia√ß√µes', points: 13, description: 'Testes e provas' },
                    { id: 'forum', name: 'F√≥rum de discuss√£o', points: 13, description: 'Comunidade de alunos' },
                    { id: 'assignments', name: 'Tarefas e entregas', points: 13, description: 'Envio de trabalhos' },
                    { id: 'schedule', name: 'Calend√°rio de aulas', points: 10, description: 'Agenda de eventos' },
                    { id: 'chat', name: 'Chat professor-aluno', points: 13, description: 'Comunica√ß√£o direta' }
                ],
                advanced: [
                    { id: 'ai_tutor', name: 'Tutor IA', points: 34, description: 'Assistente virtual' },
                    { id: 'analytics', name: 'Analytics de aprendizado', points: 21, description: 'M√©tricas de performance' },
                    { id: 'marketplace', name: 'Marketplace de cursos', points: 21, description: 'M√∫ltiplos instrutores' },
                    { id: 'gamification', name: 'Gamifica√ß√£o', points: 21, description: 'Pontos, badges, ranking' },
                    { id: 'mobile_offline', name: 'Modo offline', points: 13, description: 'Download de aulas' },
                    { id: 'integration', name: 'Integra√ß√£o LMS', points: 21, description: 'Moodle, Canvas, etc' }
                ]
            },
            saude: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Pacientes e profissionais' },
                    { id: 'scheduling', name: 'Agendamento de consultas', points: 13, description: 'Marcar hor√°rios' },
                    { id: 'calendar', name: 'Calend√°rio m√©dico', points: 10, description: 'Disponibilidade' },
                    { id: 'medical_records', name: 'Prontu√°rio eletr√¥nico', points: 21, description: 'Hist√≥rico m√©dico' },
                    { id: 'prescriptions', name: 'Prescri√ß√µes digitais', points: 13, description: 'Receitas m√©dicas' },
                    { id: 'notifications', name: 'Lembretes de consulta', points: 8, description: 'Notifica√ß√µes' }
                ],
                intermediate: [
                    { id: 'telemedicine', name: 'Telemedicina', points: 21, description: 'Consultas por v√≠deo' },
                    { id: 'payments', name: 'Pagamentos online', points: 13, description: 'Cobran√ßas integradas' },
                    { id: 'exams', name: 'Gest√£o de exames', points: 13, description: 'Upload de resultados' },
                    { id: 'chat', name: 'Chat m√©dico-paciente', points: 13, description: 'Comunica√ß√£o segura' },
                    { id: 'ratings', name: 'Avalia√ß√µes', points: 8, description: 'Review de profissionais' },
                    { id: 'health_tracking', name: 'Acompanhamento de sa√∫de', points: 13, description: 'Monitorar sinais vitais' }
                ],
                advanced: [
                    { id: 'ai_diagnosis', name: 'IA para diagn√≥stico', points: 34, description: 'Sugest√µes inteligentes' },
                    { id: 'integration', name: 'Integra√ß√£o com hospitais', points: 21, description: 'Sistemas externos' },
                    { id: 'iot', name: 'Integra√ß√£o IoT', points: 21, description: 'Wearables e sensores' },
                    { id: 'analytics', name: 'Analytics de sa√∫de', points: 21, description: 'Dashboards m√©dicos' },
                    { id: 'multi_clinic', name: 'Multi-cl√≠nicas', points: 21, description: 'Rede de atendimento' },
                    { id: 'lgpd_compliance', name: 'Conformidade LGPD/HIPAA', points: 13, description: 'Seguran√ßa m√°xima' }
                ]
            },
            gestao: {
                essential: [
                    { id: 'auth', name: 'Login e controle de acesso', points: 8, description: 'Usu√°rios e permiss√µes' },
                    { id: 'dashboard', name: 'Dashboard principal', points: 13, description: 'Vis√£o geral do neg√≥cio' },
                    { id: 'financial', name: 'Controle financeiro', points: 21, description: 'Receitas e despesas' },
                    { id: 'reports', name: 'Relat√≥rios b√°sicos', points: 13, description: 'Exporta√ß√£o de dados' },
                    { id: 'clients', name: 'Cadastro de clientes', points: 10, description: 'CRM b√°sico' },
                    { id: 'products', name: 'Cadastro de produtos/servi√ßos', points: 10, description: 'Invent√°rio' }
                ],
                intermediate: [
                    { id: 'invoicing', name: 'Emiss√£o de NF-e', points: 21, description: 'Notas fiscais' },
                    { id: 'inventory', name: 'Gest√£o de estoque', points: 13, description: 'Controle de invent√°rio' },
                    { id: 'sales', name: 'Funil de vendas', points: 13, description: 'Pipeline CRM' },
                    { id: 'employees', name: 'Gest√£o de funcion√°rios', points: 13, description: 'RH b√°sico' },
                    { id: 'projects', name: 'Gest√£o de projetos', points: 13, description: 'Tarefas e prazos' },
                    { id: 'integrations', name: 'Integra√ß√µes banc√°rias', points: 13, description: 'API banc√°ria' }
                ],
                advanced: [
                    { id: 'erp_complete', name: 'ERP completo', points: 34, description: 'Sistema integrado' },
                    { id: 'bi', name: 'Business Intelligence', points: 21, description: 'Analytics avan√ßado' },
                    { id: 'automation', name: 'Automa√ß√µes', points: 21, description: 'Workflows autom√°ticos' },
                    { id: 'multi_company', name: 'Multi-empresas', points: 21, description: 'Gest√£o de filiais' },
                    { id: 'api', name: 'API para integra√ß√µes', points: 13, description: 'Conectar sistemas' },
                    { id: 'mobile', name: 'App mobile nativo', points: 21, description: 'iOS e Android' }
                ]
            },
            fitness: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Alunos e personal trainers' },
                    { id: 'workouts', name: 'Biblioteca de treinos', points: 13, description: 'Exerc√≠cios por categoria' },
                    { id: 'workout_tracking', name: 'Registro de treino', points: 13, description: 'Acompanhar s√©ries e repeti√ß√µes' },
                    { id: 'progress', name: 'Progresso f√≠sico', points: 10, description: 'Medidas e fotos de evolu√ß√£o' },
                    { id: 'calendar', name: 'Agenda de treinos', points: 10, description: 'Planejamento semanal' },
                    { id: 'notifications', name: 'Lembretes de treino', points: 8, description: 'Notifica√ß√µes motivacionais' }
                ],
                intermediate: [
                    { id: 'video_exercises', name: 'V√≠deos de exerc√≠cios', points: 13, description: 'Demonstra√ß√£o de movimentos' },
                    { id: 'nutrition', name: 'Di√°rio alimentar', points: 13, description: 'Controle de calorias' },
                    { id: 'personal_trainer', name: 'Conex√£o com personal', points: 13, description: 'Chat com treinador' },
                    { id: 'challenges', name: 'Desafios fitness', points: 10, description: 'Competi√ß√µes motivacionais' },
                    { id: 'classes', name: 'Aulas em grupo', points: 13, description: 'Agendamento de aulas' },
                    { id: 'payments', name: 'Pagamentos e planos', points: 13, description: 'Assinaturas recorrentes' }
                ],
                advanced: [
                    { id: 'ai_trainer', name: 'Personal trainer IA', points: 34, description: 'Treinos personalizados por IA' },
                    { id: 'wearables', name: 'Integra√ß√£o wearables', points: 21, description: 'Apple Watch, Garmin, etc' },
                    { id: 'live_classes', name: 'Aulas ao vivo', points: 21, description: 'Streaming de treinos' },
                    { id: 'gamification', name: 'Gamifica√ß√£o', points: 13, description: 'Pontos e conquistas' },
                    { id: 'community', name: 'Comunidade social', points: 13, description: 'Feed e intera√ß√£o' },
                    { id: 'analytics', name: 'Analytics de performance', points: 21, description: 'M√©tricas avan√ßadas' }
                ]
            },
            imobiliario: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Corretores e clientes' },
                    { id: 'listings', name: 'Listagem de im√≥veis', points: 13, description: 'Cat√°logo com filtros' },
                    { id: 'property_detail', name: 'Detalhes do im√≥vel', points: 10, description: 'Fotos, descri√ß√£o, pre√ßo' },
                    { id: 'search', name: 'Busca avan√ßada', points: 13, description: 'Por regi√£o, pre√ßo, tipo' },
                    { id: 'contact', name: 'Contato com corretor', points: 8, description: 'Formul√°rio de interesse' },
                    { id: 'favorites', name: 'Im√≥veis favoritos', points: 8, description: 'Salvar para depois' }
                ],
                intermediate: [
                    { id: 'virtual_tour', name: 'Tour virtual 360¬∞', points: 21, description: 'Visita online' },
                    { id: 'scheduling', name: 'Agendamento de visitas', points: 13, description: 'Marcar visitas presenciais' },
                    { id: 'chat', name: 'Chat corretor-cliente', points: 13, description: 'Comunica√ß√£o em tempo real' },
                    { id: 'financing', name: 'Simulador de financiamento', points: 13, description: 'C√°lculo de parcelas' },
                    { id: 'alerts', name: 'Alertas de novos im√≥veis', points: 10, description: 'Notifica√ß√µes personalizadas' },
                    { id: 'comparison', name: 'Comparador de im√≥veis', points: 10, description: 'Comparar propriedades' }
                ],
                advanced: [
                    { id: 'crm', name: 'CRM imobili√°rio', points: 21, description: 'Gest√£o de leads e clientes' },
                    { id: 'ai_recommendations', name: 'Recomenda√ß√µes por IA', points: 21, description: 'Im√≥veis sugeridos' },
                    { id: 'contracts', name: 'Gest√£o de contratos', points: 21, description: 'Documenta√ß√£o digital' },
                    { id: 'analytics', name: 'Analytics de mercado', points: 21, description: 'Tend√™ncias e pre√ßos' },
                    { id: 'multi_agency', name: 'Multi-imobili√°rias', points: 21, description: 'Marketplace imobili√°rio' },
                    { id: 'admin', name: 'Painel administrativo', points: 13, description: 'Dashboard de gest√£o' }
                ]
            },
            servicos: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Clientes e profissionais' },
                    { id: 'services', name: 'Cat√°logo de servi√ßos', points: 10, description: 'Lista de servi√ßos oferecidos' },
                    { id: 'scheduling', name: 'Agendamento online', points: 13, description: 'Marcar hor√°rios' },
                    { id: 'calendar', name: 'Calend√°rio de disponibilidade', points: 10, description: 'Hor√°rios livres' },
                    { id: 'reminders', name: 'Lembretes autom√°ticos', points: 8, description: 'Notifica√ß√µes de agendamento' },
                    { id: 'profile', name: 'Perfil do profissional', points: 8, description: 'Portf√≥lio e especialidades' }
                ],
                intermediate: [
                    { id: 'payments', name: 'Pagamentos online', points: 13, description: 'PIX, cart√£o, etc' },
                    { id: 'reviews', name: 'Avalia√ß√µes', points: 10, description: 'Review de clientes' },
                    { id: 'chat', name: 'Chat cliente-profissional', points: 13, description: 'Comunica√ß√£o direta' },
                    { id: 'loyalty', name: 'Programa de fidelidade', points: 13, description: 'Pontos e descontos' },
                    { id: 'packages', name: 'Pacotes de servi√ßos', points: 10, description: 'Combos e assinaturas' },
                    { id: 'history', name: 'Hist√≥rico de atendimentos', points: 8, description: 'Registro de servi√ßos' }
                ],
                advanced: [
                    { id: 'multi_location', name: 'Multi-unidades', points: 21, description: 'V√°rias filiais' },
                    { id: 'team_management', name: 'Gest√£o de equipe', points: 13, description: 'Funcion√°rios e comiss√µes' },
                    { id: 'inventory', name: 'Controle de estoque', points: 13, description: 'Produtos e insumos' },
                    { id: 'crm', name: 'CRM de clientes', points: 21, description: 'Hist√≥rico e prefer√™ncias' },
                    { id: 'analytics', name: 'Analytics de neg√≥cio', points: 21, description: 'Relat√≥rios e m√©tricas' },
                    { id: 'admin', name: 'Painel administrativo', points: 13, description: 'Dashboard completo' }
                ]
            },
            financas: {
                essential: [
                    { id: 'auth', name: 'Login seguro', points: 10, description: 'Autentica√ß√£o 2FA' },
                    { id: 'accounts', name: 'Contas e carteiras', points: 13, description: 'Gest√£o de contas' },
                    { id: 'transactions', name: 'Registro de transa√ß√µes', points: 13, description: 'Receitas e despesas' },
                    { id: 'categories', name: 'Categoriza√ß√£o autom√°tica', points: 10, description: 'Organizar gastos' },
                    { id: 'budget', name: 'Or√ßamento mensal', points: 13, description: 'Planejamento financeiro' },
                    { id: 'reports', name: 'Relat√≥rios b√°sicos', points: 10, description: 'Vis√£o geral das finan√ßas' }
                ],
                intermediate: [
                    { id: 'bank_sync', name: 'Sincroniza√ß√£o banc√°ria', points: 21, description: 'Importar transa√ß√µes' },
                    { id: 'goals', name: 'Metas financeiras', points: 13, description: 'Objetivos de economia' },
                    { id: 'bills', name: 'Gest√£o de contas a pagar', points: 13, description: 'Lembretes de vencimento' },
                    { id: 'investments', name: 'Acompanhamento de investimentos', points: 13, description: 'Carteira de ativos' },
                    { id: 'alerts', name: 'Alertas de gastos', points: 10, description: 'Notifica√ß√µes de limite' },
                    { id: 'export', name: 'Exporta√ß√£o de dados', points: 8, description: 'PDF, Excel, etc' }
                ],
                advanced: [
                    { id: 'ai_insights', name: 'Insights por IA', points: 34, description: 'Recomenda√ß√µes financeiras' },
                    { id: 'invoicing', name: 'Emiss√£o de boletos/NF', points: 21, description: 'Cobran√ßas automatizadas' },
                    { id: 'multi_currency', name: 'Multi-moedas', points: 13, description: 'C√¢mbio e cripto' },
                    { id: 'analytics', name: 'Analytics avan√ßado', points: 21, description: 'Dashboards financeiros' },
                    { id: 'pix_integration', name: 'Integra√ß√£o PIX', points: 21, description: 'Pagamentos instant√¢neos' },
                    { id: 'security', name: 'Seguran√ßa avan√ßada', points: 13, description: 'Criptografia e audit trail' }
                ]
            },
            social: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Cria√ß√£o de perfil' },
                    { id: 'profiles', name: 'Perfis de usu√°rio', points: 10, description: 'Foto, bio, informa√ß√µes' },
                    { id: 'feed', name: 'Feed de publica√ß√µes', points: 13, description: 'Timeline de posts' },
                    { id: 'posts', name: 'Criar publica√ß√µes', points: 10, description: 'Texto, fotos, v√≠deos' },
                    { id: 'likes', name: 'Curtidas e rea√ß√µes', points: 8, description: 'Intera√ß√£o com posts' },
                    { id: 'comments', name: 'Coment√°rios', points: 10, description: 'Discuss√µes em posts' }
                ],
                intermediate: [
                    { id: 'followers', name: 'Sistema de seguidores', points: 13, description: 'Seguir usu√°rios' },
                    { id: 'messaging', name: 'Mensagens privadas', points: 13, description: 'Chat direto' },
                    { id: 'groups', name: 'Grupos e comunidades', points: 13, description: 'Criar e participar' },
                    { id: 'notifications', name: 'Notifica√ß√µes', points: 10, description: 'Alertas de intera√ß√£o' },
                    { id: 'search', name: 'Busca de usu√°rios', points: 10, description: 'Encontrar pessoas' },
                    { id: 'hashtags', name: 'Hashtags e trending', points: 10, description: 'Descobrir conte√∫do' }
                ],
                advanced: [
                    { id: 'stories', name: 'Stories/Status', points: 21, description: 'Conte√∫do tempor√°rio' },
                    { id: 'live', name: 'Lives e streaming', points: 21, description: 'Transmiss√µes ao vivo' },
                    { id: 'ai_moderation', name: 'Modera√ß√£o por IA', points: 21, description: 'Filtro de conte√∫do' },
                    { id: 'analytics', name: 'Analytics de engajamento', points: 13, description: 'M√©tricas de alcance' },
                    { id: 'monetization', name: 'Monetiza√ß√£o', points: 21, description: 'Assinaturas e gorjetas' },
                    { id: 'recommendations', name: 'Recomenda√ß√µes IA', points: 21, description: 'Conte√∫do sugerido' }
                ]
            },
            transporte: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Passageiros e motoristas' },
                    { id: 'booking', name: 'Solicitar corrida', points: 13, description: 'Pedir transporte' },
                    { id: 'tracking', name: 'Rastreamento em tempo real', points: 21, description: 'Ver motorista no mapa' },
                    { id: 'pricing', name: 'C√°lculo de pre√ßo', points: 13, description: 'Estimativa de tarifa' },
                    { id: 'payment', name: 'Pagamento integrado', points: 13, description: 'PIX, cart√£o, dinheiro' },
                    { id: 'ratings', name: 'Avalia√ß√µes', points: 8, description: 'Notas de motoristas' }
                ],
                intermediate: [
                    { id: 'driver_app', name: 'App do motorista', points: 21, description: 'Aceitar corridas' },
                    { id: 'history', name: 'Hist√≥rico de corridas', points: 8, description: 'Viagens anteriores' },
                    { id: 'favorites', name: 'Endere√ßos favoritos', points: 8, description: 'Casa, trabalho, etc' },
                    { id: 'schedule', name: 'Agendamento de corridas', points: 13, description: 'Reservar para depois' },
                    { id: 'chat', name: 'Chat passageiro-motorista', points: 13, description: 'Comunica√ß√£o direta' },
                    { id: 'promotions', name: 'Cupons e promo√ß√µes', points: 10, description: 'Descontos' }
                ],
                advanced: [
                    { id: 'carpool', name: 'Carona compartilhada', points: 21, description: 'Dividir corridas' },
                    { id: 'fleet', name: 'Gest√£o de frota', points: 21, description: 'Empresas e frotas' },
                    { id: 'ai_routing', name: 'Rotas otimizadas por IA', points: 21, description: 'Melhor caminho' },
                    { id: 'analytics', name: 'Analytics de opera√ß√£o', points: 21, description: 'M√©tricas de neg√≥cio' },
                    { id: 'surge', name: 'Pre√ßo din√¢mico', points: 13, description: 'Ajuste por demanda' },
                    { id: 'admin', name: 'Painel administrativo', points: 13, description: 'Dashboard de gest√£o' }
                ]
            },
            pets: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Donos e pet shops' },
                    { id: 'catalog', name: 'Cat√°logo de produtos', points: 13, description: 'Ra√ß√£o, acess√≥rios, etc' },
                    { id: 'cart', name: 'Carrinho de compras', points: 10, description: 'Adicionar produtos' },
                    { id: 'checkout', name: 'Checkout', points: 15, description: 'Finaliza√ß√£o de compra' },
                    { id: 'pet_profile', name: 'Perfil do pet', points: 10, description: 'Dados do animal' },
                    { id: 'orders', name: 'Hist√≥rico de pedidos', points: 8, description: 'Pedidos anteriores' }
                ],
                intermediate: [
                    { id: 'scheduling', name: 'Agendamento banho/tosa', points: 13, description: 'Marcar servi√ßos' },
                    { id: 'veterinary', name: 'Consultas veterin√°rias', points: 13, description: 'Agendar consultas' },
                    { id: 'vaccines', name: 'Carteira de vacina√ß√£o', points: 10, description: 'Controle de vacinas' },
                    { id: 'delivery', name: 'Delivery de produtos', points: 13, description: 'Entrega em casa' },
                    { id: 'reminders', name: 'Lembretes autom√°ticos', points: 8, description: 'Vacinas, banho, etc' },
                    { id: 'reviews', name: 'Avalia√ß√µes', points: 8, description: 'Reviews de produtos' }
                ],
                advanced: [
                    { id: 'telemedicine', name: 'Telemedicina veterin√°ria', points: 21, description: 'Consultas online' },
                    { id: 'subscription', name: 'Assinaturas/Clube', points: 13, description: 'Entrega recorrente' },
                    { id: 'marketplace', name: 'Marketplace multi-lojas', points: 21, description: 'V√°rios pet shops' },
                    { id: 'ai_recommendations', name: 'Recomenda√ß√µes IA', points: 21, description: 'Produtos sugeridos' },
                    { id: 'analytics', name: 'Analytics', points: 13, description: 'M√©tricas de vendas' },
                    { id: 'admin', name: 'Painel administrativo', points: 13, description: 'Dashboard completo' }
                ]
            },
            entretenimento: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Usu√°rios e assinantes' },
                    { id: 'catalog', name: 'Cat√°logo de conte√∫do', points: 13, description: 'Filmes, s√©ries, m√∫sicas' },
                    { id: 'player', name: 'Player de m√≠dia', points: 21, description: 'Reprodu√ß√£o de v√≠deo/√°udio' },
                    { id: 'search', name: 'Busca e filtros', points: 10, description: 'Encontrar conte√∫do' },
                    { id: 'favorites', name: 'Lista de favoritos', points: 8, description: 'Salvar conte√∫do' },
                    { id: 'history', name: 'Hist√≥rico', points: 8, description: 'Continuar assistindo' }
                ],
                intermediate: [
                    { id: 'subscription', name: 'Sistema de assinatura', points: 13, description: 'Planos e pagamentos' },
                    { id: 'download', name: 'Download offline', points: 13, description: 'Assistir sem internet' },
                    { id: 'profiles', name: 'M√∫ltiplos perfis', points: 10, description: 'Perfis por usu√°rio' },
                    { id: 'recommendations', name: 'Recomenda√ß√µes', points: 13, description: 'Conte√∫do sugerido' },
                    { id: 'ratings', name: 'Avalia√ß√µes', points: 8, description: 'Notas e reviews' },
                    { id: 'notifications', name: 'Notifica√ß√µes', points: 8, description: 'Novos lan√ßamentos' }
                ],
                advanced: [
                    { id: 'live_streaming', name: 'Live streaming', points: 34, description: 'Transmiss√µes ao vivo' },
                    { id: 'ai_recommendations', name: 'IA para recomenda√ß√µes', points: 21, description: 'Algoritmo personalizado' },
                    { id: 'social', name: 'Recursos sociais', points: 13, description: 'Coment√°rios, compartilhar' },
                    { id: 'analytics', name: 'Analytics de consumo', points: 21, description: 'M√©tricas de audi√™ncia' },
                    { id: 'drm', name: 'Prote√ß√£o de conte√∫do', points: 21, description: 'DRM e seguran√ßa' },
                    { id: 'admin', name: 'CMS completo', points: 21, description: 'Gest√£o de conte√∫do' }
                ]
            },
            viagens: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Viajantes e ag√™ncias' },
                    { id: 'search', name: 'Busca de destinos', points: 13, description: 'Hot√©is, voos, pacotes' },
                    { id: 'listings', name: 'Listagem de ofertas', points: 13, description: 'Resultados de busca' },
                    { id: 'booking', name: 'Sistema de reservas', points: 15, description: 'Fazer reservas' },
                    { id: 'payment', name: 'Pagamento integrado', points: 13, description: 'PIX, cart√£o, etc' },
                    { id: 'confirmation', name: 'Confirma√ß√£o e voucher', points: 8, description: 'E-tickets e vouchers' }
                ],
                intermediate: [
                    { id: 'comparison', name: 'Comparador de pre√ßos', points: 13, description: 'Melhores ofertas' },
                    { id: 'reviews', name: 'Avalia√ß√µes', points: 10, description: 'Reviews de destinos' },
                    { id: 'itinerary', name: 'Roteiro de viagem', points: 13, description: 'Planejar viagem' },
                    { id: 'alerts', name: 'Alertas de pre√ßo', points: 10, description: 'Notifica√ß√µes de promo√ß√£o' },
                    { id: 'maps', name: 'Mapas integrados', points: 10, description: 'Localiza√ß√£o e rotas' },
                    { id: 'offline', name: 'Modo offline', points: 10, description: 'Acesso sem internet' }
                ],
                advanced: [
                    { id: 'ai_recommendations', name: 'Recomenda√ß√µes IA', points: 21, description: 'Destinos sugeridos' },
                    { id: 'marketplace', name: 'Marketplace de ag√™ncias', points: 21, description: 'Multi-operadoras' },
                    { id: 'loyalty', name: 'Programa de fidelidade', points: 13, description: 'Pontos e milhas' },
                    { id: 'concierge', name: 'Concierge virtual', points: 21, description: 'Assistente de viagem' },
                    { id: 'analytics', name: 'Analytics', points: 13, description: 'M√©tricas de vendas' },
                    { id: 'admin', name: 'Painel administrativo', points: 13, description: 'Dashboard completo' }
                ]
            },
            beleza: {
                essential: [
                    { id: 'auth', name: 'Login e cadastro', points: 8, description: 'Clientes e profissionais' },
                    { id: 'services', name: 'Cat√°logo de servi√ßos', points: 10, description: 'Tratamentos dispon√≠veis' },
                    { id: 'scheduling', name: 'Agendamento online', points: 13, description: 'Marcar hor√°rios' },
                    { id: 'calendar', name: 'Calend√°rio', points: 10, description: 'Disponibilidade' },
                    { id: 'reminders', name: 'Lembretes', points: 8, description: 'Notifica√ß√µes de agendamento' },
                    { id: 'profile', name: 'Perfil do profissional', points: 8, description: 'Portf√≥lio e especialidades' }
                ],
                intermediate: [
                    { id: 'payments', name: 'Pagamentos online', points: 13, description: 'PIX, cart√£o, etc' },
                    { id: 'reviews', name: 'Avalia√ß√µes', points: 10, description: 'Reviews de clientes' },
                    { id: 'gallery', name: 'Galeria de trabalhos', points: 10, description: 'Antes e depois' },
                    { id: 'loyalty', name: 'Programa de fidelidade', points: 13, description: 'Pontos e descontos' },
                    { id: 'products', name: 'Venda de produtos', points: 13, description: 'E-commerce integrado' },
                    { id: 'chat', name: 'Chat', points: 10, description: 'Comunica√ß√£o direta' }
                ],
                advanced: [
                    { id: 'multi_location', name: 'Multi-unidades', points: 21, description: 'Rede de sal√µes' },
                    { id: 'team_management', name: 'Gest√£o de equipe', points: 13, description: 'Funcion√°rios e comiss√µes' },
                    { id: 'ai_beauty', name: 'IA para beleza', points: 21, description: 'Simulador de visual' },
                    { id: 'crm', name: 'CRM de clientes', points: 21, description: 'Hist√≥rico e prefer√™ncias' },
                    { id: 'analytics', name: 'Analytics', points: 13, description: 'Relat√≥rios e m√©tricas' },
                    { id: 'admin', name: 'Painel administrativo', points: 13, description: 'Dashboard completo' }
                ]
            }
        };

        // Calcular pre√ßo baseado em pontos de fun√ß√£o
        function calculatePrice(functionPoints) {
            const pricePerPoint = 175; // R$ 175 por ponto de fun√ß√£o
            const basePrice = functionPoints * pricePerPoint;

            // Aplicar descontos por volume
            let discount = 0;
            if (functionPoints >= 100) {
                discount = 0.15; // 15% desconto para projetos grandes
            } else if (functionPoints >= 50) {
                discount = 0.10; // 10% desconto para projetos m√©dios
            }

            const finalPrice = basePrice * (1 - discount);
            return {
                basePrice,
                discount,
                finalPrice,
                pricePerPoint
            };
        }

        // Formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Verificar conversa salva ao carregar
        window.addEventListener('DOMContentLoaded', function() {
            const savedConversation = localStorage.getItem('evoChat');
            if (savedConversation) {
                showReturnModal();
            } else {
                askUserName();
            }
        });

        // Auto-resize textarea
        const chatInput = document.getElementById('chatInput');
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Salvar conversa no localStorage
        function saveConversation() {
            localStorage.setItem('evoChat', JSON.stringify(conversationState));
        }

        // Restaurar conversa
        function restoreConversation() {
            const saved = localStorage.getItem('evoChat');
            if (saved) {
                conversationState = JSON.parse(saved);
                // Recriar mensagens na tela
                conversationState.messages.forEach(msg => {
                    if (msg.type === 'user') {
                        addUserMessage(msg.text, false);
                    } else {
                        addAIResponseDirect(msg.text, msg.suggestions, false);
                    }
                });
                updateProgress(conversationState.stage, `Etapa ${conversationState.stage} de 3`);
            }
        }

        // Limpar conversa
        function clearConversation() {
            localStorage.removeItem('evoChat');
            location.reload();
        }

        // Modal de retorno
        function showReturnModal() {
            const modal = document.createElement('div');
            modal.className = 'return-modal';
            modal.innerHTML = `
                <div class="return-modal-content">
                    <h3>Bem-vindo de volta! üëã</h3>
                    <p>Encontramos uma conversa anterior. Quer continuar de onde parou?</p>
                    <div class="return-modal-buttons">
                        <button class="cta-button cta-secondary" onclick="clearConversation()">
                            Come√ßar nova conversa
                        </button>
                        <button class="cta-button" onclick="continueConversation()">
                            Continuar conversa
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Continuar conversa salva
        function continueConversation() {
            document.querySelector('.return-modal').remove();
            restoreConversation();
        }

        // Perguntar nome do usu√°rio
        function askUserName() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';

            const welcomeDiv = document.createElement('div');
            welcomeDiv.innerHTML = `
                <div class="message-ai">
                    <div class="message-content">
                        <div class="message-bubble">
                            Ol√°! Sou o assistente da Evo üòä<br><br>
                            Antes de come√ßarmos, como posso te chamar?
                        </div>
                        <div class="suggestions">
                            <input type="text" id="nameInput" class="chat-input" placeholder="Digite seu nome..." style="margin-top: 12px;" />
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(welcomeDiv);

            // Focus no input de nome
            setTimeout(() => {
                const nameInput = document.getElementById('nameInput');
                nameInput.focus();
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const name = this.value.trim();
                        if (name) {
                            conversationState.userName = name;
                            saveConversation();
                            startConversation();
                        }
                    }
                });
            }, 300);
        }

        // Iniciar conversa ap√≥s capturar nome
        function startConversation() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';

            addAIResponseDirect(
                `Prazer em te conhecer, ${conversationState.userName}! üéâ<br><br>Estou aqui para ajudar voc√™ a transformar sua ideia em realidade. Que tipo de aplicativo voc√™ est√° pensando em criar?`,
                [
                    { text: 'üçï Delivery' },
                    { text: 'üõí E-commerce' },
                    { text: 'üìö Educa√ß√£o' },
                    { text: 'üíö Sa√∫de' },
                    { text: 'üíº Gest√£o' },
                    { text: 'üí™ Fitness' },
                    { text: 'üè† Imobili√°rio' },
                    { text: '‚úÇÔ∏è Servi√ßos' },
                    { text: 'üí∞ Finan√ßas' },
                    { text: 'üë• Social' },
                    { text: 'üöó Transporte' },
                    { text: 'üêæ Pets' },
                    { text: 'üé¨ Entretenimento' },
                    { text: '‚úàÔ∏è Viagens' },
                    { text: 'üíÑ Beleza' },
                    { text: 'üéØ Outro' }
                ],
                true
            );
        }

        // Calcular tempo de digita√ß√£o baseado no tamanho da mensagem (mais humano)
        function getHumanTypingTime(message) {
            const baseTime = 800;
            const charTime = 15; // 15ms por caractere
            const randomVariation = Math.random() * 500; // 0-500ms de varia√ß√£o
            return baseTime + (message.length * charTime) + randomVariation;
        }

        // Falar com humano
        function talkToHuman() {
            // Salvar contexto atual
            const context = {
                userName: conversationState.userName,
                appType: conversationState.userInfo.appType,
                timeline: conversationState.userInfo.timeline,
                budget: conversationState.userInfo.budget,
                messages: conversationState.messages
            };

            // Redirecionar para WhatsApp ou formul√°rio
            const message = `Ol√°! Meu nome √© ${conversationState.userName || 'Visitante'}. Gostaria de falar sobre desenvolvimento de app.`;
            const whatsappUrl = `https://wa.me/5511983362246?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Atualizar progresso
        function updateProgress(stage, text) {
            conversationState.stage = stage;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            const percentage = (stage / 3) * 100;
            progressFill.style.width = percentage + '%';
            progressText.textContent = text;
        }

        // Enviar mensagem com Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Enviar mensagem
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (message === '') return;

            // Incrementar contador de mensagens
            conversationState.messageCount++;

            // Adicionar mensagem do usu√°rio
            addUserMessage(message);

            // Limpar input
            input.value = '';
            input.style.height = 'auto';
            input.placeholder = 'Digite sua mensagem aqui...'; // Restaurar placeholder padr√£o

            // SISTEMA INTELIGENTE: Processar descri√ß√£o de "Outro tipo de app"
            if (conversationState.waitingForOutroTipoDescription) {
                processOutroTipoDescription(message);
                return;
            }

            // ================================
            // NLU ENGINE v3.1: Processamento H√≠brido (NLU + Groq IA)
            // ================================
            processMessageWithAI(message);
            return; // Processamento ass√≠ncrono
        }

        // Fun√ß√£o ass√≠ncrona para processamento h√≠brido NLU + Groq
        async function processMessageWithAI(message) {
            try {
                if (!window.NLUIntegration || !window.NLUEngine) {
                    fallbackToContextualResponse(message);
                    return;
                }

                // Verificar se Groq est√° dispon√≠vel para processamento h√≠brido
                const useHybrid = window.NLUIntegration.isGroqAvailable();

                if (useHybrid) {
                    // Processamento h√≠brido NLU + Groq
                    const result = await window.NLUIntegration.processMessageHybrid(message, {
                        forceGroq: false // Deixar o sistema decidir
                    });

                    console.log('AI Hybrid:', result.source,
                               result.groqData ? `| Groq: ${result.groqData.processingTime}ms` : '');

                    // Se Groq respondeu diretamente
                    if (result.type === 'groq_response' && result.message) {
                        const typingTime = getHumanTypingTime(result.message);
                        showTypingIndicator();
                        setTimeout(() => {
                            removeTypingIndicator();
                            addGroqResponse(result.message, result.groqData);
                        }, typingTime);
                        return;
                    }
                }

                // Processamento NLU padr√£o (v3.0)
                const result = window.NLUIntegration.processMessageWithDisambiguation(message);

                // Log de an√°lise NLU
                if (result && result.analysis && result.analysis.debug) {
                    console.log('NLU v3.0:', result.type,
                               '| Category:', result.analysis.category || 'sem categoria',
                               '(' + Math.round(result.analysis.categoryConfidence || 0) + '%)',
                               result.analysis.intent ? '| Intent: ' + result.analysis.intent : '',
                               '| ' + result.analysis.debug.processingTime + 'ms');
                }

                // Tratar desambigua√ß√£o
                if (result.type === 'disambiguation_needed') {
                    const disambiguation = result.disambiguation;
                    const suggestions = disambiguation.options.map(opt => ({
                        text: opt.text,
                        value: opt.intent,
                        isDisambiguation: true
                    }));

                    const typingTime = getHumanTypingTime(disambiguation.question);
                    setTimeout(() => {
                        showTypingIndicator();
                        setTimeout(() => {
                            removeTypingIndicator();
                            addDisambiguationMessage(disambiguation.question, suggestions);
                        }, typingTime);
                    }, 500);
                    return;
                }

                if (result.type === 'disambiguation_resolved') {
                    console.log('NLU: Desambigua√ß√£o resolvida ‚Üí', result.analysis?.primaryIntent);
                }

                // Processamento normal
                const analysis = result.analysis || result;

                if (analysis && window.NLUIntegration.shouldInterruptFlow(analysis)) {
                    const userName = conversationState.userName || 'voc√™';
                    const intentResponse = window.NLUIntegration.generateResponse(analysis, userName);

                    if (intentResponse && intentResponse.message) {
                        const typingTime = getHumanTypingTime(intentResponse.message);
                        setTimeout(() => {
                            showTypingIndicator();
                            setTimeout(() => {
                                removeTypingIndicator();
                                addAIResponseDirect(intentResponse.message, intentResponse.suggestions || [], true);
                            }, typingTime);
                        }, 500);
                        return;
                    }
                }

                // Fallback para resposta contextual
                fallbackToContextualResponse(message);

            } catch (error) {
                console.warn('AI Error (fallback):', error.message);
                fallbackToContextualResponse(message);
            }
        }

        // Fallback para resposta contextual tradicional
        function fallbackToContextualResponse(message) {
            const response = generateContextualResponse(message);
            const typingTime = getHumanTypingTime(response.message);

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponse(message);
                }, typingTime);
            }, 500);
        }

        // Adicionar resposta do Groq (IA generativa)
        function addGroqResponse(message, groqData = {}) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-ai groq-response';

            // Formatar mensagem (suporta markdown b√°sico)
            const formattedMessage = formatGroqMessage(message);

            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">
                        ${formattedMessage}
                        ${groqData.cached ? '<span class="groq-cached" title="Resposta em cache">‚ö°</span>' : ''}
                    </div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();

            // Salvar na conversa
            conversationState.messages.push({
                type: 'ai',
                text: message,
                source: 'groq',
                groqData: groqData
            });
            saveConversation();

            // Adicionar ao hist√≥rico do Groq para contexto
            if (window.GroqIntegration) {
                window.GroqIntegration.addToHistory('assistant', message);
            }
        }

        // Formatar mensagem do Groq (markdown b√°sico)
        function formatGroqMessage(message) {
            return message
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }


        // Adicionar mensagem do usu√°rio
        function addUserMessage(message, save = true) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-user';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">${message}</div>
                    <div class="message-confirmed">Enviado</div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();

            if (save) {
                conversationState.messages.push({ type: 'user', text: message });
                saveConversation();
            }
        }

        // Adicionar resposta da IA diretamente (sem delay)
        function addAIResponseDirect(message, suggestions = [], save = true) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-ai';

            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">${message}</div>
                    ${suggestions && suggestions.length > 0 ? `
                        <div class="suggestions">
                            ${suggestions.map(s => `
                                <button class="suggestion-chip" onclick="selectSuggestion(this)">${s.text}</button>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();

            if (save) {
                conversationState.messages.push({ type: 'ai', text: message, suggestions });
                saveConversation();
            }
        }

        // Adicionar resposta da IA (com delay)
        function addAIResponse(userMessage) {
            const response = generateContextualResponse(userMessage);
            addAIResponseDirect(response.message, response.suggestions, true);
        }

        // ================================
        // NLU v3.0: Adicionar mensagem de desambigua√ß√£o
        // ================================
        function addDisambiguationMessage(message, options = []) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-ai disambiguation-message';

            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble disambiguation-bubble">
                        <span class="disambiguation-icon">ü§î</span>
                        ${message}
                    </div>
                    ${options && options.length > 0 ? `
                        <div class="disambiguation-options">
                            ${options.map((opt, index) => `
                                <button class="disambiguation-chip"
                                        data-value="${opt.value || opt.text}"
                                        data-index="${index}"
                                        onclick="selectDisambiguationOption(this)">
                                    ${opt.text}
                                </button>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();

            // Salvar na conversa
            conversationState.messages.push({
                type: 'ai',
                text: message,
                isDisambiguation: true,
                options: options
            });
            saveConversation();
        }

        // Selecionar op√ß√£o de desambigua√ß√£o
        function selectDisambiguationOption(button) {
            const value = button.getAttribute('data-value');
            const text = button.textContent.trim();

            // Desabilitar todos os bot√µes de desambigua√ß√£o
            const allButtons = document.querySelectorAll('.disambiguation-chip');
            allButtons.forEach(btn => {
                btn.disabled = true;
                btn.classList.add('disabled');
            });

            // Destacar o bot√£o selecionado
            button.classList.add('selected');

            // Adicionar como mensagem do usu√°rio
            addUserMessage(text);

            // Resolver desambigua√ß√£o via NLU
            if (window.NLUIntegration && window.NLUIntegration.resolveDisambiguation) {
                const resolved = window.NLUIntegration.resolveDisambiguation(value);
                console.log('NLU: Desambigua√ß√£o resolvida pelo usu√°rio ‚Üí', value);

                // Se resolveu com sucesso, gerar resposta baseada no intent selecionado
                if (resolved && resolved.resolved && resolved.intent) {
                    // Criar objeto de an√°lise m√≠nimo para generateResponse
                    const minimalAnalysis = {
                        intent: {
                            primary: {
                                intent: resolved.intent,
                                confidence: 100
                            }
                        },
                        category: { detected: null },
                        entities: {}
                    };

                    const userName = conversationState.userName || 'voc√™';
                    const intentResponse = window.NLUIntegration.generateResponse(minimalAnalysis, userName);

                    if (intentResponse && intentResponse.message) {
                        const typingTime = getHumanTypingTime(intentResponse.message);
                        setTimeout(() => {
                            showTypingIndicator();
                            setTimeout(() => {
                                removeTypingIndicator();
                                addAIResponseDirect(intentResponse.message, intentResponse.suggestions || [], true);
                            }, typingTime);
                        }, 500);
                        return;
                    }
                }
            }

            // Fallback: processar como mensagem normal
            const response = generateContextualResponse(text);
            const typingTime = getHumanTypingTime(response.message);
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponseDirect(response.message, response.suggestions, true);
                }, typingTime);
            }, 500);
        }

        // ================================
        // SISTEMA AVAN√áADO DE NLP - KEYWORD MATCHING
        // ================================

        // Normalizar texto (remover acentos, pontua√ß√£o, etc)
        function normalizeText(text) {
            return text.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '') // Remove acentos
                .replace(/[^\w\s]/g, ' ') // Remove pontua√ß√£o
                .replace(/\s+/g, ' ') // Normaliza espa√ßos
                .trim();
        }

        // Dicion√°rio de palavras-chave com pesos (state-of-the-art)
        const keywordDictionary = {
            delivery: {
                primary: [
                    { word: 'delivery', weight: 10 },
                    { word: 'entrega', weight: 10 },
                    { word: 'deliveri', weight: 9 }, // Typo comum
                    { word: 'entregar', weight: 9 }
                ],
                secondary: [
                    { word: 'comida', weight: 7 },
                    { word: 'restaurante', weight: 7 },
                    { word: 'ifood', weight: 8 },
                    { word: 'rappi', weight: 8 },
                    { word: 'uber eats', weight: 8 },
                    { word: 'pedido', weight: 6 },
                    { word: 'pedidos', weight: 6 },
                    { word: 'motoboy', weight: 7 },
                    { word: 'entregador', weight: 7 },
                    { word: 'alimento', weight: 5 },
                    { word: 'refeicao', weight: 5 },
                    { word: 'cardapio', weight: 6 },
                    { word: 'levar', weight: 4 },
                    { word: 'transportar', weight: 5 }
                ],
                contextPhrases: [
                    { phrase: 'app de entrega', weight: 15 },
                    { phrase: 'aplicativo de delivery', weight: 15 },
                    { phrase: 'pedir comida', weight: 12 },
                    { phrase: 'entregar comida', weight: 12 }
                ]
            },
            ecommerce: {
                primary: [
                    { word: 'ecommerce', weight: 10 },
                    { word: 'e-commerce', weight: 10 },
                    { word: 'loja', weight: 9 },
                    { word: 'venda', weight: 9 },
                    { word: 'vender', weight: 9 }
                ],
                secondary: [
                    { word: 'produto', weight: 7 },
                    { word: 'produtos', weight: 7 },
                    { word: 'catalogo', weight: 7 },
                    { word: 'compra', weight: 6 },
                    { word: 'comprar', weight: 6 },
                    { word: 'carrinho', weight: 8 },
                    { word: 'checkout', weight: 8 },
                    { word: 'pagamento', weight: 6 },
                    { word: 'mercadoria', weight: 6 },
                    { word: 'estoque', weight: 7 },
                    { word: 'marketplace', weight: 9 },
                    { word: 'shopify', weight: 8 },
                    { word: 'woocommerce', weight: 8 },
                    { word: 'magento', weight: 8 },
                    { word: 'comercio', weight: 7 },
                    { word: 'varejo', weight: 7 },
                    { word: 'cliente', weight: 4 }
                ],
                contextPhrases: [
                    { phrase: 'loja virtual', weight: 15 },
                    { phrase: 'loja online', weight: 15 },
                    { phrase: 'vender online', weight: 13 },
                    { phrase: 'vender pela internet', weight: 13 },
                    { phrase: 'comercio eletronico', weight: 12 }
                ]
            },
            educacao: {
                primary: [
                    { word: 'educacao', weight: 10 },
                    { word: 'curso', weight: 9 },
                    { word: 'cursos', weight: 9 },
                    { word: 'ensino', weight: 9 },
                    { word: 'aula', weight: 8 },
                    { word: 'aulas', weight: 8 }
                ],
                secondary: [
                    { word: 'escola', weight: 7 },
                    { word: 'professor', weight: 6 },
                    { word: 'aluno', weight: 6 },
                    { word: 'alunos', weight: 6 },
                    { word: 'aprender', weight: 7 },
                    { word: 'ensinar', weight: 7 },
                    { word: 'ead', weight: 9 },
                    { word: 'e-learning', weight: 9 },
                    { word: 'udemy', weight: 8 },
                    { word: 'coursera', weight: 8 },
                    { word: 'hotmart', weight: 8 },
                    { word: 'eduzz', weight: 8 },
                    { word: 'video aula', weight: 8 },
                    { word: 'treinamento', weight: 7 },
                    { word: 'capacitacao', weight: 7 },
                    { word: 'formacao', weight: 6 },
                    { word: 'tutorial', weight: 6 },
                    { word: 'conhecimento', weight: 5 },
                    { word: 'materia', weight: 5 },
                    { word: 'disciplina', weight: 5 }
                ],
                contextPhrases: [
                    { phrase: 'plataforma de ensino', weight: 15 },
                    { phrase: 'curso online', weight: 13 },
                    { phrase: 'aula online', weight: 13 },
                    { phrase: 'ensino a distancia', weight: 12 },
                    { phrase: 'educacao online', weight: 12 }
                ]
            },
            saude: {
                primary: [
                    { word: 'saude', weight: 10 },
                    { word: 'fitness', weight: 9 },
                    { word: 'bem-estar', weight: 9 },
                    { word: 'bem estar', weight: 9 }
                ],
                secondary: [
                    { word: 'medico', weight: 7 },
                    { word: 'consulta', weight: 7 },
                    { word: 'clinica', weight: 7 },
                    { word: 'hospital', weight: 7 },
                    { word: 'paciente', weight: 6 },
                    { word: 'exercicio', weight: 7 },
                    { word: 'treino', weight: 7 },
                    { word: 'academia', weight: 7 },
                    { word: 'nutricao', weight: 7 },
                    { word: 'dieta', weight: 6 },
                    { word: 'alimentacao', weight: 6 },
                    { word: 'mental', weight: 6 },
                    { word: 'terapia', weight: 6 },
                    { word: 'psicologo', weight: 6 },
                    { word: 'yoga', weight: 6 },
                    { word: 'meditacao', weight: 6 },
                    { word: 'wellness', weight: 7 },
                    { word: 'musculacao', weight: 6 },
                    { word: 'corrida', weight: 5 },
                    { word: 'esporte', weight: 5 },
                    { word: 'atividade fisica', weight: 7 },
                    { word: 'saude mental', weight: 8 },
                    { word: 'prontuario', weight: 7 },
                    { word: 'telemedicina', weight: 9 }
                ],
                contextPhrases: [
                    { phrase: 'app de saude', weight: 15 },
                    { phrase: 'aplicativo de saude', weight: 15 },
                    { phrase: 'agendamento de consulta', weight: 13 },
                    { phrase: 'consulta online', weight: 12 },
                    { phrase: 'treino personalizado', weight: 11 }
                ]
            },
            gestao: {
                primary: [
                    { word: 'gestao', weight: 10 },
                    { word: 'gerenciamento', weight: 9 },
                    { word: 'empresarial', weight: 9 },
                    { word: 'empresa', weight: 8 },
                    { word: 'agendamento', weight: 9 },
                    { word: 'agendar', weight: 9 }
                ],
                secondary: [
                    { word: 'crm', weight: 9 },
                    { word: 'erp', weight: 9 },
                    { word: 'financeiro', weight: 7 },
                    { word: 'estoque', weight: 7 },
                    { word: 'vendas', weight: 6 },
                    { word: 'funcionario', weight: 6 },
                    { word: 'funcionarios', weight: 6 },
                    { word: 'equipe', weight: 6 },
                    { word: 'time', weight: 5 },
                    { word: 'controle', weight: 6 },
                    { word: 'administracao', weight: 7 },
                    { word: 'relatorio', weight: 6 },
                    { word: 'dashboard', weight: 7 },
                    { word: 'invoice', weight: 6 },
                    { word: 'faturamento', weight: 7 },
                    { word: 'nfe', weight: 7 },
                    { word: 'nota fiscal', weight: 7 },
                    { word: 'contabilidade', weight: 6 },
                    { word: 'fluxo de caixa', weight: 8 },
                    { word: 'projeto', weight: 5 },
                    { word: 'projetos', weight: 5 },
                    { word: 'task', weight: 5 },
                    { word: 'tarefa', weight: 5 },
                    // Nichos espec√≠ficos de servi√ßos/agendamento
                    { word: 'barbearia', weight: 8 },
                    { word: 'barbeiro', weight: 8 },
                    { word: 'salao', weight: 7 },
                    { word: 'cabelereiro', weight: 7 },
                    { word: 'cabeleireira', weight: 7 },
                    { word: 'estetica', weight: 7 },
                    { word: 'beleza', weight: 6 },
                    { word: 'manicure', weight: 7 },
                    { word: 'pet shop', weight: 8 },
                    { word: 'petshop', weight: 8 },
                    { word: 'veterinario', weight: 7 },
                    { word: 'veterinaria', weight: 7 },
                    { word: 'banho e tosa', weight: 8 },
                    { word: 'oficina', weight: 7 },
                    { word: 'mecanica', weight: 7 },
                    { word: 'lavanderia', weight: 7 },
                    { word: 'reserva', weight: 6 },
                    { word: 'reservas', weight: 6 },
                    { word: 'servico', weight: 5 },
                    { word: 'servicos', weight: 5 },
                    { word: 'atendimento', weight: 5 },
                    { word: 'cliente', weight: 4 },
                    { word: 'clientes', weight: 4 },
                    { word: 'agenda', weight: 7 },
                    { word: 'horario', weight: 6 },
                    { word: 'horarios', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'gestao empresarial', weight: 15 },
                    { phrase: 'gestao de empresa', weight: 14 },
                    { phrase: 'controle financeiro', weight: 12 },
                    { phrase: 'gestao de vendas', weight: 12 }
                ]
            },
            fitness: {
                primary: [
                    { word: 'fitness', weight: 10 },
                    { word: 'academia', weight: 10 },
                    { word: 'treino', weight: 9 },
                    { word: 'treinos', weight: 9 },
                    { word: 'personal', weight: 9 }
                ],
                secondary: [
                    { word: 'exercicio', weight: 7 },
                    { word: 'musculacao', weight: 8 },
                    { word: 'crossfit', weight: 8 },
                    { word: 'gym', weight: 8 },
                    { word: 'gympass', weight: 9 },
                    { word: 'smartfit', weight: 9 },
                    { word: 'workout', weight: 8 },
                    { word: 'aluno', weight: 5 },
                    { word: 'corrida', weight: 6 },
                    { word: 'cardio', weight: 6 },
                    { word: 'dieta', weight: 6 },
                    { word: 'nutricao', weight: 6 },
                    { word: 'emagrecimento', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'app de academia', weight: 15 },
                    { phrase: 'app de treino', weight: 15 },
                    { phrase: 'personal trainer', weight: 14 },
                    { phrase: 'treino personalizado', weight: 13 },
                    { phrase: 'app fitness', weight: 14 }
                ]
            },
            imobiliario: {
                primary: [
                    { word: 'imovel', weight: 10 },
                    { word: 'imoveis', weight: 10 },
                    { word: 'imobiliaria', weight: 10 },
                    { word: 'corretor', weight: 9 },
                    { word: 'aluguel', weight: 9 }
                ],
                secondary: [
                    { word: 'apartamento', weight: 7 },
                    { word: 'casa', weight: 6 },
                    { word: 'terreno', weight: 7 },
                    { word: 'compra', weight: 5 },
                    { word: 'venda', weight: 5 },
                    { word: 'locacao', weight: 8 },
                    { word: 'inquilino', weight: 7 },
                    { word: 'proprietario', weight: 7 },
                    { word: 'financiamento', weight: 7 },
                    { word: 'zapimoveis', weight: 9 },
                    { word: 'quintoandar', weight: 9 },
                    { word: 'vivareal', weight: 9 }
                ],
                contextPhrases: [
                    { phrase: 'app de imoveis', weight: 15 },
                    { phrase: 'portal imobiliario', weight: 15 },
                    { phrase: 'vender imoveis', weight: 13 },
                    { phrase: 'alugar imoveis', weight: 13 },
                    { phrase: 'corretora de imoveis', weight: 14 }
                ]
            },
            servicos: {
                primary: [
                    { word: 'agendamento', weight: 10 },
                    { word: 'agendar', weight: 9 },
                    { word: 'barbearia', weight: 10 },
                    { word: 'salao', weight: 10 },
                    { word: 'servico', weight: 8 }
                ],
                secondary: [
                    { word: 'barbeiro', weight: 8 },
                    { word: 'cabelereiro', weight: 8 },
                    { word: 'cabeleireira', weight: 8 },
                    { word: 'estetica', weight: 8 },
                    { word: 'manicure', weight: 8 },
                    { word: 'spa', weight: 7 },
                    { word: 'massagem', weight: 7 },
                    { word: 'beleza', weight: 6 },
                    { word: 'pet shop', weight: 8 },
                    { word: 'veterinario', weight: 7 },
                    { word: 'oficina', weight: 7 },
                    { word: 'mecanica', weight: 7 },
                    { word: 'lavanderia', weight: 7 },
                    { word: 'horario', weight: 6 },
                    { word: 'reserva', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'agendamento de barbearia', weight: 15 },
                    { phrase: 'app de barbearia', weight: 15 },
                    { phrase: 'agendamento de salao', weight: 15 },
                    { phrase: 'app de salao', weight: 15 },
                    { phrase: 'sistema de agendamento', weight: 14 },
                    { phrase: 'agendamento online', weight: 13 },
                    { phrase: 'marcar horario', weight: 12 }
                ]
            },
            financas: {
                primary: [
                    { word: 'financa', weight: 10 },
                    { word: 'financas', weight: 10 },
                    { word: 'fintech', weight: 10 },
                    { word: 'banco', weight: 9 },
                    { word: 'investimento', weight: 9 }
                ],
                secondary: [
                    { word: 'dinheiro', weight: 7 },
                    { word: 'gasto', weight: 6 },
                    { word: 'despesa', weight: 6 },
                    { word: 'receita', weight: 6 },
                    { word: 'orcamento', weight: 7 },
                    { word: 'poupanca', weight: 7 },
                    { word: 'carteira', weight: 6 },
                    { word: 'nubank', weight: 9 },
                    { word: 'inter', weight: 7 },
                    { word: 'pix', weight: 7 },
                    { word: 'boleto', weight: 6 },
                    { word: 'pagamento', weight: 6 },
                    { word: 'cobranca', weight: 6 },
                    { word: 'mobills', weight: 9 },
                    { word: 'organizze', weight: 9 }
                ],
                contextPhrases: [
                    { phrase: 'controle financeiro', weight: 15 },
                    { phrase: 'app de financas', weight: 15 },
                    { phrase: 'gestao financeira', weight: 14 },
                    { phrase: 'controle de gastos', weight: 13 },
                    { phrase: 'aplicativo de banco', weight: 13 }
                ]
            },
            social: {
                primary: [
                    { word: 'rede social', weight: 10 },
                    { word: 'social', weight: 8 },
                    { word: 'comunidade', weight: 10 },
                    { word: 'forum', weight: 9 },
                    { word: 'grupo', weight: 7 }
                ],
                secondary: [
                    { word: 'post', weight: 6 },
                    { word: 'publicacao', weight: 6 },
                    { word: 'curtida', weight: 7 },
                    { word: 'comentario', weight: 6 },
                    { word: 'seguidor', weight: 7 },
                    { word: 'perfil', weight: 6 },
                    { word: 'feed', weight: 8 },
                    { word: 'timeline', weight: 7 },
                    { word: 'discord', weight: 9 },
                    { word: 'telegram', weight: 7 },
                    { word: 'whatsapp', weight: 6 },
                    { word: 'chat', weight: 6 },
                    { word: 'mensagem', weight: 5 },
                    { word: 'networking', weight: 7 }
                ],
                contextPhrases: [
                    { phrase: 'rede social', weight: 15 },
                    { phrase: 'criar comunidade', weight: 14 },
                    { phrase: 'app de comunidade', weight: 15 },
                    { phrase: 'plataforma social', weight: 14 },
                    { phrase: 'grupo online', weight: 12 }
                ]
            },
            transporte: {
                primary: [
                    { word: 'transporte', weight: 10 },
                    { word: 'uber', weight: 10 },
                    { word: '99', weight: 9 },
                    { word: 'corrida', weight: 8 },
                    { word: 'motorista', weight: 9 }
                ],
                secondary: [
                    { word: 'passageiro', weight: 7 },
                    { word: 'taxi', weight: 8 },
                    { word: 'carro', weight: 6 },
                    { word: 'viagem', weight: 6 },
                    { word: 'destino', weight: 5 },
                    { word: 'rota', weight: 6 },
                    { word: 'frota', weight: 7 },
                    { word: 'mobilidade', weight: 8 },
                    { word: 'cabify', weight: 9 },
                    { word: 'indriver', weight: 9 },
                    { word: 'carona', weight: 7 },
                    { word: 'logistica', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'app de transporte', weight: 15 },
                    { phrase: 'app tipo uber', weight: 15 },
                    { phrase: 'chamar carro', weight: 13 },
                    { phrase: 'pedir corrida', weight: 13 },
                    { phrase: 'aplicativo de taxi', weight: 14 }
                ]
            },
            pets: {
                primary: [
                    { word: 'pet', weight: 10 },
                    { word: 'pets', weight: 10 },
                    { word: 'petshop', weight: 10 },
                    { word: 'pet shop', weight: 10 },
                    { word: 'animal', weight: 8 }
                ],
                secondary: [
                    { word: 'cachorro', weight: 8 },
                    { word: 'gato', weight: 8 },
                    { word: 'racao', weight: 7 },
                    { word: 'veterinario', weight: 8 },
                    { word: 'banho', weight: 6 },
                    { word: 'tosa', weight: 7 },
                    { word: 'petz', weight: 9 },
                    { word: 'cobasi', weight: 9 },
                    { word: 'vacina', weight: 6 },
                    { word: 'petisco', weight: 6 },
                    { word: 'cao', weight: 7 },
                    { word: 'felino', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'app de pet', weight: 15 },
                    { phrase: 'pet shop online', weight: 15 },
                    { phrase: 'agendamento de banho', weight: 14 },
                    { phrase: 'loja de pets', weight: 14 },
                    { phrase: 'veterinaria online', weight: 13 }
                ]
            },
            entretenimento: {
                primary: [
                    { word: 'streaming', weight: 10 },
                    { word: 'entretenimento', weight: 10 },
                    { word: 'filme', weight: 8 },
                    { word: 'filmes', weight: 8 },
                    { word: 'serie', weight: 8 }
                ],
                secondary: [
                    { word: 'netflix', weight: 9 },
                    { word: 'disney', weight: 8 },
                    { word: 'video', weight: 6 },
                    { word: 'musica', weight: 7 },
                    { word: 'spotify', weight: 9 },
                    { word: 'youtube', weight: 8 },
                    { word: 'podcast', weight: 7 },
                    { word: 'audio', weight: 6 },
                    { word: 'assistir', weight: 6 },
                    { word: 'conteudo', weight: 5 },
                    { word: 'assinatura', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'app de streaming', weight: 15 },
                    { phrase: 'plataforma de video', weight: 14 },
                    { phrase: 'assistir filmes', weight: 13 },
                    { phrase: 'tipo netflix', weight: 15 },
                    { phrase: 'streaming de musica', weight: 14 }
                ]
            },
            viagens: {
                primary: [
                    { word: 'viagem', weight: 10 },
                    { word: 'viagens', weight: 10 },
                    { word: 'turismo', weight: 10 },
                    { word: 'hotel', weight: 9 },
                    { word: 'voo', weight: 9 }
                ],
                secondary: [
                    { word: 'passagem', weight: 8 },
                    { word: 'hospedagem', weight: 8 },
                    { word: 'reserva', weight: 6 },
                    { word: 'destino', weight: 6 },
                    { word: 'booking', weight: 9 },
                    { word: 'airbnb', weight: 9 },
                    { word: 'decolar', weight: 9 },
                    { word: 'pacote', weight: 6 },
                    { word: 'ferias', weight: 6 },
                    { word: 'agencia', weight: 7 },
                    { word: 'roteiro', weight: 6 }
                ],
                contextPhrases: [
                    { phrase: 'app de viagem', weight: 15 },
                    { phrase: 'agencia de turismo', weight: 15 },
                    { phrase: 'reserva de hotel', weight: 14 },
                    { phrase: 'passagem aerea', weight: 14 },
                    { phrase: 'tipo booking', weight: 15 }
                ]
            },
            beleza: {
                primary: [
                    { word: 'beleza', weight: 10 },
                    { word: 'estetica', weight: 10 },
                    { word: 'salao', weight: 9 },
                    { word: 'manicure', weight: 9 },
                    { word: 'cabelo', weight: 8 }
                ],
                secondary: [
                    { word: 'maquiagem', weight: 8 },
                    { word: 'unha', weight: 7 },
                    { word: 'pedicure', weight: 8 },
                    { word: 'depilacao', weight: 7 },
                    { word: 'sobrancelha', weight: 7 },
                    { word: 'cilios', weight: 7 },
                    { word: 'spa', weight: 7 },
                    { word: 'massagem', weight: 6 },
                    { word: 'skin', weight: 6 },
                    { word: 'facial', weight: 6 },
                    { word: 'tratamento', weight: 5 }
                ],
                contextPhrases: [
                    { phrase: 'salao de beleza', weight: 15 },
                    { phrase: 'clinica estetica', weight: 15 },
                    { phrase: 'app de beleza', weight: 15 },
                    { phrase: 'agendamento de manicure', weight: 14 },
                    { phrase: 'studio de beleza', weight: 14 }
                ]
            }
        };

        // Adicionar keywords para e-commerce de assinaturas
        keywordDictionary.ecommerce.secondary.push(
            { word: 'assinatura', weight: 8 },
            { word: 'assinaturas', weight: 8 },
            { word: 'clube', weight: 6 },
            { word: 'mensal', weight: 5 },
            { word: 'recorrente', weight: 6 },
            { word: 'subscription', weight: 8 },
            { word: 'vinho', weight: 5 },
            { word: 'vinhos', weight: 5 },
            { word: 'cerveja', weight: 5 },
            { word: 'box', weight: 5 }
        );
        keywordDictionary.ecommerce.contextPhrases.push(
            { phrase: 'clube de assinatura', weight: 14 },
            { phrase: 'assinatura de vinhos', weight: 14 },
            { phrase: 'assinatura de cerveja', weight: 14 },
            { phrase: 'box mensal', weight: 12 }
        );

        // ================================
        // ALGORITMO NLU AVAN√áADO
        // Usa: Fuzzy Matching, N-grams, Multi-Intent, Context-Aware
        // ================================

        // Calcular score de similaridade entre palavras-chave
        // Agora usa NLU Engine com Levenshtein + Jaro-Winkler
        function calculateKeywordScore(userMessage) {
            // Se NLU Engine est√° dispon√≠vel, usa ele
            if (window.NLUIntegration) {
                return window.NLUIntegration.calculateKeywordScore(userMessage);
            }

            // Fallback para m√©todo tradicional
            const normalized = normalizeText(userMessage);
            const scores = {
                delivery: 0, ecommerce: 0, educacao: 0, saude: 0,
                gestao: 0, fitness: 0, imobiliario: 0, servicos: 0,
                financas: 0, social: 0, transporte: 0, pets: 0,
                entretenimento: 0, viagens: 0, beleza: 0
            };

            for (const [category, keywords] of Object.entries(keywordDictionary)) {
                let categoryScore = 0;
                if (keywords.contextPhrases) {
                    keywords.contextPhrases.forEach(({ phrase, weight }) => {
                        if (normalized.includes(normalizeText(phrase))) {
                            categoryScore += weight;
                        }
                    });
                }
                keywords.primary.forEach(({ word, weight }) => {
                    const normalizedWord = normalizeText(word);
                    const regex = new RegExp(`\\b${normalizedWord}\\b`, 'g');
                    const matches = normalized.match(regex);
                    if (matches) categoryScore += weight * matches.length;
                    else if (normalized.includes(normalizedWord)) categoryScore += weight * 0.7;
                });
                keywords.secondary.forEach(({ word, weight }) => {
                    const normalizedWord = normalizeText(word);
                    const regex = new RegExp(`\\b${normalizedWord}\\b`, 'g');
                    const matches = normalized.match(regex);
                    if (matches) categoryScore += weight * matches.length;
                    else if (normalized.includes(normalizedWord)) categoryScore += weight * 0.6;
                });
                scores[category] = categoryScore;
            }

            if (window.nichosExpandidos) {
                for (const [category, subcategories] of Object.entries(nichosExpandidos)) {
                    for (const [subcategory, keywordsList] of Object.entries(subcategories)) {
                        keywordsList.forEach(keyword => {
                            const normalizedKeyword = normalizeText(keyword);
                            const regex = new RegExp(`\\b${normalizedKeyword}\\b`, 'g');
                            const matches = normalized.match(regex);
                            if (matches) scores[category] += 6 * matches.length;
                            else if (normalizedKeyword.length >= 4 && normalized.includes(normalizedKeyword)) {
                                scores[category] += 3;
                            }
                        });
                    }
                }
            }
            return scores;
        }

        // Detectar categoria com maior confidence
        // Usa NLU Engine com Fuzzy Matching + Intent Detection
        function detectCategory(message) {
            // Se NLU Engine est√° dispon√≠vel, usa ele (com todas as features avan√ßadas)
            if (window.NLUIntegration) {
                const result = window.NLUIntegration.detectCategory(message);
                // Armazena an√°lise NLU no estado da conversa para uso posterior
                if (result.nlu) {
                    conversationState.lastNLUAnalysis = result.nlu;
                }
                return result;
            }

            // Fallback para m√©todo tradicional
            const scores = calculateKeywordScore(message);
            let maxScore = 0;
            let detectedCategory = null;

            for (const [category, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    detectedCategory = category;
                }
            }

            const minConfidenceThreshold = 5;
            if (maxScore >= minConfidenceThreshold) {
                return { category: detectedCategory, confidence: maxScore, allScores: scores };
            }
            return { category: null, confidence: 0, allScores: scores };
        }

        // ================================
        // DETEC√á√ÉO DE NICHO ESPEC√çFICO (usando 1000+ keywords + Fuzzy Matching)
        // ================================
        function detectSpecificNiche(message, category) {
            // Se NLU Engine est√° dispon√≠vel, usa fuzzy matching avan√ßado
            if (window.NLUIntegration) {
                return window.NLUIntegration.detectSpecificNiche(message, category);
            }

            // Fallback para m√©todo tradicional
            if (!window.nichosExpandidos || !category) return null;

            const normalized = normalizeText(message);
            const categoryNiches = nichosExpandidos[category];
            if (!categoryNiches) return null;

            let bestMatch = null;
            let bestScore = 0;

            for (const [subcategory, keywords] of Object.entries(categoryNiches)) {
                keywords.forEach(keyword => {
                    const normalizedKeyword = normalizeText(keyword);
                    if (normalized.includes(normalizedKeyword)) {
                        const score = normalizedKeyword.length;
                        if (score > bestScore) {
                            bestScore = score;
                            bestMatch = { keyword, subcategory, score };
                        }
                    }
                });
            }
            return bestMatch;
        }

        // Perguntas espec√≠ficas por nicho detectado
        const nicheQuestions = {
            // DELIVERY
            delivery: {
                restaurantes: {
                    question: 'Que tipo de comida voc√™s servem?',
                    suggestions: [
                        { text: 'üçï Pizza / Lanches' },
                        { text: 'üç£ Japonesa / Variada' },
                        { text: 'ü•ó Comida caseira / Marmitas' }
                    ]
                },
                culinarias: {
                    question: 'Voc√™s j√° trabalham com delivery ou √© novidade?',
                    suggestions: [
                        { text: 'üì± J√° uso iFood/Rappi' },
                        { text: 'üÜï Vou come√ßar o delivery agora' },
                        { text: 'üí° Quero ter meu app pr√≥prio' }
                    ]
                },
                pratos: {
                    question: 'Como √© o movimento do seu neg√≥cio?',
                    suggestions: [
                        { text: 'üìà Muitos pedidos por dia' },
                        { text: 'üìä Quantidade moderada' },
                        { text: 'üå± Ainda estou come√ßando' }
                    ]
                },
                bebidas: {
                    question: 'S√≥ entrega ou tem consumo no local tamb√©m?',
                    suggestions: [
                        { text: 'üöö S√≥ delivery' },
                        { text: 'üè™ Tem o bar/loja tamb√©m' },
                        { text: 'üéØ Os dois s√£o importantes' }
                    ]
                },
                entrega: {
                    question: 'Quantas entregas voc√™s fazem por dia mais ou menos?',
                    suggestions: [
                        { text: 'üì¶ At√© 50 entregas' },
                        { text: 'üì¶üì¶ 50 a 200 entregas' },
                        { text: 'üì¶üì¶üì¶ Mais de 200 entregas' }
                    ]
                },
                concorrentes: {
                    question: 'Por que voc√™ quer sair do iFood/Rappi?',
                    suggestions: [
                        { text: 'üí∏ Taxas muito altas' },
                        { text: 'üìä Quero ter meus dados' },
                        { text: 'üéØ Quero ter minha marca' }
                    ]
                },
                modelos: {
                    question: 'Como funciona seu neg√≥cio hoje?',
                    suggestions: [
                        { text: 'üè™ Tenho um ponto f√≠sico' },
                        { text: 'üç≥ S√≥ cozinha (dark kitchen)' },
                        { text: 'üÜï Ainda estou planejando' }
                    ]
                },
                default: {
                    question: 'Voc√™ j√° usa algum app de delivery hoje?',
                    suggestions: [
                        { text: 'üì± Uso iFood/Rappi' },
                        { text: '‚ùå N√£o uso nenhum' },
                        { text: 'üí° Quero ter o meu pr√≥prio' }
                    ]
                }
            },
            // E-COMMERCE
            ecommerce: {
                lojas: {
                    question: 'Que tipo de loja voc√™ tem ou quer criar?',
                    suggestions: [
                        { text: 'üè™ Loja f√≠sica que quer vender online' },
                        { text: 'üì± S√≥ online mesmo' },
                        { text: 'üéØ Quero ter os dois' }
                    ]
                },
                moda: {
                    question: 'Voc√™ j√° vende suas pe√ßas em algum lugar?',
                    suggestions: [
                        { text: 'üì± Vendo pelo Instagram' },
                        { text: 'üè™ Tenho loja f√≠sica' },
                        { text: 'üõí Uso Shopee/Mercado Livre' }
                    ]
                },
                casa: {
                    question: 'Seus produtos s√£o grandes ou pequenos?',
                    suggestions: [
                        { text: 'üì¶ Pequenos (decor, utens√≠lios)' },
                        { text: 'üõãÔ∏è Grandes (m√≥veis)' },
                        { text: 'üéØ Variados' }
                    ]
                },
                beleza: {
                    question: 'Seus produtos s√£o de marca pr√≥pria ou revenda?',
                    suggestions: [
                        { text: '‚ú® Marca pr√≥pria' },
                        { text: 'üè∑Ô∏è Revendo de outras marcas' },
                        { text: 'üéØ Os dois' }
                    ]
                },
                eletronicos: {
                    question: 'Trabalha mais com produtos novos ou usados?',
                    suggestions: [
                        { text: 'üÜï S√≥ novos' },
                        { text: '‚ôªÔ∏è Novos e usados' },
                        { text: 'üì¶ Importados' }
                    ]
                },
                infantil: {
                    question: '√â loja especializada ou vende de tudo pra crian√ßa?',
                    suggestions: [
                        { text: 'üéØ Especializada (roupas/brinquedos)' },
                        { text: 'üõí Vendo de tudo' },
                        { text: 'üë∂ Foco em beb√™s' }
                    ]
                },
                pet: {
                    question: '√â pet shop completo ou segmento espec√≠fico?',
                    suggestions: [
                        { text: 'üêï Pet shop completo' },
                        { text: 'ü¶¥ S√≥ ra√ß√£o/petiscos' },
                        { text: 'üéÄ Acess√≥rios e roupinhas' }
                    ]
                },
                outros: {
                    question: 'Voc√™ produz ou revende os produtos?',
                    suggestions: [
                        { text: 'üé® Fa√ßo artesanato/handmade' },
                        { text: 'üè≠ Revendo de fornecedores' },
                        { text: 'üéØ Os dois' }
                    ]
                },
                marketplaces: {
                    question: 'Voc√™ quer sair dos marketplaces ou manter os dois?',
                    suggestions: [
                        { text: 'üöÄ Quero sair das taxas' },
                        { text: 'üéØ Quero ter os dois' },
                        { text: 'üìä Quero ter meus dados' }
                    ]
                },
                default: {
                    question: 'Voc√™ j√° vende online hoje?',
                    suggestions: [
                        { text: 'üì± Sim, pelo Instagram/WhatsApp' },
                        { text: 'üõí Sim, em marketplaces' },
                        { text: 'üÜï Ainda n√£o, quero come√ßar' }
                    ]
                }
            },
            // EDUCA√á√ÉO
            educacao: {
                instituicoes: {
                    question: 'Quantos alunos voc√™s t√™m mais ou menos?',
                    suggestions: [
                        { text: 'üë§ At√© 50 alunos' },
                        { text: 'üë• 50 a 500 alunos' },
                        { text: 'üè´ Mais de 500 alunos' }
                    ]
                },
                cursos: {
                    question: 'Seus cursos j√° est√£o gravados ou s√£o ao vivo?',
                    suggestions: [
                        { text: 'üìπ J√° tenho v√≠deos gravados' },
                        { text: 'üé¨ Dou aulas ao vivo' },
                        { text: 'üÜï Ainda vou gravar' }
                    ]
                },
                areas: {
                    question: 'Voc√™ √© o professor ou tem equipe?',
                    suggestions: [
                        { text: 'üë®‚Äçüè´ Sou eu que ensino' },
                        { text: 'üë• Tenho outros professores' },
                        { text: 'üè´ √â uma escola/instituto' }
                    ]
                },
                publico: {
                    question: 'Pra quem √© seu conte√∫do?',
                    suggestions: [
                        { text: 'üë∂ Crian√ßas/Adolescentes' },
                        { text: 'üë®‚Äçüíº Adultos/Profissionais' },
                        { text: 'üéØ P√∫blico geral' }
                    ]
                },
                recursos: {
                    question: 'Voc√™ j√° tem material pronto?',
                    suggestions: [
                        { text: 'üìπ Tenho v√≠deos' },
                        { text: 'üìö Tenho apostilas/PDFs' },
                        { text: 'üÜï Ainda vou criar' }
                    ]
                },
                plataformas: {
                    question: 'Por que voc√™ quer sair da Hotmart/Eduzz?',
                    suggestions: [
                        { text: 'üí∏ Taxas muito altas' },
                        { text: 'üé® Quero personalizar' },
                        { text: 'üìä Quero ter meus dados' }
                    ]
                },
                default: {
                    question: 'Voc√™ vende seus cursos em alguma plataforma?',
                    suggestions: [
                        { text: 'üì± Sim, Hotmart/Eduzz' },
                        { text: 'üé¨ S√≥ no YouTube' },
                        { text: 'üÜï Ainda n√£o vendo online' }
                    ]
                }
            },
            // SA√öDE
            saude: {
                profissionais: {
                    question: 'Voc√™ atende sozinho ou tem equipe?',
                    suggestions: [
                        { text: 'üë§ Atendo sozinho(a)' },
                        { text: 'üë• Tenho uma equipe pequena' },
                        { text: 'üè• √â uma cl√≠nica/consult√≥rio maior' }
                    ]
                },
                estabelecimentos: {
                    question: 'Quantos pacientes voc√™s atendem por dia?',
                    suggestions: [
                        { text: 'üë§ At√© 20 pacientes' },
                        { text: 'üë• 20 a 50 pacientes' },
                        { text: 'üè• Mais de 50 pacientes' }
                    ]
                },
                fitness: {
                    question: 'Voc√™ d√° treino presencial ou online?',
                    suggestions: [
                        { text: 'üèãÔ∏è S√≥ presencial' },
                        { text: 'üì± S√≥ online' },
                        { text: 'üéØ Presencial e online' }
                    ]
                },
                bemestar: {
                    question: 'Voc√™ trabalha em espa√ßo pr√≥prio ou vai at√© o cliente?',
                    suggestions: [
                        { text: 'üè† Tenho meu espa√ßo' },
                        { text: 'üöó Vou at√© o cliente' },
                        { text: 'üéØ Os dois' }
                    ]
                },
                nutricao: {
                    question: 'Voc√™ faz consulta presencial ou online?',
                    suggestions: [
                        { text: 'üè• S√≥ presencial' },
                        { text: 'üì± J√° atendo online tamb√©m' },
                        { text: 'üí° Quero come√ßar online' }
                    ]
                },
                mental: {
                    question: 'Voc√™ atende online tamb√©m?',
                    suggestions: [
                        { text: 'üì± Sim, j√° atendo online' },
                        { text: 'üè• S√≥ presencial por enquanto' },
                        { text: 'üí° Quero come√ßar online' }
                    ]
                },
                default: {
                    question: 'Voc√™ j√° agenda pacientes/clientes de alguma forma?',
                    suggestions: [
                        { text: 'üì± Pelo WhatsApp' },
                        { text: 'üìû Por telefone' },
                        { text: 'üìã Uso um sistema' }
                    ]
                }
            },
            // GEST√ÉO
            gestao: {
                beleza: {
                    question: 'Quantos profissionais trabalham com voc√™?',
                    suggestions: [
                        { text: 'üë§ S√≥ eu' },
                        { text: 'üë• 2 a 5 pessoas' },
                        { text: 'üè¢ Mais de 5 pessoas' }
                    ]
                },
                pet: {
                    question: 'Tem banho e tosa ou s√≥ vendas?',
                    suggestions: [
                        { text: 'üõÅ Tem banho e tosa' },
                        { text: 'üõí S√≥ vendas' },
                        { text: 'üêï Completo com veterin√°rio' }
                    ]
                },
                automotivo: {
                    question: 'Quantos ve√≠culos voc√™ atende por dia mais ou menos?',
                    suggestions: [
                        { text: 'üöó At√© 10 por dia' },
                        { text: 'üöô 10 a 30 por dia' },
                        { text: 'üöõ Mais de 30 por dia' }
                    ]
                },
                casa: {
                    question: 'Voc√™ tem equipe ou trabalha sozinho?',
                    suggestions: [
                        { text: 'üë§ Trabalho sozinho' },
                        { text: 'üë• Tenho ajudantes' },
                        { text: 'üè¢ Tenho uma empresa' }
                    ]
                },
                profissionais: {
                    question: 'Voc√™ precisa gerenciar clientes e processos?',
                    suggestions: [
                        { text: 'üë• Muitos clientes' },
                        { text: 'üìã Muitos processos/projetos' },
                        { text: 'üéØ Os dois' }
                    ]
                },
                empresarial: {
                    question: 'Qual o tamanho da sua empresa?',
                    suggestions: [
                        { text: 'üë§ S√≥ eu (MEI)' },
                        { text: 'üë• Pequena (at√© 20 pessoas)' },
                        { text: 'üè¢ M√©dia/Grande' }
                    ]
                },
                sistemas: {
                    question: 'Voc√™ j√° usa algum sistema hoje?',
                    suggestions: [
                        { text: 'üìä Uso planilhas/Excel' },
                        { text: 'üíª Tenho um sistema, mas √© ruim' },
                        { text: '‚ùå N√£o uso nada' }
                    ]
                },
                agendamento: {
                    question: 'Como voc√™ agenda seus clientes hoje?',
                    suggestions: [
                        { text: 'üì± Pelo WhatsApp' },
                        { text: 'üìû Por telefone' },
                        { text: 'üìã Caderno/Agenda f√≠sica' }
                    ]
                },
                default: {
                    question: 'O que mais te d√° trabalho pra organizar?',
                    suggestions: [
                        { text: 'üìÖ Agendamentos' },
                        { text: 'üí∞ Finan√ßas e cobran√ßas' },
                        { text: 'üë• Clientes e vendas' }
                    ]
                }
            }
        };

        // Fun√ß√£o auxiliar para obter pergunta do nicho
        function getNicheQuestion(category, subcategory) {
            const categoryQuestions = nicheQuestions[category];
            if (!categoryQuestions) return null;

            // Tenta pegar pergunta espec√≠fica da subcategoria
            if (subcategory && categoryQuestions[subcategory]) {
                return categoryQuestions[subcategory];
            }

            // Fallback para pergunta default da categoria
            return categoryQuestions.default || null;
        }

        // Gerar resposta contextual - FLUXO CONSULTIVO
        function generateContextualResponse(message) {
            const userName = conversationState.userName || 'voc√™';
            const step = conversationState.conversationStep;
            const lowerMsg = message.toLowerCase();
            const appType = conversationState.userInfo.appType || null;

            // ================================
            // DETEC√á√ÉO INTELIGENTE DE PERGUNTAS
            // ================================

            // Fun√ß√£o auxiliar para continuar o fluxo ap√≥s responder
            function getSuggestionsByStep(currentStep) {
                if (currentStep === 'app_type') {
                    return [
                        { text: 'üöó App de delivery' },
                        { text: 'üõí E-commerce' },
                        { text: 'üìö Educa√ß√£o' },
                        { text: 'üíö Sa√∫de & Bem-estar' },
                        { text: 'üíº Gest√£o empresarial' }
                    ];
                } else if (currentStep === 'niche_detail' || currentStep === 'objective') {
                    return [
                        { text: 'üå± Come√ßar simples e ir crescendo' },
                        { text: 'üöÄ J√° quero algo completo' },
                        { text: 'üëë Quero o melhor do mercado' }
                    ];
                } else if (currentStep === 'timeline') {
                    return [
                        { text: '‚ö° O mais r√°pido poss√≠vel' },
                        { text: 'üìÖ Tenho 1 ou 2 meses' },
                        { text: 'üòä Sem pressa' }
                    ];
                } else if (currentStep === 'budget') {
                    return [
                        { text: 'üí∞ At√© R$ 15 mil' },
                        { text: 'üí∞üí∞ Entre R$ 15 e 25 mil' },
                        { text: 'üí∞üí∞üí∞ Mais de R$ 25 mil' }
                    ];
                }
                return [{ text: 'üëç Entendi, vamos continuar' }];
            }

            // ================================
            // SISTEMA DE DETEC√á√ÉO INTELIGENTE
            // Usa keywords-chat.js com 500+ varia√ß√µes por categoria
            // ================================

            const intentMatch = typeof detectChatIntent === 'function' ? detectChatIntent(message) : null;

            if (intentMatch) {
                const intentResponses = {
                    // 1. DIFERENCIAIS
                    diferenciais: {
                        message: `Boa pergunta, ${userName}! üéØ<br><br>O que nos diferencia:<br><br>` +
                            `<strong>üö´ Sem mensalidade</strong> - Paga uma vez e o app √© seu. Outras empresas cobram R$ 500-2.000/m√™s pra sempre.<br><br>` +
                            `<strong>üõ°Ô∏è 5 anos de suporte inclu√≠do</strong> - Hospedagem, atualiza√ß√µes e manuten√ß√£o por 5 anos sem custo extra.<br><br>` +
                            `<strong>üì± Apps 100% nativos</strong> - iOS e Android nativos (n√£o √© PWA nem h√≠brido), performance real de app de verdade.<br><br>` +
                            `<strong>¬ÆÔ∏è Registro de marca no INPI</strong> - Protegemos legalmente sua marca, inclu√≠do no investimento.<br><br>` +
                            `<strong>üìú Conformidade LGPD</strong> - Seu app j√° nasce em conformidade com a lei.<br><br>` +
                            `<strong>‚ö° Entrega em at√© 65 dias</strong> - Outras empresas levam 6-12 meses.<br><br>` +
                            `E a√≠, quer continuar e ver as op√ß√µes?`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 2. FEATURES / FUNCIONALIDADES
                    features: {
                        message: appType ?
                            `Claro, ${userName}! üõ†Ô∏è<br><br>Para um app de <strong>${appType}</strong>, voc√™ pode ter:<br><br>` +
                            `<strong>No pacote b√°sico:</strong><br>` +
                            `‚Ä¢ Cadastro de usu√°rios<br>‚Ä¢ Cat√°logo de produtos/servi√ßos<br>‚Ä¢ Carrinho e checkout b√°sico<br>‚Ä¢ Notifica√ß√µes push<br><br>` +
                            `<strong>Nos pacotes maiores, voc√™ ganha:</strong><br>` +
                            `‚Ä¢ Painel administrativo completo<br>‚Ä¢ Relat√≥rios e m√©tricas<br>‚Ä¢ Programa de fidelidade<br>‚Ä¢ Integra√ß√µes (pagamento, frete, etc.)<br>‚Ä¢ Chat integrado<br>‚Ä¢ Multi-idiomas<br><br>` +
                            `E se precisar de algo espec√≠fico que n√£o t√° listado, a gente pode fazer! üòâ<br><br>Quer ver os pacotes dispon√≠veis?`
                            :
                            `Claro, ${userName}! üõ†Ô∏è<br><br>Nossos apps s√£o <strong>100% personaliz√°veis</strong>. Voc√™ pode adicionar qualquer funcionalidade que precisar!<br><br>` +
                            `<strong>Exemplos do que j√° fizemos:</strong><br>` +
                            `‚Ä¢ Sistema de delivery com rastreamento<br>‚Ä¢ Cat√°logo com filtros avan√ßados<br>‚Ä¢ Programa de fidelidade e cupons<br>‚Ä¢ Chat e suporte integrado<br>‚Ä¢ M√∫ltiplos meios de pagamento<br>‚Ä¢ Relat√≥rios e dashboards<br>‚Ä¢ E muito mais...<br><br>` +
                            `Me conta que tipo de app voc√™ quer criar e eu mostro o que podemos incluir!`,
                        suggestions: appType ? [{ text: 'üëç Quero ver os pacotes' }, { text: 'ü§î Tenho uma d√∫vida espec√≠fica' }] : getSuggestionsByStep('app_type')
                    },

                    // 3. GARANTIA
                    garantia: {
                        message: `Entendo sua preocupa√ß√£o, ${userName}! üõ°Ô∏è<br><br>` +
                            `<strong>Temos garantia total de 30 dias:</strong><br>` +
                            `Se voc√™ n√£o ficar 100% satisfeito, devolvemos <strong>100% do valor</strong> sem perguntas.<br><br>` +
                            `<strong>Mais seguran√ßa:</strong><br>` +
                            `‚Ä¢ 847 apps entregues com sucesso<br>` +
                            `‚Ä¢ Avalia√ß√£o m√©dia de 4.9/5.0<br>` +
                            `‚Ä¢ 5 anos de suporte inclu√≠do<br>` +
                            `‚Ä¢ Contrato formal com todas as garantias<br><br>` +
                            `Voc√™ n√£o corre risco nenhum. üòä`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 4. PAGAMENTO
                    pagamento: {
                        message: `Vou te explicar as op√ß√µes, ${userName}! üí≥<br><br>` +
                            `<strong>Formas de pagamento:</strong><br><br>` +
                            `‚Ä¢ <strong>PIX ou transfer√™ncia:</strong> 10% de desconto<br>` +
                            `‚Ä¢ <strong>Cart√£o de cr√©dito:</strong> at√© 12x sem juros<br>` +
                            `‚Ä¢ <strong>Por etapas:</strong> Voc√™ paga conforme entregamos (ex: 30% in√≠cio, 40% meio, 30% final)<br><br>` +
                            `A melhor op√ß√£o √© combinar direto com nosso time pelo WhatsApp! üòâ`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 5. PUBLICA√á√ÉO
                    publicacao: {
                        message: `Boa pergunta, ${userName}! üì≤<br><br>` +
                            `<strong>Sim, publicamos o app nas lojas!</strong><br><br>` +
                            `‚úÖ <strong>Google Play Store</strong> (Android)<br>` +
                            `‚úÖ <strong>Apple App Store</strong> (iOS)<br><br>` +
                            `Cuidamos de todo o processo de publica√ß√£o, incluindo:<br>` +
                            `‚Ä¢ Cria√ß√£o das contas de desenvolvedor<br>` +
                            `‚Ä¢ Envio do app para revis√£o<br>` +
                            `‚Ä¢ Ajustes se a loja pedir algo<br>` +
                            `‚Ä¢ Suporte para atualiza√ß√µes futuras<br><br>` +
                            `Seu app vai aparecer nas lojas com sua marca! üéâ`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 6. MANUTEN√á√ÉO
                    manutencao: {
                        message: `Pode ficar tranquilo, ${userName}! üõ°Ô∏è<br><br>` +
                            `<strong>5 anos de suporte inclu√≠do no investimento:</strong><br><br>` +
                            `‚úÖ <strong>Hospedagem:</strong> Servidores de alta performance<br>` +
                            `‚úÖ <strong>Manuten√ß√£o:</strong> Corre√ß√£o de bugs e problemas<br>` +
                            `‚úÖ <strong>Atualiza√ß√µes:</strong> Compatibilidade com novos iOS/Android<br>` +
                            `‚úÖ <strong>Suporte:</strong> Atendimento por WhatsApp e email<br><br>` +
                            `Voc√™ n√£o paga nada extra por 5 anos. Depois desse per√≠odo, oferecemos planos de manuten√ß√£o bem acess√≠veis.`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 7. PROCESSO
                    processo: {
                        message: `Vou te explicar, ${userName}! üìã<br><br>` +
                            `<strong>Nosso processo √© bem simples:</strong><br><br>` +
                            `<strong>1Ô∏è‚É£ Conversa inicial</strong> (√© o que estamos fazendo agora!)<br>` +
                            `Entendemos o que voc√™ precisa.<br><br>` +
                            `<strong>2Ô∏è‚É£ Proposta personalizada</strong><br>` +
                            `Enviamos proposta com pre√ßo, prazo e tudo que est√° inclu√≠do.<br><br>` +
                            `<strong>3Ô∏è‚É£ Aprova√ß√£o e in√≠cio</strong><br>` +
                            `Voc√™ aprova, assinamos contrato e come√ßamos em at√© 48h.<br><br>` +
                            `<strong>4Ô∏è‚É£ Desenvolvimento</strong><br>` +
                            `Voc√™ acompanha o progresso e valida cada etapa.<br><br>` +
                            `<strong>5Ô∏è‚É£ Entrega e publica√ß√£o</strong><br>` +
                            `App pronto, publicado nas lojas e sua equipe treinada!`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 8. MIGRA√á√ÉO
                    migracao: {
                        message: `Entendi, ${userName}! üîÑ<br><br>` +
                            `<strong>Sim, fazemos migra√ß√£o de apps!</strong><br><br>` +
                            `Se voc√™ j√° tem um app e quer:<br>` +
                            `‚Ä¢ Melhorar a performance<br>` +
                            `‚Ä¢ Adicionar novas funcionalidades<br>` +
                            `‚Ä¢ Mudar de plataforma<br>` +
                            `‚Ä¢ Redesenhar a interface<br><br>` +
                            `A gente pode ajudar! O processo √© o mesmo: analisamos o que voc√™ tem, vemos o que precisa melhorar e criamos uma vers√£o nova e melhor.<br><br>` +
                            `Me conta mais sobre seu app atual?`,
                        suggestions: [
                            { text: 'üì± Meu app est√° desatualizado' },
                            { text: 'üêå Meu app est√° lento' },
                            { text: '‚ú® Quero adicionar features novas' },
                            { text: 'üîÑ Quero refazer do zero' }
                        ]
                    },

                    // 9. PORTF√ìLIO
                    portfolio: {
                        message: `Claro, ${userName}! üì±<br><br>` +
                            `<strong>J√° criamos 847 apps!</strong> Alguns exemplos:<br><br>` +
                            `üçï <strong>Delivery:</strong> Pizzaria que saiu de 50 para 800 entregas/dia<br><br>` +
                            `üõí <strong>E-commerce:</strong> Loja que parou de pagar 25% pro marketplace<br><br>` +
                            `üìö <strong>Educa√ß√£o:</strong> Curso que migrou da Hotmart e economiza R$ 15k/m√™s<br><br>` +
                            `üí™ <strong>Sa√∫de:</strong> Academia com app de treinos e agendamento<br><br>` +
                            `Quer ver nosso portf√≥lio completo? Posso enviar pelo WhatsApp!`,
                        suggestions: [
                            { text: 'üì± Quero ver o portf√≥lio' },
                            { text: 'üëç Entendi, vamos continuar' }
                        ]
                    },

                    // 10. CONCORRENTES
                    concorrentes: {
                        message: `Esse √© exatamente o motivo de existirmos, ${userName}! üí™<br><br>` +
                            `<strong>Com app pr√≥prio voc√™:</strong><br><br>` +
                            `‚úÖ <strong>Fica com 100% do lucro</strong> - Sem pagar 27-30% de taxa<br>` +
                            `‚úÖ <strong>√â dono dos dados</strong> - Seus clientes s√£o SEUS, n√£o da plataforma<br>` +
                            `‚úÖ <strong>Cria sua marca</strong> - O app tem sua cara, n√£o a do marketplace<br>` +
                            `‚úÖ <strong>Controla tudo</strong> - Pre√ßos, promo√ß√µes, programa de fidelidade...<br><br>` +
                            `<strong>Exemplo real:</strong> Uma pizzaria com 100 entregas/dia economiza <strong>R$ 40.500/m√™s</strong> saindo do iFood! ü§Ø`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 11. TECNOLOGIA
                    tecnologia: {
                        message: `√ìtima pergunta t√©cnica, ${userName}! üíª<br><br>` +
                            `<strong>Tecnologias que usamos:</strong><br><br>` +
                            `üì± <strong>Apps:</strong> Swift (iOS) e Kotlin (Android) - 100% nativos, n√£o usamos h√≠bridos<br><br>` +
                            `üñ•Ô∏è <strong>Backend:</strong> Node.js ou Python, dependendo do projeto<br><br>` +
                            `‚òÅÔ∏è <strong>Cloud:</strong> AWS ou Google Cloud para m√°xima performance<br><br>` +
                            `üóÑÔ∏è <strong>Banco:</strong> PostgreSQL, MongoDB ou Firebase<br><br>` +
                            `Apps nativos t√™m <strong>melhor performance, mais seguran√ßa</strong> e acesso a todas as funcionalidades do celular (c√¢mera, GPS, notifica√ß√µes, etc).`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 12. EQUIPE
                    equipe: {
                        message: `Prazer em me apresentar, ${userName}! üëã<br><br>` +
                            `<strong>Sobre a Evo:</strong><br><br>` +
                            `‚Ä¢ Somos uma empresa brasileira especializada em apps<br>` +
                            `‚Ä¢ Equipe de +15 desenvolvedores especializados<br>` +
                            `‚Ä¢ 847 apps entregues com sucesso<br>` +
                            `‚Ä¢ Avalia√ß√£o m√©dia de 4.9/5.0<br>` +
                            `‚Ä¢ Atendemos todo o Brasil (100% online)<br><br>` +
                            `Nosso foco √© criar apps de verdade, n√£o solu√ß√µes gen√©ricas. Cada projeto √© √∫nico! üöÄ`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 13. SAUDA√á√ïES
                    saudacoes: {
                        message: `Ol√°, ${userName}! üòä<br><br>Que bom ter voc√™ aqui! Sou a IA da Evo e vou te ajudar a descobrir o app perfeito pro seu neg√≥cio.<br><br>Me conta: <strong>que tipo de app voc√™ quer criar?</strong>`,
                        suggestions: getSuggestionsByStep('app_type'),
                        condition: () => step === 'app_type' && lowerMsg.length < 30
                    },

                    // 14. AGRADECIMENTOS
                    agradecimentos: {
                        message: `Por nada, ${userName}! üòä<br><br>Estou aqui pra ajudar! Se tiver mais alguma d√∫vida, √© s√≥ perguntar.<br><br>Quer continuar explorando as op√ß√µes de app?`,
                        suggestions: getSuggestionsByStep(step)
                    },

                    // 15. D√öVIDAS
                    duvidas: {
                        message: `Claro, ${userName}! üòä<br><br>` +
                            `Pode mandar sua d√∫vida que eu te ajudo!<br><br>` +
                            `Mas olha, se voc√™ falar agora com nosso time no WhatsApp, temos uma <strong>condi√ß√£o especial</strong> pra quem veio pelo chat! üéÅ<br><br>` +
                            `A gente quer te ajudar a realizar seu sonho de ter um app pr√≥prio. üíô`,
                        suggestions: [
                            { text: 'üéÅ Quero a condi√ß√£o especial!' },
                            { text: 'üí∞ Quanto custa?' },
                            { text: '‚è±Ô∏è Quanto tempo leva?' },
                            { text: 'üõ°Ô∏è Tem garantia?' }
                        ],
                        condition: () => lowerMsg.length < 50
                    },

                    // 16. CONTATO
                    contato: {
                        message: `√ìtima escolha, ${userName}! üéâ<br><br>` +
                            `Nosso time est√° pronto pra te ajudar a <strong>realizar o sonho do seu app pr√≥prio!</strong><br><br>` +
                            `E tenho uma boa not√≠cia: quem vem pelo chat tem <strong>condi√ß√£o especial</strong>. üéÅ<br><br>` +
                            `Clica no bot√£o e fala com a gente agora!`,
                        suggestions: [
                            { text: 'üì± Falar no WhatsApp e garantir oferta' },
                            { text: 'ü§ñ Prefiro continuar com a IA' }
                        ]
                    },

                    // 17. NEGATIVAS
                    negativas: {
                        message: `Ei ${userName}, espera! üôã<br><br>` +
                            `Antes de ir, deixa eu te contar: temos uma <strong>oferta especial</strong> pra quem chegou at√© aqui! üéÅ<br><br>` +
                            `A gente sabe que criar um app √© um sonho grande, e queremos te ajudar a realizar. üíô<br><br>` +
                            `Que tal falar rapidinho com nosso time no WhatsApp? Sem compromisso, s√≥ pra voc√™ conhecer a condi√ß√£o especial!`,
                        suggestions: [
                            { text: 'üéÅ Ver oferta especial no WhatsApp' },
                            { text: 'üîÑ Mudei de ideia, vamos continuar' },
                            { text: 'üìã Me manda um resumo por WhatsApp' }
                        ]
                    },

                    // 18. POSITIVAS
                    positivas: {
                        message: (() => {
                            const stepMessages = {
                                'app_type': 'Que tipo de app voc√™ quer criar?',
                                'niche_detail': 'Me conta mais sobre seu neg√≥cio...',
                                'objective': 'O que voc√™ quer alcan√ßar com o app?',
                                'timeline': 'Pra quando voc√™ precisa do app pronto?',
                                'differentials': 'O que √© mais importante pra voc√™ no app?',
                                'budget': 'Quanto voc√™ pensa em investir?'
                            };
                            return `√ìtimo, ${userName}! üéâ<br><br>${stepMessages[step] || 'Vamos continuar! Que tipo de app voc√™ quer criar?'}`;
                        })(),
                        suggestions: getSuggestionsByStep(step),
                        condition: () => lowerMsg.length < 20
                    },

                    // 19. CONTRATUAL / PROPRIEDADE
                    contratual: {
                        message: `√ìtima pergunta, ${userName}! üìú<br><br>` +
                            `<strong>Sim! O app e o c√≥digo fonte s√£o 100% seus!</strong><br><br>` +
                            `‚úÖ <strong>Propriedade total</strong> - Voc√™ √© dono do app, do c√≥digo fonte e de todos os dados<br><br>` +
                            `‚úÖ <strong>C√≥digo fonte entregue</strong> - Ao final do projeto, entregamos todo o c√≥digo para voc√™<br><br>` +
                            `‚úÖ <strong>Sem depend√™ncia</strong> - Se quiser, pode contratar outro time para manuten√ß√£o futura<br><br>` +
                            `‚úÖ <strong>Contrato formal</strong> - Tudo documentado juridicamente, garantindo seus direitos<br><br>` +
                            `‚úÖ <strong>NDA dispon√≠vel</strong> - Se precisar, assinamos acordo de confidencialidade<br><br>` +
                            `Nada de licenciamento ou mensalidades para usar o que √© seu! üí™`,
                        suggestions: getSuggestionsByStep(step)
                    }
                };

                // Verificar se tem resposta para a inten√ß√£o detectada
                const response = intentResponses[intentMatch.intent];
                if (response) {
                    // Verificar condi√ß√£o especial (se existir)
                    if (response.condition && !response.condition()) {
                        // Condi√ß√£o n√£o atendida, continuar para detec√ß√£o de categoria
                    } else {
                        return {
                            message: response.message,
                            suggestions: response.suggestions
                        };
                    }
                }
            }

            // ================================
            // STEP 1: IDENTIFICAR TIPO DE APP
            // ================================
            if (step === 'app_type') {
                const detection = detectCategory(message);

                if (detection.category) {
                    const categoryMap = {
                        delivery: { type: 'Delivery', key: 'delivery', emoji: 'üçï', msg: 'Apps de delivery s√£o super procurados!' },
                        ecommerce: { type: 'E-commerce', key: 'ecommerce', emoji: 'üõí', msg: 'E-commerce √© uma das √°reas que mais crescem!' },
                        educacao: { type: 'Educa√ß√£o', key: 'educacao', emoji: 'üìö', msg: 'Educa√ß√£o digital t√° em alta!' },
                        saude: { type: 'Sa√∫de', key: 'saude', emoji: 'üíö', msg: 'Apps de sa√∫de s√£o muito importantes!' },
                        gestao: { type: 'Gest√£o', key: 'gestao', emoji: 'üíº', msg: 'Gest√£o empresarial √© essencial pra qualquer neg√≥cio!' },
                        fitness: { type: 'Fitness', key: 'fitness', emoji: 'üí™', msg: 'Apps fitness est√£o bombando!' },
                        imobiliario: { type: 'Imobili√°rio', key: 'imobiliario', emoji: 'üè†', msg: 'O mercado imobili√°rio digital cresce muito!' },
                        servicos: { type: 'Servi√ßos', key: 'servicos', emoji: '‚úÇÔ∏è', msg: 'Agendamento online √© tend√™ncia!' },
                        financas: { type: 'Finan√ßas', key: 'financas', emoji: 'üí∞', msg: 'Fintech √© um dos mercados que mais cresce!' },
                        social: { type: 'Social', key: 'social', emoji: 'üë•', msg: 'Comunidades online est√£o em alta!' },
                        transporte: { type: 'Transporte', key: 'transporte', emoji: 'üöó', msg: 'Mobilidade urbana √© super importante!' },
                        pets: { type: 'Pets', key: 'pets', emoji: 'üêæ', msg: 'Mercado pet n√£o para de crescer!' },
                        entretenimento: { type: 'Entretenimento', key: 'entretenimento', emoji: 'üé¨', msg: 'Streaming √© o futuro do entretenimento!' },
                        viagens: { type: 'Viagens', key: 'viagens', emoji: '‚úàÔ∏è', msg: 'Turismo digital est√° em alta!' },
                        beleza: { type: 'Beleza', key: 'beleza', emoji: 'üíÑ', msg: 'Mercado de beleza nunca para!' }
                    };

                    const cat = categoryMap[detection.category];
                    conversationState.userInfo.appType = cat.type;
                    conversationState.userInfo.appTypeKey = cat.key;

                    // Detectar nicho espec√≠fico usando 1000+ keywords
                    const nicheMatch = detectSpecificNiche(message, detection.category);
                    if (nicheMatch) {
                        conversationState.userInfo.detectedNiche = nicheMatch.keyword;
                        conversationState.userInfo.nicheSubcategory = nicheMatch.subcategory;
                    }

                    // Ir para pergunta espec√≠fica do nicho
                    conversationState.conversationStep = 'niche_detail';
                    updateProgress(1, 'Etapa 1 de 5: Conhecendo seu neg√≥cio');

                    // Pegar pergunta espec√≠fica do nicho detectado
                    const nicheQ = getNicheQuestion(cat.key, conversationState.userInfo.nicheSubcategory);

                    // Personalizar mensagem se detectou nicho espec√≠fico
                    let nicheMsg = '';
                    if (nicheMatch && nicheMatch.keyword) {
                        const keywordCapitalized = nicheMatch.keyword.charAt(0).toUpperCase() + nicheMatch.keyword.slice(1);
                        nicheMsg = `<br><br>Vi que voc√™ mencionou <strong>${keywordCapitalized}</strong>. `;
                    }

                    return {
                        message: `Legal, ${userName}! ${cat.emoji} ${cat.msg}${nicheMsg}<br><br>${nicheQ ? nicheQ.question : 'Me conta mais sobre seu neg√≥cio?'}`,
                        suggestions: nicheQ ? nicheQ.suggestions : [
                            { text: 'üÜï Estou come√ßando agora' },
                            { text: 'üìà J√° tenho um neg√≥cio funcionando' },
                            { text: 'üöÄ Quero expandir o que j√° existe' }
                        ]
                    };
                }

                // N√£o identificou - pedir tipo de app
                return {
                    message: `Entendi, ${userName}! üòä<br><br>Que tipo de aplicativo voc√™ t√° pensando em criar?`,
                    suggestions: [
                        { text: 'üöó App de delivery' },
                        { text: 'üõí E-commerce' },
                        { text: 'üìö Educa√ß√£o' },
                        { text: 'üíö Sa√∫de & Bem-estar' },
                        { text: 'üíº Gest√£o empresarial' },
                        { text: 'üéØ Outro tipo de app' }
                    ]
                };
            }

            // ================================
            // STEP 2: DETALHES DO NICHO (NOVO!)
            // ================================
            if (step === 'niche_detail') {
                // Salvar resposta do contexto do nicho
                conversationState.userInfo.businessContext = message;
                conversationState.conversationStep = 'objective';
                updateProgress(2, 'Etapa 2 de 5: Entendendo seu objetivo');

                return {
                    message: `Entendi! üëç<br><br>E o que voc√™ quer alcan√ßar com o app, ${userName}?`,
                    suggestions: [
                        { text: 'üå± Come√ßar simples e ir crescendo' },
                        { text: 'üöÄ J√° quero algo completo' },
                        { text: 'üëë Quero o melhor do mercado' }
                    ]
                };
            }

            // ================================
            // STEP 3: OBJETIVO DO APP
            // ================================
            if (step === 'objective') {
                // Capturar objetivo
                if (message.includes('simples') || message.includes('crescendo')) {
                    conversationState.userInfo.objective = 'simples';
                } else if (message.includes('completo')) {
                    conversationState.userInfo.objective = 'completo';
                } else if (message.includes('melhor')) {
                    conversationState.userInfo.objective = 'premium';
                } else {
                    conversationState.userInfo.objective = 'geral';
                }

                conversationState.conversationStep = 'timeline';
                updateProgress(3, 'Etapa 3 de 5: Entendendo prazos');

                return {
                    message: `Boa, ${userName}! üëç<br><br>Pra quando voc√™ precisa do app pronto?`,
                    suggestions: [
                        { text: '‚ö° O mais r√°pido poss√≠vel' },
                        { text: 'üìÖ Tenho 1 ou 2 meses' },
                        { text: 'üòä Sem pressa' }
                    ]
                };
            }

            // ================================
            // STEP 4: PRAZO
            // ================================
            if (step === 'timeline') {
                conversationState.userInfo.timeline = message;
                conversationState.conversationStep = 'differentials';
                updateProgress(4, 'Etapa 4 de 5: Mais um detalhe');

                // Perguntas de diferencial baseadas no tipo de app
                const differentialQuestions = {
                    delivery: {
                        question: 'O que √© mais importante pra voc√™ no app?',
                        suggestions: [
                            { text: 'üìä Controlar os pedidos direitinho' },
                            { text: 'üí≥ Receber pagamentos online' },
                            { text: 'üì± Ter meu app igual os grandes' }
                        ]
                    },
                    ecommerce: {
                        question: 'O que voc√™ mais precisa no seu app?',
                        suggestions: [
                            { text: 'üõí Carrinho e pagamento f√°cil' },
                            { text: 'üì¶ Controle de estoque' },
                            { text: 'üì± Aparecer bonito pro cliente' }
                        ]
                    },
                    educacao: {
                        question: 'O que √© mais importante pra voc√™?',
                        suggestions: [
                            { text: 'üìπ √Årea de v√≠deos e aulas' },
                            { text: 'üìù Provas e exerc√≠cios' },
                            { text: 'üí¨ Chat com os alunos' }
                        ]
                    },
                    saude: {
                        question: 'O que n√£o pode faltar no seu app?',
                        suggestions: [
                            { text: 'üìÖ Agendamento de consultas' },
                            { text: 'üìã Ficha do paciente/cliente' },
                            { text: 'üí≥ Pagamento online' }
                        ]
                    },
                    gestao: {
                        question: 'O que voc√™ mais quer resolver?',
                        suggestions: [
                            { text: 'üìÖ Organizar agendamentos' },
                            { text: 'üí∞ Controlar dinheiro' },
                            { text: 'üë• Gerenciar clientes' }
                        ]
                    }
                };

                const appKey = conversationState.userInfo.appTypeKey || 'delivery';
                const ctx = differentialQuestions[appKey];

                return {
                    message: `Anotado! ‚úçÔ∏è<br><br>${ctx.question}`,
                    suggestions: ctx.suggestions
                };
            }

            // ================================
            // STEP 5: DIFERENCIAIS ‚Üí OR√áAMENTO
            // ================================
            if (step === 'differentials') {
                conversationState.userInfo.differentials.push(message);
                conversationState.conversationStep = 'budget';
                updateProgress(5, 'Etapa 5 de 5: √öltima pergunta!');

                return {
                    message: `√ìtimo, ${userName}! üòä<br><br>√öltima pergunta: quanto voc√™ pensa em investir?`,
                    suggestions: [
                        { text: 'üí∞ At√© R$ 15 mil' },
                        { text: 'üí∞üí∞ Entre R$ 15 e 25 mil' },
                        { text: 'üí∞üí∞üí∞ Mais de R$ 25 mil' },
                        { text: 'ü§î N√£o sei ainda' }
                    ]
                };
            }

            // ================================
            // STEP 6: OR√áAMENTO ‚Üí MOSTRAR PACOTES
            // ================================
            if (step === 'budget') {
                conversationState.userInfo.budget = message;
                conversationState.conversationStep = 'packages';
                updateProgress(5, 'Preparando op√ß√µes...');

                // Determinar pacote recomendado baseado nas respostas
                let recommendedPackage = 'pro'; // default
                const objective = conversationState.userInfo.objective;
                const budget = message;

                if (objective === 'simples' || budget.includes('At√© R$ 15')) {
                    recommendedPackage = 'basic';
                } else if (objective === 'premium' || budget.includes('Mais de R$ 25')) {
                    recommendedPackage = 'enterprise';
                }

                conversationState.userInfo.recommendedPackage = recommendedPackage;

                // Mostrar pacotes ap√≥s a mensagem
                const appKey = conversationState.userInfo.appTypeKey || 'delivery';
                setTimeout(() => {
                    showPackages(appKey);
                }, 1000);

                return {
                    message: `Pronto, ${userName}! üéâ<br><br>Separei 3 op√ß√µes pra voc√™ escolher:`,
                    suggestions: []
                };
            }

            // ================================
            // RESPOSTA PADR√ÉO
            // ================================
            return {
                message: `Entendi, ${userName}! üòä<br><br>Que tipo de aplicativo voc√™ t√° pensando em criar?`,
                suggestions: [
                    { text: 'üçï Delivery' },
                    { text: 'üõí E-commerce' },
                    { text: 'üìö Educa√ß√£o' },
                    { text: 'üíö Sa√∫de' },
                    { text: 'üíº Gest√£o' },
                    { text: 'üí™ Fitness' },
                    { text: 'üè† Imobili√°rio' },
                    { text: '‚úÇÔ∏è Servi√ßos' },
                    { text: 'üí∞ Finan√ßas' },
                    { text: 'üë• Social' },
                    { text: 'üöó Transporte' },
                    { text: 'üêæ Pets' },
                    { text: 'üé¨ Entretenimento' },
                    { text: '‚úàÔ∏è Viagens' },
                    { text: 'üíÑ Beleza' },
                    { text: 'üéØ Outro' }
                ]
            };
        }

        // A√ß√£o r√°pida - INTEGRADA COM FLUXO DO CHAT
        function quickAction(action) {
            conversationState.messageCount++;
            const userName = conversationState.userName || 'voc√™';
            const appType = conversationState.userInfo.appType || null;
            const step = conversationState.conversationStep;

            // Pegar o texto do bot√£o clicado
            const buttonText = document.querySelector(`[onclick*="'${action}'"]`)?.textContent.trim() || action;
            addUserMessage(buttonText);

            let response;

            // Respostas contextuais baseadas no estado da conversa
            if (action === 'prazo') {
                if (appType) {
                    response = {
                        message: `Boa pergunta, ${userName}! ‚ö°<br><br>Para um app de <strong>${appType}</strong>, o prazo varia:<br><br>‚Ä¢ Pacote B√°sico: <strong>15-25 dias</strong><br>‚Ä¢ Pacote Profissional: <strong>25-40 dias</strong><br>‚Ä¢ Pacote Completo: <strong>40-65 dias</strong><br><br>Qual prazo funciona melhor pra voc√™?`,
                        suggestions: [
                            { text: '‚ö° O mais r√°pido poss√≠vel' },
                            { text: 'üìÖ Tenho 1 ou 2 meses' },
                            { text: 'üòä Sem pressa' }
                        ]
                    };
                    // Avan√ßar para pr√≥ximo passo se ainda n√£o passou
                    if (step === 'objective' || step === 'niche_detail') {
                        conversationState.conversationStep = 'timeline';
                    }
                } else {
                    response = {
                        message: `Boa pergunta, ${userName}! ‚ö°<br><br>Criamos apps em <strong>15 a 65 dias</strong> dependendo da complexidade.<br><br>Pra te dar um prazo mais preciso, me conta: que tipo de app voc√™ quer criar?`,
                        suggestions: [
                            { text: 'üçï Delivery' },
                            { text: 'üõí E-commerce' },
                            { text: 'üìö Educa√ß√£o' },
                            { text: 'üíö Sa√∫de' },
                            { text: 'üíº Gest√£o' },
                            { text: 'üí™ Fitness' },
                            { text: 'üè† Imobili√°rio' },
                            { text: '‚úÇÔ∏è Servi√ßos' },
                            { text: 'üí∞ Finan√ßas' },
                            { text: 'üë• Social' },
                            { text: 'üöó Transporte' },
                            { text: 'üêæ Pets' },
                            { text: 'üé¨ Entretenimento' },
                            { text: '‚úàÔ∏è Viagens' },
                            { text: 'üíÑ Beleza' }
                        ]
                    };
                }
            } else if (action === 'preco') {
                if (appType) {
                    const priceRanges = {
                        'Delivery': 'R$ 14.000 a R$ 31.500',
                        'E-commerce': 'R$ 13.000 a R$ 29.000',
                        'Educa√ß√£o': 'R$ 12.000 a R$ 27.000',
                        'Sa√∫de & Bem-estar': 'R$ 16.000 a R$ 36.000',
                        'Gest√£o Empresarial': 'R$ 17.500 a R$ 39.000',
                        'Fitness': 'R$ 14.000 a R$ 32.000',
                        'Imobili√°rio': 'R$ 15.000 a R$ 34.000',
                        'Servi√ßos': 'R$ 12.500 a R$ 28.000',
                        'Finan√ßas': 'R$ 16.500 a R$ 37.000',
                        'Social': 'R$ 15.000 a R$ 35.000',
                        'Transporte': 'R$ 16.000 a R$ 36.000',
                        'Pets': 'R$ 13.000 a R$ 30.000',
                        'Entretenimento': 'R$ 15.000 a R$ 35.000',
                        'Viagens': 'R$ 14.500 a R$ 33.000',
                        'Beleza': 'R$ 12.500 a R$ 28.000'
                    };
                    const range = priceRanges[appType] || 'R$ 12.000 a R$ 39.000';
                    response = {
                        message: `Vou te explicar, ${userName}! üí∞<br><br>Para um app de <strong>${appType}</strong>, o investimento fica entre <strong>${range}</strong>.<br><br>Isso inclui:<br>‚úÖ Apps iOS e Android nativos<br>‚úÖ 5 anos de suporte e hospedagem<br>‚úÖ Conformidade LGPD<br>‚úÖ Registro de marca<br><br>Quanto voc√™ pensa em investir?`,
                        suggestions: [
                            { text: 'üí∞ At√© R$ 30 mil' },
                            { text: 'üí∞üí∞ Entre R$ 30 e 50 mil' },
                            { text: 'üí∞üí∞üí∞ Mais de R$ 50 mil' },
                            { text: 'ü§î N√£o sei ainda' }
                        ]
                    };
                    // Avan√ßar para or√ßamento
                    if (step !== 'budget' && step !== 'packages') {
                        conversationState.conversationStep = 'budget';
                    }
                } else {
                    response = {
                        message: `Boa pergunta, ${userName}! üí∞<br><br>O investimento varia de <strong>R$ 12.000 a R$ 39.000</strong> dependendo do tipo de app e funcionalidades.<br><br>Pra te dar um valor mais preciso, me conta: que tipo de app voc√™ quer criar?`,
                        suggestions: [
                            { text: 'üçï Delivery' },
                            { text: 'üõí E-commerce' },
                            { text: 'üìö Educa√ß√£o' },
                            { text: 'üíö Sa√∫de' },
                            { text: 'üíº Gest√£o' },
                            { text: 'üí™ Fitness' },
                            { text: 'üè† Imobili√°rio' },
                            { text: '‚úÇÔ∏è Servi√ßos' },
                            { text: 'üí∞ Finan√ßas' },
                            { text: 'üë• Social' },
                            { text: 'üöó Transporte' },
                            { text: 'üêæ Pets' },
                            { text: 'üé¨ Entretenimento' },
                            { text: '‚úàÔ∏è Viagens' },
                            { text: 'üíÑ Beleza' }
                        ]
                    };
                }
            } else if (action === 'lgpd') {
                response = {
                    message: `Pode ficar tranquilo, ${userName}! üîí<br><br>Todos os nossos apps j√° v√™m <strong>100% conformes com a LGPD</strong>. Isso inclui:<br><br>‚úÖ Pol√≠tica de privacidade personalizada<br>‚úÖ Gest√£o de consentimento<br>‚úÖ Criptografia de dados<br>‚úÖ Direito ao esquecimento<br>‚úÖ Exporta√ß√£o de dados do usu√°rio<br><br>Isso j√° t√° incluso em todos os pacotes, sem custo extra! üòä`,
                    suggestions: step === 'app_type' ? [
                            { text: 'üçï Delivery' },
                            { text: 'üõí E-commerce' },
                            { text: 'üìö Educa√ß√£o' },
                            { text: 'üíö Sa√∫de' },
                            { text: 'üíº Gest√£o' },
                            { text: 'üí™ Fitness' },
                            { text: 'üè† Imobili√°rio' },
                            { text: '‚úÇÔ∏è Servi√ßos' },
                            { text: 'üí∞ Finan√ßas' },
                            { text: 'üë• Social' },
                            { text: 'üöó Transporte' },
                            { text: 'üêæ Pets' },
                            { text: 'üé¨ Entretenimento' },
                            { text: '‚úàÔ∏è Viagens' },
                            { text: 'üíÑ Beleza' }
                        ] : [
                            { text: 'üëç Entendi, vamos continuar' },
                            { text: 'ü§î Tenho outra d√∫vida' }
                        ]
                };
            } else if (action === 'marca') {
                response = {
                    message: `√ìtima preocupa√ß√£o, ${userName}! ¬ÆÔ∏è<br><br>O <strong>registro de marca no INPI</strong> tamb√©m t√° incluso em todos os pacotes!<br><br>üìã Como funciona:<br>‚Ä¢ Fazemos toda a burocracia pra voc√™<br>‚Ä¢ Processo leva 12-18 meses<br>‚Ä¢ Sua marca fica protegida desde o pedido<br>‚Ä¢ V√°lido por 10 anos, renov√°vel<br><br>Voc√™ n√£o precisa se preocupar com nada! üòä`,
                    suggestions: step === 'app_type' ? [
                            { text: 'üçï Delivery' },
                            { text: 'üõí E-commerce' },
                            { text: 'üìö Educa√ß√£o' },
                            { text: 'üíö Sa√∫de' },
                            { text: 'üíº Gest√£o' },
                            { text: 'üí™ Fitness' },
                            { text: 'üè† Imobili√°rio' },
                            { text: '‚úÇÔ∏è Servi√ßos' },
                            { text: 'üí∞ Finan√ßas' },
                            { text: 'üë• Social' },
                            { text: 'üöó Transporte' },
                            { text: 'üêæ Pets' },
                            { text: 'üé¨ Entretenimento' },
                            { text: '‚úàÔ∏è Viagens' },
                            { text: 'üíÑ Beleza' }
                        ] : [
                            { text: 'üëç Entendi, vamos continuar' },
                            { text: 'ü§î Tenho outra d√∫vida' }
                        ]
                };
            } else if (action === 'suporte') {
                response = {
                    message: `Esse √© nosso diferencial, ${userName}! üõ°Ô∏è<br><br>Voc√™ ganha <strong>5 anos de suporte completo</strong> sem pagar nada a mais:<br><br>‚úÖ Hospedagem em nuvem<br>‚úÖ Atualiza√ß√µes de seguran√ßa<br>‚úÖ Corre√ß√£o de bugs<br>‚úÖ Suporte t√©cnico ilimitado<br>‚úÖ Monitoramento 24/7<br>‚úÖ Backup autom√°tico<br><br>E se quiser estender depois, os valores s√£o bem acess√≠veis! üòä`,
                    suggestions: step === 'app_type' ? [
                            { text: 'üçï Delivery' },
                            { text: 'üõí E-commerce' },
                            { text: 'üìö Educa√ß√£o' },
                            { text: 'üíö Sa√∫de' },
                            { text: 'üíº Gest√£o' },
                            { text: 'üí™ Fitness' },
                            { text: 'üè† Imobili√°rio' },
                            { text: '‚úÇÔ∏è Servi√ßos' },
                            { text: 'üí∞ Finan√ßas' },
                            { text: 'üë• Social' },
                            { text: 'üöó Transporte' },
                            { text: 'üêæ Pets' },
                            { text: 'üé¨ Entretenimento' },
                            { text: '‚úàÔ∏è Viagens' },
                            { text: 'üíÑ Beleza' }
                        ] : [
                            { text: 'üëç Entendi, vamos continuar' },
                            { text: 'ü§î Tenho outra d√∫vida' }
                        ]
                };
            }

            const typingTime = getHumanTypingTime(response.message);

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponseDirect(response.message, response.suggestions, true);
                }, typingTime);
            }, 500);
        }

        // Selecionar sugest√£o
        function selectSuggestion(button) {
            const text = button.textContent.trim();

            // Incrementar contador
            conversationState.messageCount++;

            // Capturar informa√ß√µes baseadas na resposta
            if (text.includes('dias') || text.includes('meses')) {
                conversationState.userInfo.timeline = text;
            }
            if (text.includes('R$')) {
                conversationState.userInfo.budget = text;
            }
            if (text.includes('pedidos')) {
                conversationState.userInfo.features.push('Volume: ' + text);
            }

            // SISTEMA INTELIGENTE: Tratar "Outro tipo de app"
            if (text.includes('Outro tipo de app')) {
                addUserMessage(text);
                handleOutroTipoApp();
                return;
            }

            // Tratar confirma√ß√£o de categoria sugerida pela IA
            if (conversationState.lastSuggestedCategory && text.includes('Sim, √© isso')) {
                addUserMessage(text);
                confirmSuggestedCategory();
                return;
            }

            // Tratar rejei√ß√£o de categoria sugerida pela IA
            if (conversationState.lastSuggestedCategory && text.includes('N√£o √© bem isso')) {
                addUserMessage(text);
                rejectSuggestedCategory();
                return;
            }

            // Tratar ofertas especiais e direcionamento para WhatsApp
            if (text.includes('oferta especial') || text.includes('condi√ß√£o especial') || text.includes('garantir oferta')) {
                addUserMessage(text);
                const userName = conversationState.userName || 'Visitante';
                const appType = conversationState.appType || 'app personalizado';
                const message = `Oi! Sou ${userName}, vim do chat da Evo e quero saber mais sobre a OFERTA ESPECIAL para criar meu ${appType}! üéÅ`;
                const whatsappUrl = `https://wa.me/5511983362246?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                setTimeout(() => {
                    addAIResponseDirect(`Perfeito, ${userName}! üéâ<br><br>Abri o WhatsApp pra voc√™! Nosso time vai te apresentar a condi√ß√£o especial.<br><br>üíô Estamos ansiosos pra te ajudar a realizar o sonho do seu app!`, [], true);
                }, 500);
                return;
            }

            // Tratar pedido de resumo por WhatsApp
            if (text.includes('resumo por WhatsApp') || text.includes('manda um resumo')) {
                addUserMessage(text);
                const userName = conversationState.userName || 'Visitante';
                const appType = conversationState.appType || '';
                const message = `Oi! Sou ${userName}, vim do chat da Evo${appType ? ` e tenho interesse em criar um app de ${appType}` : ''}. Podem me enviar um resumo das op√ß√µes? üìã`;
                const whatsappUrl = `https://wa.me/5511983362246?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                setTimeout(() => {
                    addAIResponseDirect(`Pronto, ${userName}! üì±<br><br>Abri o WhatsApp! Nosso time vai te enviar um resumo completinho.<br><br>üíô Foi um prazer conversar com voc√™!`, [], true);
                }, 500);
                return;
            }

            // Tratar op√ß√µes de suporte humano
            if (text.includes('Falar com especialista') || text.includes('WhatsApp')) {
                addUserMessage(text);
                talkToHuman();
                return;
            }

            if (text.includes('Agendar liga√ß√£o') || text.includes('Agendar conversa')) {
                addUserMessage(text);
                window.open('https://calendly.com/evo-apps', '_blank');
                const userName = conversationState.userName || 'voc√™';
                setTimeout(() => {
                    addAIResponseDirect(`√ìtimo, ${userName}! üìÖ Abri nosso calend√°rio em uma nova aba. Escolha o melhor hor√°rio pra voc√™!`, [], true);
                }, 500);
                return;
            }

            if (text.includes('Tentar descrever novamente')) {
                addUserMessage(text);
                conversationState.outroTipoAttempts = 0;
                handleOutroTipoApp();
                return;
            }

            addUserMessage(text);

            const response = generateContextualResponse(text);
            const typingTime = getHumanTypingTime(response.message);

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponse(text);
                }, typingTime);
            }, 500);
        }

        // ================================
        // SISTEMA INTELIGENTE PARA "OUTRO TIPO DE APP"
        // ================================

        // Handler para quando usu√°rio seleciona "Outro tipo de app"
        function handleOutroTipoApp() {
            conversationState.waitingForOutroTipoDescription = true;
            const userName = conversationState.userName || 'voc√™';

            const message = `Interessante, ${userName}! üéØ<br><br>Me conta um pouco mais sobre sua ideia. <strong>Descreva brevemente o que seu app precisa fazer:</strong><br><br><em>Ex: "um app para agendamento de barbearia", "sistema para controle de pet shop", "app de assinatura de vinhos"...</em>`;

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponseDirect(message, [], true);

                    // Focar no campo de input
                    const input = document.getElementById('chatInput');
                    if (input) {
                        input.focus();
                        input.placeholder = 'Descreva sua ideia de app aqui...';
                    }
                }, 1200);
            }, 500);
        }

        // Processar descri√ß√£o do usu√°rio com IA
        function processOutroTipoDescription(description) {
            conversationState.waitingForOutroTipoDescription = false;
            conversationState.outroTipoAttempts++;
            const userName = conversationState.userName || 'voc√™';

            // Usar sistema de NLP para classificar
            const detection = detectCategory(description);

            if (detection.category && detection.confidence >= 5) {
                // Classifica√ß√£o bem-sucedida - pedir confirma√ß√£o
                conversationState.lastSuggestedCategory = detection.category;

                const categoryNames = {
                    delivery: 'Apps de Delivery & Entregas',
                    ecommerce: 'E-commerce & Loja Virtual',
                    educacao: 'Educa√ß√£o & Cursos Online',
                    saude: 'Sa√∫de & Telemedicina',
                    gestao: 'Gest√£o Empresarial',
                    fitness: 'Fitness & Academia',
                    imobiliario: 'Imobili√°rio & Corretagem',
                    servicos: 'Servi√ßos & Agendamento',
                    financas: 'Finan√ßas & Fintech',
                    social: 'Social & Comunidade',
                    transporte: 'Transporte & Mobilidade',
                    pets: 'Pets & Pet Shop',
                    entretenimento: 'Entretenimento & Streaming',
                    viagens: 'Viagens & Turismo',
                    beleza: 'Beleza & Est√©tica'
                };

                const categoryEmojis = {
                    delivery: 'üçï',
                    ecommerce: 'üõí',
                    educacao: 'üìö',
                    saude: 'üíö',
                    gestao: 'üíº',
                    fitness: 'üí™',
                    imobiliario: 'üè†',
                    servicos: '‚úÇÔ∏è',
                    financas: 'üí∞',
                    social: 'üë•',
                    transporte: 'üöó',
                    pets: 'üêæ',
                    entretenimento: 'üé¨',
                    viagens: '‚úàÔ∏è',
                    beleza: 'üíÑ'
                };

                const message = `Legal, ${userName}! ü§î<br><br>Analisando sua descri√ß√£o, parece que seu app se encaixa em <strong>${categoryEmojis[detection.category]} ${categoryNames[detection.category]}</strong>.<br><br>Isso faz sentido pra voc√™?`;

                setTimeout(() => {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addAIResponseDirect(message, [
                            { text: '‚úÖ Sim, √© isso mesmo!' },
                            { text: '‚ùå N√£o √© bem isso' }
                        ], true);
                    }, 1500);
                }, 500);

            } else if (conversationState.outroTipoAttempts >= 2) {
                // Ap√≥s 2 tentativas sem sucesso, oferecer humano
                offerHumanSupport();
            } else {
                // N√£o conseguiu classificar - pedir mais detalhes
                askForMoreDetails();
            }
        }

        // Confirmar categoria sugerida pela IA - AGORA SEGUE FLUXO CONSULTIVO
        function confirmSuggestedCategory() {
            const category = conversationState.lastSuggestedCategory;
            const userName = conversationState.userName || 'voc√™';

            const categoryTypeMap = {
                delivery: { type: 'Delivery', key: 'delivery', emoji: 'üçï' },
                ecommerce: { type: 'E-commerce', key: 'ecommerce', emoji: 'üõí' },
                educacao: { type: 'Educa√ß√£o', key: 'educacao', emoji: 'üìö' },
                saude: { type: 'Sa√∫de', key: 'saude', emoji: 'üíö' },
                gestao: { type: 'Gest√£o', key: 'gestao', emoji: 'üíº' },
                fitness: { type: 'Fitness', key: 'fitness', emoji: 'üí™' },
                imobiliario: { type: 'Imobili√°rio', key: 'imobiliario', emoji: 'üè†' },
                servicos: { type: 'Servi√ßos', key: 'servicos', emoji: '‚úÇÔ∏è' },
                financas: { type: 'Finan√ßas', key: 'financas', emoji: 'üí∞' },
                social: { type: 'Social', key: 'social', emoji: 'üë•' },
                transporte: { type: 'Transporte', key: 'transporte', emoji: 'üöó' },
                pets: { type: 'Pets', key: 'pets', emoji: 'üêæ' },
                entretenimento: { type: 'Entretenimento', key: 'entretenimento', emoji: 'üé¨' },
                viagens: { type: 'Viagens', key: 'viagens', emoji: '‚úàÔ∏è' },
                beleza: { type: 'Beleza', key: 'beleza', emoji: 'üíÑ' }
            };

            const mapped = categoryTypeMap[category];
            conversationState.userInfo.appType = mapped.type;
            conversationState.userInfo.appTypeKey = mapped.key;
            conversationState.lastSuggestedCategory = null;
            conversationState.conversationStep = 'objective'; // Continuar fluxo consultivo
            updateProgress(1, 'Etapa 1 de 4: Entendendo seu projeto');

            const message = `Perfeito, ${userName}! ${mapped.emoji}<br><br>O que voc√™ quer alcan√ßar com o app?`;

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponseDirect(message, [
                        { text: 'üå± Come√ßar simples e ir crescendo' },
                        { text: 'üöÄ J√° quero algo completo' },
                        { text: 'üëë Quero o melhor do mercado' }
                    ], true);
                }, 1200);
            }, 500);
        }

        // Rejeitar categoria sugerida e pedir mais detalhes
        function rejectSuggestedCategory() {
            conversationState.lastSuggestedCategory = null;

            if (conversationState.outroTipoAttempts >= 2) {
                offerHumanSupport();
            } else {
                askForMoreDetails();
            }
        }

        // Pedir mais detalhes sobre o app
        function askForMoreDetails() {
            const userName = conversationState.userName || 'voc√™';

            const message = `Sem problemas, ${userName}! ü§î<br><br>Me conta com mais detalhes:<br><br>‚Ä¢ <strong>Quem vai usar seu app?</strong> (clientes, funcion√°rios, p√∫blico geral...)<br>‚Ä¢ <strong>Qual o principal problema que resolve?</strong><br><br>Quanto mais detalhes, melhor consigo te ajudar!`;

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponseDirect(message, [], true);

                    conversationState.waitingForOutroTipoDescription = true;
                    const input = document.getElementById('chatInput');
                    if (input) {
                        input.focus();
                        input.placeholder = 'Descreva quem vai usar e qual problema resolve...';
                    }
                }, 1500);
            }, 500);
        }

        // Oferecer suporte humano ap√≥s tentativas falhas
        function offerHumanSupport() {
            const userName = conversationState.userName || 'voc√™';

            const message = `${userName}, seu projeto parece ser bem espec√≠fico e √∫nico! üåü<br><br>Pra garantir que entendemos perfeitamente sua necessidade, que tal conversar rapidinho com um de nossos especialistas?<br><br>Eles podem te ajudar a definir o melhor caminho pro seu app.`;

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addAIResponseDirect(message, [
                        { text: 'üìû Falar com especialista no WhatsApp' },
                        { text: 'üìÖ Agendar liga√ß√£o de 15 min' },
                        { text: 'üîÑ Tentar descrever novamente' }
                    ], true);
                }, 1500);
            }, 500);
        }

        // Handler para op√ß√µes de suporte humano
        function handleHumanSupportOption(option) {
            if (option.includes('WhatsApp')) {
                talkToHuman();
            } else if (option.includes('Agendar')) {
                // Abrir calend√°rio ou formul√°rio de agendamento
                window.open('https://calendly.com/evo-apps', '_blank');
            } else if (option.includes('Tentar descrever')) {
                // Resetar tentativas e dar mais uma chance
                conversationState.outroTipoAttempts = 0;
                handleOutroTipoApp();
            }
        }

        // Definir pacotes por tipo de app com linguagem clara
        const packageDefinitions = {
            delivery: {
                starter: {
                    name: 'üéØ Come√ßar a Entregar',
                    goal: 'Validar sua ideia',
                    capacity: 'At√© 100 entregas/dia',
                    comparison: 'App funcional e profissional',
                    timeline: '15-20 dias',
                    ideal: 'Pequenos restaurantes e dark kitchens iniciantes',
                    highlights: ['Card√°pio digital', 'Pagamento integrado', 'Rastreamento GPS', 'Notifica√ß√µes push']
                },
                growth: {
                    name: 'üöÄ Competir com iFood',
                    goal: 'Crescer e escalar o neg√≥cio',
                    capacity: '500+ entregas/dia',
                    comparison: 'N√≠vel Rappi, iFood, Uber Eats',
                    timeline: '25-30 dias',
                    ideal: 'Restaurantes estabelecidos prontos pra crescer',
                    highlights: ['M√∫ltiplos pagamentos', 'Cupons e promo√ß√µes', 'Chat em tempo real', 'Reviews e avalia√ß√µes', 'Programa de fidelidade']
                },
                scale: {
                    name: '‚≠ê Seu Pr√≥prio iFood',
                    goal: 'Dominar o mercado',
                    capacity: 'Ilimitado + Multi-restaurantes',
                    comparison: 'Marketplace completo igual iFood',
                    timeline: '40-50 dias',
                    ideal: 'Empreendedores criando o pr√≥ximo iFood da regi√£o',
                    highlights: ['Marketplace completo', 'IA para recomenda√ß√µes', 'App do entregador separado', 'Dashboard analytics', 'Gest√£o de m√∫ltiplos restaurantes']
                }
            },
            ecommerce: {
                starter: {
                    name: 'üéØ Come√ßar a Vender',
                    goal: 'Loja online no ar',
                    capacity: 'At√© 50 produtos',
                    comparison: 'Loja profissional completa',
                    timeline: '12-15 dias',
                    ideal: 'Lojistas come√ßando a vender online',
                    highlights: ['Cat√°logo de produtos', 'Carrinho de compras', 'Checkout seguro', 'Gest√£o de pedidos']
                },
                growth: {
                    name: 'üöÄ Loja Completa',
                    goal: 'Competir com grandes players',
                    capacity: 'At√© 1000 produtos',
                    comparison: 'N√≠vel Shopee, Mercado Livre',
                    timeline: '20-25 dias',
                    ideal: 'E-commerces querendo profissionalizar',
                    highlights: ['C√°lculo de frete autom√°tico', 'Reviews de produtos', 'Cupons de desconto', 'Lista de desejos', 'Busca avan√ßada']
                },
                scale: {
                    name: '‚≠ê Marketplace Multi-Vendedor',
                    goal: 'Criar seu Mercado Livre',
                    capacity: 'Produtos ilimitados + M√∫ltiplos sellers',
                    comparison: 'Igual Magazine Luiza, B2W',
                    timeline: '35-45 dias',
                    ideal: 'Empreendedores criando marketplaces regionais',
                    highlights: ['M√∫ltiplos vendedores', 'Recomenda√ß√µes com IA', 'ERP integrado', 'CRM completo', 'Analytics avan√ßado']
                }
            },
            educacao: {
                starter: {
                    name: 'üéØ Vender Cursos Online',
                    goal: 'Hospedar seus cursos',
                    capacity: 'At√© 10 cursos',
                    comparison: 'Plataforma profissional de ensino',
                    timeline: '15-18 dias',
                    ideal: 'Professores e pequenas escolas',
                    highlights: ['Player de v√≠deo', 'Gest√£o de alunos', 'Certificados autom√°ticos', '√Årea de membros']
                },
                growth: {
                    name: 'üöÄ Escola Online Completa',
                    goal: 'Plataforma EAD profissional',
                    capacity: 'Cursos ilimitados',
                    comparison: 'N√≠vel Hotmart, Udemy',
                    timeline: '25-30 dias',
                    ideal: 'Escolas e produtores de conte√∫do s√©rios',
                    highlights: ['Aulas ao vivo', 'Quizzes e provas', 'F√≥rum de discuss√£o', 'Gamifica√ß√£o', 'Chat professor-aluno']
                },
                scale: {
                    name: '‚≠ê Netflix da Educa√ß√£o',
                    goal: 'Marketplace de cursos',
                    capacity: 'M√∫ltiplos instrutores + IA',
                    comparison: 'Igual Coursera, Udemy Business',
                    timeline: '40-50 dias',
                    ideal: 'Empreendedores criando plataformas EAD',
                    highlights: ['Marketplace multi-instrutor', 'Tutor com IA', 'Analytics de aprendizado', 'Modo offline', 'Integra√ß√£o LMS']
                }
            },
            saude: {
                starter: {
                    name: 'üéØ Modernizar Consult√≥rio',
                    goal: 'Digitalizar atendimento',
                    capacity: '1-3 profissionais',
                    comparison: 'Consult√≥rio 100% digital',
                    timeline: '18-22 dias',
                    ideal: 'M√©dicos e cl√≠nicas pequenas',
                    highlights: ['Agendamento online', 'Prontu√°rio eletr√¥nico', 'Prescri√ß√µes digitais', 'Lembretes autom√°ticos']
                },
                growth: {
                    name: 'üöÄ Telemedicina Completa',
                    goal: 'Atender online',
                    capacity: 'At√© 10 profissionais',
                    comparison: 'N√≠vel Doctoralia, Conexa Sa√∫de',
                    timeline: '28-35 dias',
                    ideal: 'Cl√≠nicas querendo oferecer telemedicina',
                    highlights: ['Consultas por v√≠deo', 'Pagamento integrado', 'Gest√£o de exames', 'Chat seguro', 'Acompanhamento de sa√∫de']
                },
                scale: {
                    name: '‚≠ê Rede de Cl√≠nicas + IA',
                    goal: 'Sistema hospitalar completo',
                    capacity: 'Multi-cl√≠nicas ilimitado',
                    comparison: 'N√≠vel Einstein, Fleury',
                    timeline: '45-60 dias',
                    ideal: 'Redes de sa√∫de e hospitais',
                    highlights: ['Multi-cl√≠nicas integradas', 'IA para diagn√≥stico', 'Integra√ß√£o IoT (wearables)', 'LGPD/HIPAA completo', 'BI m√©dico']
                }
            },
            gestao: {
                starter: {
                    name: 'üéØ Organizar o Neg√≥cio',
                    goal: 'Controle financeiro e vendas',
                    capacity: '1 empresa',
                    comparison: 'Sistema de gest√£o completo',
                    timeline: '20-25 dias',
                    ideal: 'PMEs querendo organiza√ß√£o',
                    highlights: ['Dashboard executivo', 'Controle financeiro', 'Cadastro de clientes', 'Relat√≥rios b√°sicos']
                },
                growth: {
                    name: 'üöÄ ERP Completo',
                    goal: 'Automatizar tudo',
                    capacity: 'Gest√£o completa',
                    comparison: 'N√≠vel Omie, Bling, Conta Azul',
                    timeline: '35-40 dias',
                    ideal: 'Empresas em crescimento',
                    highlights: ['Emiss√£o de NF-e', 'Gest√£o de estoque', 'Funil de vendas CRM', 'Integra√ß√£o banc√°ria', 'RH e funcion√°rios']
                },
                scale: {
                    name: '‚≠ê Automa√ß√£o Empresarial + IA',
                    goal: 'Gest√£o multi-empresas',
                    capacity: 'M√∫ltiplas empresas + filiais',
                    comparison: 'N√≠vel TOTVS, SAP',
                    timeline: '50-65 dias',
                    ideal: 'Grupos empresariais e holdings',
                    highlights: ['Multi-empresas integradas', 'Business Intelligence', 'Automa√ß√µes com IA', 'API completa', 'Workflows autom√°ticos']
                }
            },
            fitness: {
                starter: {
                    name: 'üéØ Academia Digital',
                    goal: 'Treinos online',
                    capacity: 'At√© 100 alunos',
                    comparison: 'App de treino profissional',
                    timeline: '15-20 dias',
                    ideal: 'Personal trainers e academias pequenas',
                    highlights: ['Biblioteca de treinos', 'Registro de progresso', 'Agenda de treinos', 'Notifica√ß√µes motivacionais']
                },
                growth: {
                    name: 'üöÄ Fitness Completo',
                    goal: 'Competir com grandes apps',
                    capacity: 'At√© 1000 alunos',
                    comparison: 'N√≠vel Gympass, Smart Fit',
                    timeline: '25-35 dias',
                    ideal: 'Academias e redes de personal',
                    highlights: ['V√≠deos de exerc√≠cios', 'Di√°rio alimentar', 'Chat com personal', 'Desafios fitness', 'Aulas em grupo']
                },
                scale: {
                    name: '‚≠ê Seu Pr√≥prio Gympass',
                    goal: 'Plataforma fitness completa',
                    capacity: 'Ilimitado + Multi-unidades',
                    comparison: 'N√≠vel TotalPass, Wellhub',
                    timeline: '40-55 dias',
                    ideal: 'Redes de academia e franquias',
                    highlights: ['Personal trainer IA', 'Integra√ß√£o wearables', 'Aulas ao vivo', 'Gamifica√ß√£o', 'Analytics avan√ßado']
                }
            },
            imobiliario: {
                starter: {
                    name: 'üéØ Imobili√°ria Digital',
                    goal: 'Mostrar im√≥veis online',
                    capacity: 'At√© 100 im√≥veis',
                    comparison: 'Portal imobili√°rio profissional',
                    timeline: '15-20 dias',
                    ideal: 'Corretores aut√¥nomos e pequenas imobili√°rias',
                    highlights: ['Listagem de im√≥veis', 'Busca avan√ßada', 'Contato com corretor', 'Favoritos']
                },
                growth: {
                    name: 'üöÄ Portal Imobili√°rio',
                    goal: 'Competir com grandes portais',
                    capacity: 'At√© 1000 im√≥veis',
                    comparison: 'N√≠vel Zap Im√≥veis, Viva Real',
                    timeline: '25-35 dias',
                    ideal: 'Imobili√°rias estabelecidas',
                    highlights: ['Tour virtual 360¬∞', 'Agendamento de visitas', 'Chat em tempo real', 'Simulador de financiamento', 'Alertas']
                },
                scale: {
                    name: '‚≠ê Marketplace Imobili√°rio',
                    goal: 'Criar seu QuintoAndar',
                    capacity: 'Ilimitado + Multi-imobili√°rias',
                    comparison: 'N√≠vel QuintoAndar, Loft',
                    timeline: '45-60 dias',
                    ideal: 'Empreendedores do mercado imobili√°rio',
                    highlights: ['CRM imobili√°rio', 'IA para recomenda√ß√µes', 'Gest√£o de contratos', 'Analytics de mercado', 'Marketplace completo']
                }
            },
            servicos: {
                starter: {
                    name: 'üéØ Agenda Online',
                    goal: 'Organizar agendamentos',
                    capacity: '1-3 profissionais',
                    comparison: 'Sistema de agendamento profissional',
                    timeline: '12-18 dias',
                    ideal: 'Sal√µes, barbearias, cl√≠nicas pequenas',
                    highlights: ['Cat√°logo de servi√ßos', 'Agendamento online', 'Lembretes autom√°ticos', 'Perfil do profissional']
                },
                growth: {
                    name: 'üöÄ Neg√≥cio Completo',
                    goal: 'Gest√£o total do neg√≥cio',
                    capacity: 'At√© 20 profissionais',
                    comparison: 'N√≠vel Trinks, Booksy',
                    timeline: '22-30 dias',
                    ideal: 'Sal√µes e cl√≠nicas em crescimento',
                    highlights: ['Pagamentos online', 'Avalia√ß√µes', 'Programa de fidelidade', 'Chat cliente-profissional', 'Hist√≥rico completo']
                },
                scale: {
                    name: '‚≠ê Rede de Franquias',
                    goal: 'Gerenciar m√∫ltiplas unidades',
                    capacity: 'Ilimitado + Multi-unidades',
                    comparison: 'N√≠vel grandes redes de franquia',
                    timeline: '38-50 dias',
                    ideal: 'Franquias e redes de beleza/sa√∫de',
                    highlights: ['Multi-unidades', 'Gest√£o de equipe', 'Controle de estoque', 'CRM avan√ßado', 'Analytics de neg√≥cio']
                }
            },
            financas: {
                starter: {
                    name: 'üéØ Controle Financeiro',
                    goal: 'Organizar suas finan√ßas',
                    capacity: 'Uso pessoal/individual',
                    comparison: 'App de finan√ßas pessoais',
                    timeline: '18-22 dias',
                    ideal: 'Pessoas f√≠sicas e aut√¥nomos',
                    highlights: ['Registro de transa√ß√µes', 'Categoriza√ß√£o', 'Or√ßamento mensal', 'Relat√≥rios b√°sicos']
                },
                growth: {
                    name: 'üöÄ Fintech Completa',
                    goal: 'Gest√£o financeira avan√ßada',
                    capacity: 'Pessoal + Empresarial',
                    comparison: 'N√≠vel Mobills, Organizze',
                    timeline: '30-40 dias',
                    ideal: 'MEIs, PMEs e investidores',
                    highlights: ['Sincroniza√ß√£o banc√°ria', 'Metas financeiras', 'Investimentos', 'Contas a pagar', 'Alertas']
                },
                scale: {
                    name: '‚≠ê Plataforma Fintech',
                    goal: 'Criar seu pr√≥prio banco digital',
                    capacity: 'Multi-usu√°rios empresarial',
                    comparison: 'N√≠vel Nubank, Inter',
                    timeline: '50-65 dias',
                    ideal: 'Fintechs e empresas financeiras',
                    highlights: ['Insights por IA', 'Emiss√£o de boletos/NF', 'Multi-moedas', 'Integra√ß√£o PIX', 'Seguran√ßa avan√ßada']
                }
            },
            social: {
                starter: {
                    name: 'üéØ Comunidade Online',
                    goal: 'Criar sua comunidade',
                    capacity: 'At√© 500 usu√°rios',
                    comparison: 'Rede social b√°sica',
                    timeline: '18-25 dias',
                    ideal: 'Criadores de conte√∫do e nichos espec√≠ficos',
                    highlights: ['Perfis de usu√°rio', 'Feed de publica√ß√µes', 'Curtidas e coment√°rios', 'Grupos']
                },
                growth: {
                    name: 'üöÄ Rede Social Completa',
                    goal: 'Engajar sua audi√™ncia',
                    capacity: 'At√© 10.000 usu√°rios',
                    comparison: 'N√≠vel Discord, Circle',
                    timeline: '30-40 dias',
                    ideal: 'Empresas e grandes comunidades',
                    highlights: ['Sistema de seguidores', 'Mensagens privadas', 'Notifica√ß√µes', 'Hashtags', 'Busca avan√ßada']
                },
                scale: {
                    name: '‚≠ê Sua Pr√≥pria Rede Social',
                    goal: 'Plataforma social completa',
                    capacity: 'Ilimitado',
                    comparison: 'N√≠vel Twitter, Instagram',
                    timeline: '50-65 dias',
                    ideal: 'Startups de m√≠dia social',
                    highlights: ['Stories/Status', 'Lives e streaming', 'Modera√ß√£o por IA', 'Monetiza√ß√£o', 'Recomenda√ß√µes IA']
                }
            },
            transporte: {
                starter: {
                    name: 'üéØ App de Transporte',
                    goal: 'Conectar motoristas e passageiros',
                    capacity: 'At√© 50 motoristas',
                    comparison: 'App de transporte b√°sico',
                    timeline: '20-28 dias',
                    ideal: 'Cooperativas e transporte regional',
                    highlights: ['Solicitar corrida', 'Rastreamento GPS', 'Pagamento integrado', 'Avalia√ß√µes']
                },
                growth: {
                    name: 'üöÄ Transporte Completo',
                    goal: 'Competir com grandes apps',
                    capacity: 'At√© 500 motoristas',
                    comparison: 'N√≠vel 99, Cabify',
                    timeline: '32-42 dias',
                    ideal: 'Empresas de transporte estabelecidas',
                    highlights: ['App do motorista', 'Agendamento', 'Chat integrado', 'Cupons e promo√ß√µes', 'Hist√≥rico completo']
                },
                scale: {
                    name: '‚≠ê Seu Pr√≥prio Uber',
                    goal: 'Dominar o mercado regional',
                    capacity: 'Ilimitado + Gest√£o de frota',
                    comparison: 'N√≠vel Uber, 99',
                    timeline: '48-65 dias',
                    ideal: 'Empreendedores de mobilidade',
                    highlights: ['Carona compartilhada', 'Gest√£o de frota', 'Rotas por IA', 'Pre√ßo din√¢mico', 'Analytics completo']
                }
            },
            pets: {
                starter: {
                    name: 'üéØ Pet Shop Digital',
                    goal: 'Vender online para pets',
                    capacity: 'At√© 200 produtos',
                    comparison: 'Loja pet profissional',
                    timeline: '15-20 dias',
                    ideal: 'Pet shops e cl√≠nicas veterin√°rias',
                    highlights: ['Cat√°logo de produtos', 'Perfil do pet', 'Agendamento banho/tosa', 'Carrinho de compras']
                },
                growth: {
                    name: 'üöÄ Pet Care Completo',
                    goal: 'Marketplace pet completo',
                    capacity: 'Produtos + Servi√ßos ilimitados',
                    comparison: 'N√≠vel Petz, Cobasi',
                    timeline: '25-35 dias',
                    ideal: 'Redes de pet shop',
                    highlights: ['Telemedicina veterin√°ria', 'Carteira de vacina√ß√£o', 'Delivery', 'Assinaturas', 'Avalia√ß√µes']
                },
                scale: {
                    name: '‚≠ê Seu Pr√≥prio Petz',
                    goal: 'Dominar o mercado pet',
                    capacity: 'Marketplace multi-lojas + IA',
                    comparison: 'N√≠vel Amazon Pets',
                    timeline: '40-55 dias',
                    ideal: 'Empreendedores do mercado pet',
                    highlights: ['Marketplace completo', 'IA para recomenda√ß√µes', 'Clube de assinaturas', 'Analytics avan√ßado', 'Multi-lojas']
                }
            },
            entretenimento: {
                starter: {
                    name: 'üéØ Streaming B√°sico',
                    goal: 'Distribuir seu conte√∫do',
                    capacity: 'At√© 100 v√≠deos/m√∫sicas',
                    comparison: 'Plataforma de streaming',
                    timeline: '20-25 dias',
                    ideal: 'Criadores de conte√∫do e produtoras',
                    highlights: ['Player de m√≠dia', 'Cat√°logo', 'Busca', 'Favoritos', 'Hist√≥rico']
                },
                growth: {
                    name: 'üöÄ Streaming Completo',
                    goal: 'Plataforma de entretenimento',
                    capacity: 'Conte√∫do ilimitado + Assinaturas',
                    comparison: 'N√≠vel Globoplay, Paramount+',
                    timeline: '35-45 dias',
                    ideal: 'Empresas de m√≠dia e entretenimento',
                    highlights: ['Sistema de assinatura', 'Download offline', 'M√∫ltiplos perfis', 'Recomenda√ß√µes', 'Notifica√ß√µes']
                },
                scale: {
                    name: '‚≠ê Sua Pr√≥pria Netflix',
                    goal: 'Dominar o streaming',
                    capacity: 'Ilimitado + Live + IA',
                    comparison: 'N√≠vel Netflix, Disney+',
                    timeline: '50-70 dias',
                    ideal: 'Grandes produtoras e broadcasters',
                    highlights: ['Live streaming', 'IA para recomenda√ß√µes', 'DRM avan√ßado', 'Analytics de audi√™ncia', 'CMS completo']
                }
            },
            viagens: {
                starter: {
                    name: 'üéØ Ag√™ncia Digital',
                    goal: 'Vender pacotes online',
                    capacity: 'At√© 100 destinos',
                    comparison: 'Ag√™ncia de viagens online',
                    timeline: '18-25 dias',
                    ideal: 'Ag√™ncias de turismo pequenas',
                    highlights: ['Busca de destinos', 'Sistema de reservas', 'Pagamento integrado', 'Vouchers digitais']
                },
                growth: {
                    name: 'üöÄ Portal de Viagens',
                    goal: 'Competir com grandes portais',
                    capacity: 'Destinos ilimitados + Comparador',
                    comparison: 'N√≠vel Decolar, Kayak',
                    timeline: '30-40 dias',
                    ideal: 'Operadoras de turismo',
                    highlights: ['Comparador de pre√ßos', 'Roteiro de viagem', 'Alertas de pre√ßo', 'Avalia√ß√µes', 'Mapas integrados']
                },
                scale: {
                    name: '‚≠ê Seu Pr√≥prio Booking',
                    goal: 'Marketplace de turismo',
                    capacity: 'Multi-operadoras + IA',
                    comparison: 'N√≠vel Booking, Expedia',
                    timeline: '45-60 dias',
                    ideal: 'Empreendedores de turismo',
                    highlights: ['Marketplace completo', 'IA para recomenda√ß√µes', 'Programa de fidelidade', 'Concierge virtual', 'Analytics']
                }
            },
            beleza: {
                starter: {
                    name: 'üéØ Sal√£o Digital',
                    goal: 'Organizar agendamentos',
                    capacity: '1-5 profissionais',
                    comparison: 'Sistema de agendamento',
                    timeline: '12-18 dias',
                    ideal: 'Sal√µes de beleza e cl√≠nicas est√©ticas',
                    highlights: ['Cat√°logo de servi√ßos', 'Agendamento online', 'Lembretes', 'Perfil profissional']
                },
                growth: {
                    name: 'üöÄ Beauty Tech Completo',
                    goal: 'Gest√£o completa do neg√≥cio',
                    capacity: 'At√© 30 profissionais',
                    comparison: 'N√≠vel Trinks, Booksy',
                    timeline: '22-32 dias',
                    ideal: 'Sal√µes e cl√≠nicas em crescimento',
                    highlights: ['Pagamentos online', 'Galeria de trabalhos', 'Fidelidade', 'Venda de produtos', 'Avalia√ß√µes']
                },
                scale: {
                    name: '‚≠ê Rede de Franquias Beauty',
                    goal: 'Gerenciar m√∫ltiplas unidades',
                    capacity: 'Ilimitado + Multi-unidades',
                    comparison: 'N√≠vel grandes redes',
                    timeline: '38-50 dias',
                    ideal: 'Franquias de beleza e est√©tica',
                    highlights: ['Multi-unidades', 'Gest√£o de equipe', 'IA simulador de visual', 'CRM avan√ßado', 'Analytics']
                }
            }
        };

        // Depoimentos contextuais por tipo de app
        const testimonials = {
            delivery: {
                nome: "Pizzaria Dom Jo√£o",
                foto: "üë®‚Äçüç≥",
                tipo: "Delivery de Pizza",
                resultado: "De 50 para 800 entregas/dia em 6 meses",
                pacote: "Competir com iFood",
                estrelas: 5,
                depoimento: "O app revolucionou nosso neg√≥cio. N√£o dependemos mais de taxas absurdas do iFood."
            },
            ecommerce: {
                nome: "Boutique Estilo √önico",
                foto: "üëó",
                tipo: "Moda Feminina",
                resultado: "R$ 80mil em vendas no primeiro m√™s",
                pacote: "Loja Completa",
                estrelas: 5,
                depoimento: "Deixamos de pagar 15% de comiss√£o para marketplaces. Agora o lucro √© todo nosso!"
            },
            educacao: {
                nome: "Prof. Carlos Mendes",
                foto: "üë®‚Äçüè´",
                tipo: "Cursos de Programa√ß√£o",
                resultado: "1.200 alunos em 4 meses",
                pacote: "Escola Online Completa",
                estrelas: 5,
                depoimento: "Sa√≠ da Hotmart e criei minha pr√≥pria plataforma. Zero taxas, 100% de lucro."
            },
            saude: {
                nome: "Dra. Ana Paula - Cardiologista",
                foto: "üë©‚Äç‚öïÔ∏è",
                tipo: "Telemedicina",
                resultado: "3x mais pacientes atendidos",
                pacote: "Telemedicina Completa",
                estrelas: 5,
                depoimento: "Atendo pacientes de todo Brasil. Minha agenda est√° sempre cheia!"
            },
            gestao: {
                nome: "Distribuidora Atacad√£o",
                foto: "üì¶",
                tipo: "Atacado e Distribui√ß√£o",
                resultado: "80% menos tempo em tarefas manuais",
                pacote: "ERP Completo",
                estrelas: 5,
                depoimento: "Economizamos R$ 15mil/m√™s eliminando retrabalho e erros manuais."
            },
            fitness: {
                nome: "Academia FitPro",
                foto: "üí™",
                tipo: "Academia e Personal",
                resultado: "De 80 para 450 alunos ativos",
                pacote: "Fitness Completo",
                estrelas: 5,
                depoimento: "Nossos alunos adoram o app! A reten√ß√£o aumentou 60% com os treinos personalizados."
            },
            imobiliario: {
                nome: "Imobili√°ria Nova Casa",
                foto: "üè†",
                tipo: "Imobili√°ria",
                resultado: "3x mais leads qualificados",
                pacote: "Portal Imobili√°rio",
                estrelas: 5,
                depoimento: "O tour virtual foi um diferencial incr√≠vel. Fechamos vendas com clientes de outros estados!"
            },
            servicos: {
                nome: "Barbearia The King",
                foto: "‚úÇÔ∏è",
                tipo: "Barbearia Premium",
                resultado: "Zero faltas com lembretes autom√°ticos",
                pacote: "Neg√≥cio Completo",
                estrelas: 5,
                depoimento: "Antes perd√≠amos 20% dos agendamentos por no-show. Agora √© praticamente zero!"
            },
            financas: {
                nome: "Assessoria Financeira Livre",
                foto: "üí∞",
                tipo: "Consultoria Financeira",
                resultado: "2.000 clientes gerenciados",
                pacote: "Fintech Completa",
                estrelas: 5,
                depoimento: "Nossos clientes t√™m controle total das finan√ßas. A satisfa√ß√£o aumentou muito!"
            },
            social: {
                nome: "Comunidade Dev Brasil",
                foto: "üë•",
                tipo: "Comunidade de Tecnologia",
                resultado: "15.000 membros ativos",
                pacote: "Rede Social Completa",
                estrelas: 5,
                depoimento: "Sa√≠mos do Discord e criamos nossa pr√≥pria comunidade. Engajamento triplicou!"
            },
            transporte: {
                nome: "TransCidade",
                foto: "üöó",
                tipo: "Transporte Urbano",
                resultado: "300 motoristas cadastrados em 3 meses",
                pacote: "Transporte Completo",
                estrelas: 5,
                depoimento: "Criamos o 'Uber' da nossa cidade. As cooperativas de t√°xi adoraram!"
            },
            pets: {
                nome: "PetLove Store",
                foto: "üêæ",
                tipo: "Pet Shop Online",
                resultado: "R$ 120mil em vendas no primeiro trimestre",
                pacote: "Pet Care Completo",
                estrelas: 5,
                depoimento: "O agendamento de banho e tosa integrado com a loja foi um diferencial incr√≠vel!"
            },
            entretenimento: {
                nome: "Cine Brasil Play",
                foto: "üé¨",
                tipo: "Streaming de Filmes",
                resultado: "50.000 assinantes em 6 meses",
                pacote: "Streaming Completo",
                estrelas: 5,
                depoimento: "Criamos nossa pr√≥pria Netflix de filmes nacionais. O p√∫blico adorou!"
            },
            viagens: {
                nome: "Viaje Mais Turismo",
                foto: "‚úàÔ∏è",
                tipo: "Ag√™ncia de Viagens",
                resultado: "Vendas online aumentaram 400%",
                pacote: "Portal de Viagens",
                estrelas: 5,
                depoimento: "Paramos de depender de portais que cobravam 25% de comiss√£o. Agora vendemos direto!"
            },
            beleza: {
                nome: "Studio Glamour",
                foto: "üíÑ",
                tipo: "Sal√£o de Beleza",
                resultado: "90% menos no-shows com lembretes",
                pacote: "Beauty Tech Completo",
                estrelas: 5,
                depoimento: "A galeria de antes e depois virou nossa melhor ferramenta de marketing!"
            }
        };

        // Apresentar pacotes pr√©-definidos
        function showPackages(appTypeKey) {
            const userName = conversationState.userName || 'voc√™';
            const features = featuresCatalog[appTypeKey];
            const packages = packageDefinitions[appTypeKey];

            if (!features || !packages) return;

            // Calcular pontos de cada pacote
            const basicPoints = features.essential.reduce((sum, f) => sum + f.points, 0);
            const proPoints = basicPoints + features.intermediate.reduce((sum, f) => sum + f.points, 0);
            const enterprisePoints = proPoints + features.advanced.reduce((sum, f) => sum + f.points, 0);

            const basicPrice = calculatePrice(basicPoints);

            const messagesContainer = document.getElementById('chatMessages');
            const packagesDiv = document.createElement('div');

            packagesDiv.innerHTML = `
                <div class="message-ai">
                    <div class="message-content" style="max-width: 100%;">
                        <div class="message-bubble">
                            Perfeito, ${userName}! üéØ Montei 3 op√ß√µes baseadas no seu objetivo.<br><br>
                            <span style="color: #666; font-size: 13px;">üëâ Arraste para o lado para ver todos os pacotes</span>
                        </div>

                        <!-- Container com scroll horizontal -->
                        <div style="
                            display: flex;
                            gap: 16px;
                            overflow-x: auto;
                            scroll-snap-type: x mandatory;
                            -webkit-overflow-scrolling: touch;
                            padding: 16px 4px 20px 4px;
                            margin: 0 -4px;
                            scrollbar-width: thin;
                            scrollbar-color: #ccc transparent;
                        ">
                            <!-- Pacote Starter - COM PRE√áO -->
                            <div style="
                                flex: 0 0 280px;
                                scroll-snap-align: start;
                                background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%);
                                border: 2px solid var(--color-primary);
                                border-radius: 16px;
                                padding: 20px;
                                cursor: pointer;
                                transition: all 0.3s;
                                position: relative;
                            " onclick="selectPackage('basic', '${appTypeKey}')">
                                <h4 style="font-size: 18px; font-weight: 700; color: var(--color-primary); margin-bottom: 6px;">${packages.starter.name}</h4>
                                <p style="font-size: 13px; color: var(--color-text-medium); font-weight: 600; margin-bottom: 12px;">${packages.starter.goal}</p>

                                <div style="background: white; padding: 14px; border-radius: 10px; margin-bottom: 14px; text-align: center;">
                                    <p style="font-size: 11px; color: #10b981; font-weight: 600; margin: 0 0 4px 0;">A partir de</p>
                                    <p style="font-size: 32px; font-weight: 700; color: var(--color-primary); margin: 0;">${formatCurrency(basicPrice.finalPrice)}</p>
                                    <p style="font-size: 11px; color: var(--color-text-gray); margin-top: 4px;">Pronto em ${packages.starter.timeline}</p>
                                </div>

                                <div style="margin-bottom: 14px;">
                                    <p style="font-size: 12px; color: var(--color-text-gray); margin-bottom: 6px;">üìä ${packages.starter.capacity}</p>
                                    <p style="font-size: 12px; color: var(--color-text-gray); margin-bottom: 6px;">üéØ ${packages.starter.ideal}</p>
                                </div>

                                <div style="border-top: 1px solid #e0e0e0; padding-top: 12px;">
                                    <ul style="font-size: 12px; color: var(--color-text-dark); list-style: none; padding: 0; margin: 0;">
                                        ${packages.starter.highlights.slice(0, 4).map(h => `<li style="padding: 4px 0;">‚úì ${h}</li>`).join('')}
                                    </ul>
                                </div>

                                <button style="
                                    width: 100%;
                                    margin-top: 14px;
                                    padding: 12px;
                                    background: var(--color-primary);
                                    color: white;
                                    border: none;
                                    border-radius: 10px;
                                    font-size: 14px;
                                    font-weight: 600;
                                    cursor: pointer;
                                ">Escolher este</button>
                            </div>

                            <!-- Pacote Growth - SEM PRE√áO (RECOMENDADO) -->
                            <div style="
                                flex: 0 0 280px;
                                scroll-snap-align: start;
                                background: linear-gradient(135deg, #fff4e6 0%, #ffe8cc 100%);
                                border: 3px solid #ff9500;
                                border-radius: 16px;
                                padding: 20px;
                                cursor: pointer;
                                transition: all 0.3s;
                                position: relative;
                                transform: scale(1.02);
                                box-shadow: 0 8px 24px rgba(255, 149, 0, 0.2);
                            " onclick="selectPackage('pro', '${appTypeKey}')">
                                <div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #ff9500; color: white; padding: 5px 16px; border-radius: 20px; font-size: 11px; font-weight: 700; white-space: nowrap;">‚≠ê MAIS ESCOLHIDO</div>

                                <h4 style="font-size: 18px; font-weight: 700; color: #ff9500; margin-bottom: 6px; margin-top: 8px;">${packages.growth.name}</h4>
                                <p style="font-size: 13px; color: #d97706; font-weight: 600; margin-bottom: 12px;">${packages.growth.goal}</p>

                                <div style="background: white; padding: 14px; border-radius: 10px; margin-bottom: 14px; text-align: center;">
                                    <p style="font-size: 13px; color: #ff9500; font-weight: 700; margin: 0;">üí¨ Consulte pelo WhatsApp</p>
                                    <p style="font-size: 11px; color: var(--color-text-gray); margin-top: 6px;">Pronto em ${packages.growth.timeline}</p>
                                </div>

                                <div style="margin-bottom: 14px;">
                                    <p style="font-size: 12px; color: #78350f; margin-bottom: 6px;">üìä ${packages.growth.capacity}</p>
                                    <p style="font-size: 12px; color: #78350f; margin-bottom: 6px;">üèÜ ${packages.growth.comparison}</p>
                                    <p style="font-size: 12px; color: #78350f; margin-bottom: 6px;">üéØ ${packages.growth.ideal}</p>
                                </div>

                                <div style="border-top: 1px solid #fed7aa; padding-top: 12px;">
                                    <ul style="font-size: 12px; color: #92400e; list-style: none; padding: 0; margin: 0;">
                                        ${packages.growth.highlights.slice(0, 5).map(h => `<li style="padding: 4px 0;">‚úì ${h}</li>`).join('')}
                                    </ul>
                                </div>

                                <button style="
                                    width: 100%;
                                    margin-top: 14px;
                                    padding: 12px;
                                    background: #ff9500;
                                    color: white;
                                    border: none;
                                    border-radius: 10px;
                                    font-size: 14px;
                                    font-weight: 600;
                                    cursor: pointer;
                                ">Quero saber mais</button>
                            </div>

                            <!-- Pacote Scale - SEM PRE√áO -->
                            <div style="
                                flex: 0 0 280px;
                                scroll-snap-align: start;
                                background: linear-gradient(135deg, #f3e6ff 0%, #e6ccff 100%);
                                border: 2px solid #8b5cf6;
                                border-radius: 16px;
                                padding: 20px;
                                cursor: pointer;
                                transition: all 0.3s;
                                position: relative;
                            " onclick="selectPackage('enterprise', '${appTypeKey}')">
                                <div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #8b5cf6; color: white; padding: 5px 16px; border-radius: 20px; font-size: 11px; font-weight: 700; white-space: nowrap;">üëë COMPLETO</div>

                                <h4 style="font-size: 18px; font-weight: 700; color: #8b5cf6; margin-bottom: 6px; margin-top: 8px;">${packages.scale.name}</h4>
                                <p style="font-size: 13px; color: #7c3aed; font-weight: 600; margin-bottom: 12px;">${packages.scale.goal}</p>

                                <div style="background: white; padding: 14px; border-radius: 10px; margin-bottom: 14px; text-align: center;">
                                    <p style="font-size: 13px; color: #8b5cf6; font-weight: 700; margin: 0;">üí¨ Consulte pelo WhatsApp</p>
                                    <p style="font-size: 11px; color: var(--color-text-gray); margin-top: 6px;">Pronto em ${packages.scale.timeline}</p>
                                </div>

                                <div style="margin-bottom: 14px;">
                                    <p style="font-size: 12px; color: #5b21b6; margin-bottom: 6px;">üìä ${packages.scale.capacity}</p>
                                    <p style="font-size: 12px; color: #5b21b6; margin-bottom: 6px;">üèÜ ${packages.scale.comparison}</p>
                                    <p style="font-size: 12px; color: #5b21b6; margin-bottom: 6px;">üéØ ${packages.scale.ideal}</p>
                                </div>

                                <div style="border-top: 1px solid #ddd6fe; padding-top: 12px;">
                                    <ul style="font-size: 12px; color: #6b21a8; list-style: none; padding: 0; margin: 0;">
                                        ${packages.scale.highlights.slice(0, 5).map(h => `<li style="padding: 4px 0;">‚úì ${h}</li>`).join('')}
                                    </ul>
                                </div>

                                <button style="
                                    width: 100%;
                                    margin-top: 14px;
                                    padding: 12px;
                                    background: #8b5cf6;
                                    color: white;
                                    border: none;
                                    border-radius: 10px;
                                    font-size: 14px;
                                    font-weight: 600;
                                    cursor: pointer;
                                ">Quero saber mais</button>
                            </div>
                        </div>

                        <!-- Indicadores de scroll -->
                        <div style="display: flex; justify-content: center; gap: 8px; margin-top: 8px;">
                            <div style="width: 24px; height: 4px; background: var(--color-primary); border-radius: 2px;"></div>
                            <div style="width: 24px; height: 4px; background: #ddd; border-radius: 2px;"></div>
                            <div style="width: 24px; height: 4px; background: #ddd; border-radius: 2px;"></div>
                        </div>

                        <div class="suggestions" style="margin-top: 16px;">
                            <button class="suggestion-chip" onclick="showPackageComparison('${appTypeKey}')">üìä Comparar pacotes</button>
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(packagesDiv);
            scrollToBottom();

            // Mostrar social proof contextual logo ap√≥s os pacotes
            setTimeout(() => {
                showSocialProof(appTypeKey);
            }, 1000);
        }

        // Mostrar social proof contextual
        function showSocialProof(appTypeKey) {
            const testimonial = testimonials[appTypeKey];

            if (!testimonial) return;

            const stars = '‚≠ê'.repeat(testimonial.estrelas);

            const socialProofDiv = document.createElement('div');
            socialProofDiv.className = 'message-ai';
            socialProofDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="social-proof-section">
                            <h4>üåü Quem j√° usa e aprova</h4>

                            <div class="testimonial-card">
                                <div class="testimonial-header">
                                    <div class="testimonial-avatar">${testimonial.foto}</div>
                                    <div class="testimonial-info">
                                        <p class="testimonial-name">${testimonial.nome}</p>
                                        <p class="testimonial-type">${testimonial.tipo}</p>
                                        <div class="testimonial-stars">${stars}</div>
                                    </div>
                                </div>

                                <div class="testimonial-result">
                                    <p>üìà ${testimonial.resultado}</p>
                                </div>

                                <p class="testimonial-text">
                                    "${testimonial.depoimento}"
                                </p>

                                <div class="testimonial-package">
                                    Usa o pacote: üöÄ ${testimonial.pacote}
                                </div>
                            </div>

                            <div class="stats-badge">
                                <p>üìä 847 apps criados | ‚≠ê 4.9/5.0 satisfa√ß√£o | üöÄ 94% dos clientes renovam</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(socialProofDiv);
            scrollToBottom();
        }

        // Mostrar compara√ß√£o de pacotes
        function showPackageComparison(appTypeKey) {
            const features = featuresCatalog[appTypeKey];
            const packages = packageDefinitions[appTypeKey];

            if (!features || !packages) return;

            // Calcular pontos e pre√ßos
            const basicPoints = features.essential.reduce((sum, f) => sum + f.points, 0);
            const proPoints = basicPoints + features.intermediate.reduce((sum, f) => sum + f.points, 0);
            const enterprisePoints = proPoints + features.advanced.reduce((sum, f) => sum + f.points, 0);

            const basicPrice = calculatePrice(basicPoints);
            const proPrice = calculatePrice(proPoints);
            const enterprisePrice = calculatePrice(enterprisePoints);

            // Criar modal
            const modal = document.createElement('div');
            modal.className = 'comparison-modal';
            modal.id = 'comparisonModal';

            // Construir linhas da tabela
            let tableRows = '';

            // Features Essenciais
            tableRows += `<tr class="category-header"><td colspan="4">üì¶ Funcionalidades Essenciais</td></tr>`;
            features.essential.forEach(feature => {
                tableRows += `
                    <tr>
                        <td>${feature.name}<br><small style="color: #999; font-size: 12px;">${feature.description}</small></td>
                        <td class="feature-check"><span class="check-yes">‚úì</span></td>
                        <td class="feature-check"><span class="check-yes">‚úì</span></td>
                        <td class="feature-check"><span class="check-yes">‚úì</span></td>
                    </tr>
                `;
            });

            // Features Intermedi√°rias
            tableRows += `<tr class="category-header"><td colspan="4">üöÄ Funcionalidades Profissionais</td></tr>`;
            features.intermediate.forEach(feature => {
                tableRows += `
                    <tr>
                        <td>${feature.name}<br><small style="color: #999; font-size: 12px;">${feature.description}</small></td>
                        <td class="feature-check"><span class="check-no">‚úó</span></td>
                        <td class="feature-check"><span class="check-yes">‚úì</span></td>
                        <td class="feature-check"><span class="check-yes">‚úì</span></td>
                    </tr>
                `;
            });

            // Features Avan√ßadas
            tableRows += `<tr class="category-header"><td colspan="4">‚≠ê Funcionalidades Avan√ßadas</td></tr>`;
            features.advanced.forEach(feature => {
                tableRows += `
                    <tr>
                        <td>${feature.name}<br><small style="color: #999; font-size: 12px;">${feature.description}</small></td>
                        <td class="feature-check"><span class="check-no">‚úó</span></td>
                        <td class="feature-check"><span class="check-no">‚úó</span></td>
                        <td class="feature-check"><span class="check-yes">‚úì</span></td>
                    </tr>
                `;
            });

            modal.innerHTML = `
                <div class="comparison-content">
                    <div class="comparison-header">
                        <h3>üìä Compara√ß√£o Detalhada de Pacotes</h3>
                        <button class="comparison-close" onclick="closeComparison()">√ó</button>
                    </div>

                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Funcionalidade</th>
                                <th class="package-col">
                                    ${packages.starter.name}<br>
                                    <small style="font-weight: 400; color: #0055cc;">${formatCurrency(basicPrice.finalPrice)}</small>
                                </th>
                                <th class="package-col" style="background: #fff4e6;">
                                    ${packages.growth.name}<br>
                                    <small style="font-weight: 400; color: #ff9500;">üí¨ Consulte</small>
                                </th>
                                <th class="package-col">
                                    ${packages.scale.name}<br>
                                    <small style="font-weight: 400; color: #8b5cf6;">üí¨ Consulte</small>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>

                    <div class="comparison-footer">
                        <button class="package-select-btn starter" onclick="selectPackage('basic', '${appTypeKey}'); closeComparison();">
                            Escolher ${packages.starter.name}
                        </button>
                        <button class="package-select-btn growth" onclick="selectPackage('pro', '${appTypeKey}'); closeComparison();">
                            Escolher ${packages.growth.name}
                        </button>
                        <button class="package-select-btn scale" onclick="selectPackage('enterprise', '${appTypeKey}'); closeComparison();">
                            Escolher ${packages.scale.name}
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Fechar ao clicar fora
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeComparison();
                }
            });
        }

        // Fechar modal de compara√ß√£o
        function closeComparison() {
            const modal = document.getElementById('comparisonModal');
            if (modal) {
                modal.remove();
            }
        }

        // Selecionar pacote pr√©-definido
        function selectPackage(packageType, appTypeKey) {
            const userName = conversationState.userName || 'voc√™';
            const features = featuresCatalog[appTypeKey];
            let selectedFeatures = [];
            let totalPoints = 0;

            if (packageType === 'basic') {
                selectedFeatures = [...features.essential];
                conversationState.userInfo.packageType = 'B√°sico';
            } else if (packageType === 'pro') {
                selectedFeatures = [...features.essential, ...features.intermediate];
                conversationState.userInfo.packageType = 'Profissional';
            } else if (packageType === 'enterprise') {
                selectedFeatures = [...features.essential, ...features.intermediate, ...features.advanced];
                conversationState.userInfo.packageType = 'Enterprise';
            }

            totalPoints = selectedFeatures.reduce((sum, f) => sum + f.points, 0);
            conversationState.userInfo.selectedFeatures = selectedFeatures;
            conversationState.userInfo.functionPoints = totalPoints;

            const pricing = calculatePrice(totalPoints);

            addUserMessage(`Pacote ${conversationState.userInfo.packageType}`);

            // Ir direto para coleta de WhatsApp
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    collectWhatsAppNumber();
                }, getHumanTypingTime('√ìtima escolha'));
            }, 500);

            saveConversation();
        }

        // [REMOVIDO] Calculadora de ROI - fun√ß√£o n√£o mais utilizada
        function showROICalculator_DEPRECATED(appTypeKey) {
            const userName = conversationState.userName || 'voc√™';
            const messagesContainer = document.getElementById('chatMessages');

            // Perguntas espec√≠ficas por tipo de app
            const roiQuestions = {
                delivery: {
                    q1: { label: 'Quantas entregas por dia voc√™ espera fazer inicialmente?', placeholder: '100', unit: 'entregas/dia' },
                    q2: { label: 'Qual a taxa m√©dia que voc√™ cobra por entrega?', placeholder: '5.00', unit: 'R$', prefix: 'R$ ' }
                },
                ecommerce: {
                    q1: { label: 'Quantas vendas por m√™s voc√™ espera fazer?', placeholder: '150', unit: 'vendas/m√™s' },
                    q2: { label: 'Qual o ticket m√©dio dos seus produtos?', placeholder: '120.00', unit: 'R$', prefix: 'R$ ' }
                },
                educacao: {
                    q1: { label: 'Quantos alunos voc√™ espera ter no primeiro m√™s?', placeholder: '50', unit: 'alunos' },
                    q2: { label: 'Qual o valor m√©dio dos seus cursos?', placeholder: '200.00', unit: 'R$', prefix: 'R$ ' }
                },
                saude: {
                    q1: { label: 'Quantas consultas por dia voc√™ atende?', placeholder: '10', unit: 'consultas/dia' },
                    q2: { label: 'Qual o valor m√©dio da consulta?', placeholder: '150.00', unit: 'R$', prefix: 'R$ ' }
                },
                gestao: {
                    q1: { label: 'Quantas horas por m√™s sua equipe gasta em tarefas manuais?', placeholder: '80', unit: 'horas/m√™s' },
                    q2: { label: 'Qual o custo m√©dio/hora da sua equipe?', placeholder: '50.00', unit: 'R$/hora', prefix: 'R$ ' }
                }
            };

            const questions = roiQuestions[appTypeKey] || roiQuestions.delivery;

            const roiDiv = document.createElement('div');
            roiDiv.innerHTML = `
                <div class="message-ai">
                    <div class="message-content" style="max-width: 90%;">
                        <div class="message-bubble">
                            Perfeito, ${userName}! üéØ Antes de finalizar, vou te mostrar uma proje√ß√£o de retorno.<br><br>
                            Me ajuda com 2 informa√ß√µes r√°pidas:
                        </div>

                        <div class="roi-calculator">
                            <h4>üí∞ Calculadora de ROI</h4>

                            <div class="roi-question">
                                <label for="roi_q1">${questions.q1.label}</label>
                                <input type="number" id="roi_q1" class="roi-input" placeholder="${questions.q1.placeholder}" min="0" step="1">
                            </div>

                            <div class="roi-question">
                                <label for="roi_q2">${questions.q2.label}</label>
                                <input type="number" id="roi_q2" class="roi-input" placeholder="${questions.q2.placeholder}" min="0" step="0.01">
                            </div>

                            <button class="cta-button" onclick="calculateROI('${appTypeKey}', '${questions.q1.unit}', '${questions.q2.prefix || ''}')">
                                üìä Calcular Proje√ß√£o
                            </button>

                            <div id="roi-results-container"></div>
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(roiDiv);
            scrollToBottom();

            // Auto-focus no primeiro input
            setTimeout(() => {
                document.getElementById('roi_q1').focus();
            }, 300);
        }

        // Calcular e mostrar ROI
        function calculateROI(appTypeKey, unit, prefix) {
            const q1Value = parseFloat(document.getElementById('roi_q1').value) || 0;
            const q2Value = parseFloat(document.getElementById('roi_q2').value) || 0;

            if (q1Value === 0 || q2Value === 0) {
                alert('Por favor, preencha ambos os campos para calcular a proje√ß√£o!');
                return;
            }

            // C√°lculos espec√≠ficos por tipo
            let faturamentoMensal = 0;
            let descricaoCalculo = '';

            if (appTypeKey === 'delivery') {
                faturamentoMensal = q1Value * q2Value * 30; // entregas/dia * taxa * 30 dias
                descricaoCalculo = `${q1Value} entregas/dia √ó R$ ${q2Value.toFixed(2)} √ó 30 dias`;
            } else if (appTypeKey === 'ecommerce') {
                faturamentoMensal = q1Value * q2Value; // vendas/m√™s * ticket m√©dio
                descricaoCalculo = `${q1Value} vendas/m√™s √ó R$ ${q2Value.toFixed(2)}`;
            } else if (appTypeKey === 'educacao') {
                faturamentoMensal = q1Value * q2Value; // alunos * valor curso
                descricaoCalculo = `${q1Value} alunos √ó R$ ${q2Value.toFixed(2)}`;
            } else if (appTypeKey === 'saude') {
                faturamentoMensal = q1Value * q2Value * 22; // consultas/dia * valor * 22 dias √∫teis
                descricaoCalculo = `${q1Value} consultas/dia √ó R$ ${q2Value.toFixed(2)} √ó 22 dias √∫teis`;
            } else if (appTypeKey === 'gestao') {
                faturamentoMensal = q1Value * q2Value; // economia de horas * custo/hora
                descricaoCalculo = `${q1Value} horas economizadas √ó R$ ${q2Value.toFixed(2)}/hora`;
            }

            const faturamentoAnual = faturamentoMensal * 12;
            const investimento = conversationState.userInfo.functionPoints * 350;
            const pricing = calculatePrice(conversationState.userInfo.functionPoints);
            const investimentoFinal = pricing.finalPrice;

            const mesesROI = investimentoFinal / faturamentoMensal;
            const lucroAno1 = faturamentoAnual - investimentoFinal;
            const roiPercentual = ((faturamentoAnual - investimentoFinal) / investimentoFinal) * 100;
            const multiplicador = faturamentoAnual / investimentoFinal;

            // Mostrar resultados
            const resultsContainer = document.getElementById('roi-results-container');
            resultsContainer.innerHTML = `
                <div class="roi-results">
                    <h5>üí∞ PROJE√á√ÉO FINANCEIRA</h5>

                    <div class="roi-metric">
                        <div class="roi-metric-label">
                            üìä Faturamento Mensal Estimado
                            <br><small style="color: #999;">${descricaoCalculo}</small>
                        </div>
                        <div class="roi-metric-value">${formatCurrency(faturamentoMensal)}</div>
                    </div>

                    <div class="roi-metric">
                        <div class="roi-metric-label">üìà Faturamento Anual</div>
                        <div class="roi-metric-value">${formatCurrency(faturamentoAnual)}</div>
                    </div>

                    <div class="roi-metric">
                        <div class="roi-metric-label">üíµ Investimento no App</div>
                        <div class="roi-metric-value">${formatCurrency(investimentoFinal)}</div>
                    </div>

                    <div class="roi-metric">
                        <div class="roi-metric-label">‚è±Ô∏è Retorno do Investimento</div>
                        <div class="roi-metric-value">${mesesROI.toFixed(1)} meses</div>
                    </div>

                    <div class="roi-metric">
                        <div class="roi-metric-label">üéØ Lucro no 1¬∫ Ano</div>
                        <div class="roi-metric-value highlight">${formatCurrency(lucroAno1)}</div>
                    </div>

                    <div class="roi-highlight-box">
                        <p>‚úÖ A cada R$ 1,00 investido, voc√™ ganha R$ ${multiplicador.toFixed(2)} de volta</p>
                        <p style="margin-top: 8px;">üöÄ ROI de ${roiPercentual.toFixed(0)}% no primeiro ano</p>
                    </div>

                    <div class="roi-cta">
                        <button class="cta-button" onclick="proceedToFinalQuote()">
                            Continuar para Proposta Final ‚Üí
                        </button>
                    </div>
                </div>
            `;

            scrollToBottom();

            // Salvar dados de ROI
            conversationState.userInfo.roiData = {
                faturamentoMensal,
                faturamentoAnual,
                mesesROI: mesesROI.toFixed(1),
                lucroAno1,
                roiPercentual: roiPercentual.toFixed(0)
            };
            saveConversation();
        }

        // Prosseguir para proposta final - AGORA COLETA WHATSAPP PRIMEIRO
        function proceedToFinalQuote() {
            collectWhatsAppNumber();
        }

        // Coletar n√∫mero de WhatsApp do usu√°rio
        function collectWhatsAppNumber() {
            const userName = conversationState.userName || 'voc√™';
            const messagesContainer = document.getElementById('chatMessages');

            const whatsappDiv = document.createElement('div');
            whatsappDiv.className = 'message-ai';
            whatsappDiv.id = 'whatsappCollector';
            whatsappDiv.innerHTML = `
                <div class="message-content" style="max-width: 90%;">
                    <div class="message-bubble">
                        Perfeito, ${userName}! üéâ<br><br>
                        Sua proposta est√° quase pronta! Para enviar o <strong>or√ßamento oficial personalizado</strong>, preciso do seu WhatsApp.<br><br>
                        Um de nossos consultores vai entrar em contato em at√© <strong>2 horas</strong> (hor√°rio comercial).
                    </div>

                    <div style="background: white; border: 2px solid var(--color-border); border-radius: 16px; padding: 24px; margin-top: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                            <div style="width: 48px; height: 48px; background: #25D366; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                                </svg>
                            </div>
                            <div>
                                <h4 style="font-size: 18px; font-weight: 700; color: var(--color-text-dark); margin: 0;">Seu WhatsApp</h4>
                                <p style="font-size: 13px; color: var(--color-text-gray); margin: 4px 0 0 0;">Para receber a proposta oficial</p>
                            </div>
                        </div>

                        <div style="position: relative; margin-bottom: 16px;">
                            <input
                                type="tel"
                                id="whatsappInput"
                                class="roi-input"
                                placeholder="(11) 99999-9999"
                                style="width: 100%; padding: 16px 16px 16px 50px; font-size: 18px; border: 2px solid var(--color-border); border-radius: 12px;"
                                maxlength="15"
                                onkeypress="handleWhatsAppKeyPress(event)"
                            >
                            <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 16px; color: var(--color-text-gray);">üáßüá∑</span>
                        </div>

                        <button class="cta-button" onclick="submitWhatsApp()" style="width: 100%; padding: 16px; font-size: 16px;">
                            üì≤ Receber Proposta no WhatsApp
                        </button>

                        <p style="font-size: 12px; color: var(--color-text-gray); text-align: center; margin-top: 12px;">
                            üîí Seus dados est√£o seguros e n√£o ser√£o compartilhados
                        </p>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(whatsappDiv);
            scrollToBottom();

            // Aplicar m√°scara de telefone
            setTimeout(() => {
                const input = document.getElementById('whatsappInput');
                if (input) {
                    input.focus();
                    applyPhoneMask(input);
                }
            }, 300);
        }

        // Aplicar m√°scara de telefone brasileiro
        function applyPhoneMask(input) {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.slice(0, 11);

                if (value.length > 0) {
                    value = '(' + value;
                }
                if (value.length > 3) {
                    value = value.slice(0, 3) + ') ' + value.slice(3);
                }
                if (value.length > 10) {
                    value = value.slice(0, 10) + '-' + value.slice(10);
                }

                e.target.value = value;
            });
        }

        // Handler para Enter no campo de WhatsApp
        function handleWhatsAppKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitWhatsApp();
            }
        }

        // Validar e submeter WhatsApp
        function submitWhatsApp() {
            const input = document.getElementById('whatsappInput');
            const rawNumber = input.value.replace(/\D/g, '');

            if (rawNumber.length < 10 || rawNumber.length > 11) {
                input.style.borderColor = '#ef4444';
                input.placeholder = 'Digite um n√∫mero v√°lido';
                input.focus();
                return;
            }

            // Salvar no estado
            conversationState.userInfo.whatsapp = input.value;
            conversationState.userInfo.whatsappRaw = rawNumber;
            saveConversation();

            // Adicionar mensagem do usu√°rio
            addUserMessage(`üì± ${input.value}`);

            // Remover o formul√°rio de WhatsApp
            const collector = document.getElementById('whatsappCollector');
            if (collector) collector.remove();

            // Mostrar confirma√ß√£o e proposta resumida
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    showFinalConfirmation();
                }, 1500);
            }, 500);
        }

        // Mostrar confirma√ß√£o final (sem pre√ßo detalhado - consultor envia)
        function showFinalConfirmation() {
            const userName = conversationState.userName || 'voc√™';
            const messagesContainer = document.getElementById('chatMessages');
            const whatsapp = conversationState.userInfo.whatsapp;

            const confirmDiv = document.createElement('div');
            confirmDiv.innerHTML = `
                <div class="message-ai">
                    <div class="message-content">
                        <div class="message-bubble">
                            Prontinho, ${userName}! üéâ<br><br>
                            Recebi seu WhatsApp <strong>${whatsapp}</strong>.<br><br>
                            Um de nossos consultores vai analisar seu projeto e enviar a <strong>proposta oficial personalizada</strong> em at√© 2 horas (hor√°rio comercial).
                        </div>
                    </div>
                </div>

                <div class="summary-box" style="margin-top: 20px; background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%);">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 80px; height: 80px; background: #25D366; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                            <svg width="44" height="44" viewBox="0 0 24 24" fill="white">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                        </div>
                        <h3 style="font-size: 24px; margin-bottom: 8px;">Solicita√ß√£o Enviada!</h3>
                        <p style="color: var(--color-text-gray);">Consultor entrar√° em contato pelo WhatsApp</p>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 700; color: var(--color-primary); margin-bottom: 16px;">üìã Resumo do seu projeto:</h4>

                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span style="color: var(--color-text-gray);">Tipo de App:</span>
                            <span style="font-weight: 600;">${conversationState.userInfo.appType || 'A definir'}</span>
                        </div>

                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span style="color: var(--color-text-gray);">Pacote:</span>
                            <span style="font-weight: 600;">${conversationState.userInfo.packageType || 'A definir'}</span>
                        </div>

                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <span style="color: var(--color-text-gray);">Funcionalidades:</span>
                            <span style="font-weight: 600;">${conversationState.userInfo.selectedFeatures?.length || 0} selecionadas</span>
                        </div>

                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span style="color: var(--color-text-gray);">WhatsApp:</span>
                            <span style="font-weight: 600;">${whatsapp}</span>
                        </div>
                    </div>

                    <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 20px;">
                        <p style="font-size: 13px; color: #856404; margin: 0;">
                            ‚è∞ <strong>Pr√≥ximo passo:</strong> Aguarde o contato do consultor para receber a proposta oficial com valores e condi√ß√µes de pagamento.
                        </p>
                    </div>

                    <div style="display: flex; gap: 12px;">
                        <button class="cta-button cta-secondary" onclick="shareOnWhatsApp()" style="flex: 1;">
                            üì§ Compartilhar resumo
                        </button>
                        <button class="cta-button" onclick="window.location.href='index.html'" style="flex: 1;">
                            üè† Voltar ao in√≠cio
                        </button>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(confirmDiv);
            scrollToBottom();

            // Enviar lead para o backend/webhook (se configurado)
            sendLeadToBackend();
        }

        // Enviar lead para backend (webhook, email, CRM, etc.)
        function sendLeadToBackend() {
            const leadData = {
                timestamp: new Date().toISOString(),
                name: conversationState.userName,
                whatsapp: conversationState.userInfo.whatsapp,
                whatsappRaw: conversationState.userInfo.whatsappRaw,
                appType: conversationState.userInfo.appType,
                packageType: conversationState.userInfo.packageType,
                features: conversationState.userInfo.selectedFeatures?.map(f => f.name) || [],
                functionPoints: conversationState.userInfo.functionPoints,
                timeline: conversationState.userInfo.timeline,
                budget: conversationState.userInfo.budget,
                roiData: conversationState.userInfo.roiData || null,
                source: 'chat-ia',
                url: window.location.href
            };

            // Log para debug (remover em produ√ß√£o)
            console.log('üì§ Lead capturado:', leadData);

            // TODO: Substituir pelo endpoint real do seu backend/webhook
            // Exemplo com webhook:
            /*
            fetch('https://seu-webhook.com/leads', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(leadData)
            }).catch(err => console.error('Erro ao enviar lead:', err));
            */

            // Salvar tamb√©m no localStorage como backup
            const leads = JSON.parse(localStorage.getItem('evo_leads') || '[]');
            leads.push(leadData);
            localStorage.setItem('evo_leads', JSON.stringify(leads));
        }

        // Compartilhar resumo no WhatsApp
        function shareOnWhatsApp() {
            const summary = `
üöÄ *Meu Projeto de App - Evo*

üì± Tipo: ${conversationState.userInfo.appType || 'A definir'}
üì¶ Pacote: ${conversationState.userInfo.packageType || 'A definir'}
‚öôÔ∏è Funcionalidades: ${conversationState.userInfo.selectedFeatures?.length || 0}

Aguardando proposta oficial!
            `.trim();

            const encoded = encodeURIComponent(summary);
            window.open(`https://wa.me/?text=${encoded}`, '_blank');
        }

        // Personalizar pacote
        function customizePackage(appTypeKey) {
            const userName = conversationState.userName || 'voc√™';
            addUserMessage('‚ú® Quero personalizar meu pacote');

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    showFeatureSelector(appTypeKey);
                }, getHumanTypingTime('Vamos montar seu pacote personalizado'));
            }, 500);
        }

        // Mostrar seletor de features
        function showFeatureSelector(appTypeKey) {
            const userName = conversationState.userName || 'voc√™';
            const features = featuresCatalog[appTypeKey];
            const messagesContainer = document.getElementById('chatMessages');

            conversationState.userInfo.packageType = 'Personalizado';

            const selectorDiv = document.createElement('div');
            selectorDiv.id = 'featureSelector';

            selectorDiv.innerHTML = `
                <div class="message-ai">
                    <div class="message-content" style="max-width: 100%;">
                        <div class="message-bubble">
                            Show, ${userName}! üé® Selecione as funcionalidades que voc√™ precisa.<br><br>
                            O pre√ßo ser√° calculado automaticamente baseado nos pontos de fun√ß√£o:
                        </div>

                        <div id="featureCategories" style="margin-top: 16px;">
                            <!-- Essenciais -->
                            <div style="background: var(--color-white); border: 2px solid var(--color-border); border-radius: var(--radius-lg); padding: 16px; margin-bottom: 16px;">
                                <h4 style="font-size: 14px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px;">üì¶ Funcionalidades Essenciais</h4>
                                ${features.essential.map(feature => `
                                    <label style="display: flex; align-items: flex-start; padding: 8px; cursor: pointer; border-radius: 8px; transition: background 0.2s;" class="feature-item">
                                        <input type="checkbox" value="${feature.id}" data-points="${feature.points}" data-name="${feature.name}" onchange="updateCustomPrice('${appTypeKey}')" style="margin-right: 12px; margin-top: 4px;">
                                        <div style="flex: 1;">
                                            <div style="font-size: 14px; font-weight: 600; color: var(--color-text-dark);">${feature.name}</div>
                                            <div style="font-size: 12px; color: var(--color-text-gray); margin-top: 2px;">${feature.description} ‚Ä¢ ${feature.points} PF</div>
                                        </div>
                                    </label>
                                `).join('')}
                            </div>

                            <!-- Intermedi√°rias -->
                            <div style="background: var(--color-white); border: 2px solid var(--color-border); border-radius: var(--radius-lg); padding: 16px; margin-bottom: 16px;">
                                <h4 style="font-size: 14px; font-weight: 700; color: #ff9500; margin-bottom: 12px;">üöÄ Funcionalidades Profissionais</h4>
                                ${features.intermediate.map(feature => `
                                    <label style="display: flex; align-items: flex-start; padding: 8px; cursor: pointer; border-radius: 8px; transition: background 0.2s;" class="feature-item">
                                        <input type="checkbox" value="${feature.id}" data-points="${feature.points}" data-name="${feature.name}" onchange="updateCustomPrice('${appTypeKey}')" style="margin-right: 12px; margin-top: 4px;">
                                        <div style="flex: 1;">
                                            <div style="font-size: 14px; font-weight: 600; color: var(--color-text-dark);">
                                                ${feature.name}
                                                <span class="add-later-badge">üí° Pode adicionar depois</span>
                                            </div>
                                            <div style="font-size: 12px; color: var(--color-text-gray); margin-top: 2px;">${feature.description} ‚Ä¢ ${feature.points} PF</div>
                                        </div>
                                    </label>
                                `).join('')}
                            </div>

                            <!-- Avan√ßadas -->
                            <div style="background: var(--color-white); border: 2px solid var(--color-border); border-radius: var(--radius-lg); padding: 16px; margin-bottom: 16px;">
                                <h4 style="font-size: 14px; font-weight: 700; color: #8b5cf6; margin-bottom: 12px;">‚≠ê Funcionalidades Avan√ßadas</h4>
                                ${features.advanced.map(feature => `
                                    <label style="display: flex; align-items: flex-start; padding: 8px; cursor: pointer; border-radius: 8px; transition: background 0.2s;" class="feature-item">
                                        <input type="checkbox" value="${feature.id}" data-points="${feature.points}" data-name="${feature.name}" onchange="updateCustomPrice('${appTypeKey}')" style="margin-right: 12px; margin-top: 4px;">
                                        <div style="flex: 1;">
                                            <div style="font-size: 14px; font-weight: 600; color: var(--color-text-dark);">
                                                ${feature.name}
                                                <span class="add-later-badge">üí° Pode adicionar depois</span>
                                            </div>
                                            <div style="font-size: 12px; color: var(--color-text-gray); margin-top: 2px;">${feature.description} ‚Ä¢ ${feature.points} PF</div>
                                        </div>
                                    </label>
                                `).join('')}
                            </div>

                            <!-- Se√ß√£o de Flexibilidade -->
                            <div class="flexibility-section">
                                <h4>üîÑ Total Flexibilidade</h4>
                                <p>N√£o tem certeza de todas as funcionalidades? Sem problema!</p>

                                <div class="flexibility-cards">
                                    <div class="flexibility-card">
                                        <div class="flexibility-icon">üéØ</div>
                                        <h5>Comece Simples</h5>
                                        <p>Escolha apenas o essencial agora e valide com usu√°rios reais</p>
                                    </div>

                                    <div class="flexibility-card">
                                        <div class="flexibility-icon">üìà</div>
                                        <h5>Evolua Conforme Cresce</h5>
                                        <p>Adicione funcionalidades quando seu neg√≥cio pedir</p>
                                    </div>

                                    <div class="flexibility-card">
                                        <div class="flexibility-icon">üí∞</div>
                                        <h5>Pre√ßo Justo</h5>
                                        <p>Qualquer feature extra por apenas R$ 350/ponto de fun√ß√£o</p>
                                    </div>
                                </div>

                                <div class="flexibility-cta">
                                    <button class="cta-button cta-secondary" onclick="selectMinimalPackage('${appTypeKey}')">
                                        üöÄ Come√ßar com o M√≠nimo Essencial
                                    </button>
                                </div>

                                <div class="add-later-pricing">
                                    <h5>üí° Pre√ßos para adicionar funcionalidades depois:</h5>

                                    <table class="pricing-table">
                                        <tr>
                                            <th>Funcionalidade</th>
                                            <th>Pontos</th>
                                            <th>Investimento</th>
                                            <th>Prazo</th>
                                        </tr>
                                        <tr>
                                            <td>Chat em tempo real</td>
                                            <td>13 PF</td>
                                            <td>R$ 4.550</td>
                                            <td>3-5 dias</td>
                                        </tr>
                                        <tr>
                                            <td>Programa de fidelidade</td>
                                            <td>13 PF</td>
                                            <td>R$ 4.550</td>
                                            <td>5-7 dias</td>
                                        </tr>
                                        <tr>
                                            <td>IA para recomenda√ß√µes</td>
                                            <td>21 PF</td>
                                            <td>R$ 7.350</td>
                                            <td>7-10 dias</td>
                                        </tr>
                                    </table>

                                    <p class="pricing-note">
                                        ‚ö° Features adicionais t√™m desenvolvimento e entrega ultra-r√°pidos
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Resumo em tempo real -->
                        <div id="customPriceBox" style="background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%); border: 2px solid var(--color-primary); border-radius: var(--radius-lg); padding: 20px; margin-top: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 13px; color: var(--color-text-gray); margin-bottom: 4px;">Pontos de Fun√ß√£o Totais</div>
                                    <div id="totalPoints" style="font-size: 24px; font-weight: 700; color: var(--color-primary);">0 PF</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 13px; color: var(--color-text-gray); margin-bottom: 4px;">Investimento</div>
                                    <div id="totalPrice" style="font-size: 24px; font-weight: 700; color: var(--color-text-dark);">R$ 0</div>
                                </div>
                            </div>
                            <button class="cta-button" style="margin-top: 16px;" onclick="confirmCustomPackage('${appTypeKey}')" id="confirmBtn" disabled>
                                Confirmar Sele√ß√£o
                            </button>
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(selectorDiv);
            scrollToBottom();
        }

        // Atualizar pre√ßo em tempo real
        function updateCustomPrice(appTypeKey) {
            const checkboxes = document.querySelectorAll('#featureCategories input[type="checkbox"]:checked');
            let totalPoints = 0;
            let selectedFeatures = [];

            checkboxes.forEach(cb => {
                const points = parseInt(cb.getAttribute('data-points'));
                const name = cb.getAttribute('data-name');
                const id = cb.value;
                totalPoints += points;
                selectedFeatures.push({ id, name, points });
            });

            const pricing = calculatePrice(totalPoints);

            document.getElementById('totalPoints').textContent = `${totalPoints} PF`;
            document.getElementById('totalPrice').textContent = formatCurrency(pricing.finalPrice);

            conversationState.userInfo.selectedFeatures = selectedFeatures;
            conversationState.userInfo.functionPoints = totalPoints;

            const confirmBtn = document.getElementById('confirmBtn');
            confirmBtn.disabled = totalPoints === 0;
            confirmBtn.style.opacity = totalPoints === 0 ? '0.5' : '1';
            confirmBtn.style.cursor = totalPoints === 0 ? 'not-allowed' : 'pointer';

            saveConversation();
        }

        // Confirmar pacote personalizado
        function confirmCustomPackage(appTypeKey) {
            const totalPoints = conversationState.userInfo.functionPoints;
            if (totalPoints === 0) return;

            addUserMessage(`Confirmar pacote personalizado (${totalPoints} pontos de fun√ß√£o)`);

            // Remover o seletor
            document.getElementById('featureSelector').remove();

            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    showFinalQuote();
                }, getHumanTypingTime('Perfeito! Deixa eu montar sua proposta'));
            }, 500);
        }

        // Mostrar cota√ß√£o final
        function showFinalQuote() {
            const userName = conversationState.userName || 'voc√™';
            const totalPoints = conversationState.userInfo.functionPoints;
            const pricing = calculatePrice(totalPoints);
            const messagesContainer = document.getElementById('chatMessages');

            let featuresListHTML = conversationState.userInfo.selectedFeatures
                .map(f => `<li style="padding: 6px 0;">‚úì ${f.name} (${f.points} PF)</li>`)
                .join('');

            const quoteDiv = document.createElement('div');
            quoteDiv.innerHTML = `
                <div class="summary-box" style="margin-top: 20px;">
                    <h3>Proposta Personalizada - ${conversationState.userInfo.appType}</h3>

                    <div style="background: var(--color-white); padding: 16px; border-radius: 12px; margin: 16px 0;">
                        <h4 style="font-size: 14px; font-weight: 700; margin-bottom: 12px;">üìã Funcionalidades Inclu√≠das (${conversationState.userInfo.selectedFeatures.length})</h4>
                        <ul class="summary-list" style="max-height: 200px; overflow-y: auto;">
                            ${featuresListHTML}
                        </ul>
                    </div>

                    <div style="background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%); padding: 20px; border-radius: 12px; margin: 16px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--color-text-medium);">Pontos de Fun√ß√£o:</span>
                            <span style="font-weight: 700; color: var(--color-primary);">${totalPoints} PF</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--color-text-medium);">Valor por PF:</span>
                            <span style="font-weight: 600;">${formatCurrency(pricing.pricePerPoint)}</span>
                        </div>
                        ${pricing.discount > 0 ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--color-text-medium);">Desconto:</span>
                            <span style="font-weight: 600; color: #10b981;">${(pricing.discount * 100).toFixed(0)}% (${formatCurrency(pricing.basePrice - pricing.finalPrice)})</span>
                        </div>
                        ` : ''}
                        <div style="border-top: 2px solid var(--color-border); padding-top: 12px; margin-top: 12px; display: flex; justify-content: space-between;">
                            <span style="font-size: 18px; font-weight: 700; color: var(--color-text-dark);">Total:</span>
                            <span style="font-size: 24px; font-weight: 700; color: var(--color-primary);">${formatCurrency(pricing.finalPrice)}</span>
                        </div>
                    </div>

                    <p style="font-size: 13px; color: var(--color-text-gray); margin-bottom: 16px; text-align: center;">
                        ‚úÖ Inclui: 5 anos de suporte ‚Ä¢ Conformidade LGPD ‚Ä¢ Registro de marca
                    </p>

                    <button class="cta-button" onclick="window.location.href='index.html#contato'">
                        Solicitar Proposta Oficial ‚Üí
                    </button>
                    <button class="cta-button cta-secondary" onclick="modifyPackage()">
                        ‚úèÔ∏è Modificar Funcionalidades
                    </button>
                </div>
            `;

            messagesContainer.appendChild(quoteDiv);
            scrollToBottom();

            // Mostrar pr√≥ximos passos logo ap√≥s a proposta
            setTimeout(() => {
                showNextSteps();
            }, 800);
        }

        // Mostrar pr√≥ximos passos transparentes
        function showNextSteps() {
            const messagesContainer = document.getElementById('chatMessages');

            const nextStepsDiv = document.createElement('div');
            nextStepsDiv.className = 'message-ai';
            nextStepsDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="next-steps-section">
                            <h3>‚úÖ O que acontece agora:</h3>

                            <div class="timeline">
                                <!-- Passo 1 - ATIVO -->
                                <div class="timeline-item active">
                                    <div class="timeline-marker">1</div>
                                    <div class="timeline-content">
                                        <h4>üìû Reuni√£o de Alinhamento</h4>
                                        <span class="timeline-time">Pr√≥ximas 24 horas</span>
                                        <p>Reuni√£o de 30 minutos para detalhar funcionalidades espec√≠ficas do seu neg√≥cio</p>
                                        <div class="timeline-cta">
                                            <button class="cta-button-small" onclick="scheduleCall()">
                                                üóìÔ∏è Agendar Agora
                                            </button>
                                            <span class="availability">Hor√°rios dispon√≠veis hoje</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Passo 2 -->
                                <div class="timeline-item">
                                    <div class="timeline-marker">2</div>
                                    <div class="timeline-content">
                                        <h4>üìÑ Proposta Oficial</h4>
                                        <span class="timeline-time">Em at√© 24 horas</span>
                                        <p>Recebe proposta detalhada com:</p>
                                        <ul>
                                            <li>‚úì Cronograma completo</li>
                                            <li>‚úì Wireframes das telas principais</li>
                                            <li>‚úì Escopo t√©cnico detalhado</li>
                                            <li>‚úì Contrato e termos</li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Passo 3 -->
                                <div class="timeline-item">
                                    <div class="timeline-marker">3</div>
                                    <div class="timeline-content">
                                        <h4>üöÄ Kick-off do Projeto</h4>
                                        <span class="timeline-time">2-3 dias ap√≥s aprova√ß√£o</span>
                                        <p>Come√ßamos o desenvolvimento:</p>
                                        <ul>
                                            <li>‚úì Defini√ß√£o de identidade visual</li>
                                            <li>‚úì Acesso ao painel de acompanhamento</li>
                                            <li>‚úì Updates semanais de progresso</li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Passo 4 -->
                                <div class="timeline-item">
                                    <div class="timeline-marker">4</div>
                                    <div class="timeline-content">
                                        <h4>üéâ App Pronto!</h4>
                                        <span class="timeline-time">Em 25-30 dias</span>
                                        <p>Seu app 100% funcional:</p>
                                        <ul>
                                            <li>‚úì Publicado na App Store e Google Play</li>
                                            <li>‚úì Treinamento da equipe</li>
                                            <li>‚úì 5 anos de suporte inclusos</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="guarantee-badge">
                                üõ°Ô∏è <strong>Garantia de 30 dias</strong> - Se n√£o ficar satisfeito, devolvemos 100% do valor
                            </div>
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.appendChild(nextStepsDiv);
            scrollToBottom();
        }

        // Agendar reuni√£o
        function scheduleCall() {
            window.open('https://calendly.com/evospa', '_blank');
        }

        // Selecionar pacote m√≠nimo essencial
        function selectMinimalPackage(appTypeKey) {
            const features = featuresCatalog[appTypeKey];

            // Desmarcar todos os checkboxes primeiro
            const allCheckboxes = document.querySelectorAll('#featureSelector input[type="checkbox"]');
            allCheckboxes.forEach(cb => cb.checked = false);

            // Marcar apenas as funcionalidades essenciais
            features.essential.forEach(feature => {
                const checkbox = document.querySelector(`#featureSelector input[value="${feature.id}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });

            // Atualizar o pre√ßo
            updateCustomPrice(appTypeKey);

            // Confirmar automaticamente ap√≥s 500ms
            setTimeout(() => {
                confirmCustomPackage(appTypeKey);
            }, 500);
        }

        // Modificar pacote
        function modifyPackage() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.lastChild.remove();

            const appTypeKey = conversationState.userInfo.appType.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/\s+/g, '')
                .replace('&', '')
                .replace('bem-estar', 'saude')
                .replace('ecommerce', 'ecommerce')
                .replace('educacao', 'educacao')
                .replace('gestaoempresarial', 'gestao');

            showFeatureSelector(appTypeKey);
        }

        // Mostrar resumo da conversa
        function showSummary() {
            const messagesContainer = document.getElementById('chatMessages');
            const summaryDiv = document.createElement('div');

            let summaryItems = '';
            if (conversationState.userInfo.appType) {
                summaryItems += `<li>Tipo de app: ${conversationState.userInfo.appType}</li>`;
            }
            if (conversationState.userInfo.timeline) {
                summaryItems += `<li>Prazo desejado: ${conversationState.userInfo.timeline}</li>`;
            }
            if (conversationState.userInfo.budget) {
                summaryItems += `<li>Investimento: ${conversationState.userInfo.budget}</li>`;
            }
            if (conversationState.userInfo.features.length > 0) {
                summaryItems += `<li>${conversationState.userInfo.features.join(', ')}</li>`;
            }

            summaryDiv.innerHTML = `
                <div class="summary-box">
                    <h3>Entendi suas necessidades!</h3>
                    <ul class="summary-list">
                        ${summaryItems}
                    </ul>
                    <button class="cta-button" onclick="window.location.href='index.html#contato'">
                        Solicitar Or√ßamento Personalizado ‚Üí
                    </button>
                    <button class="cta-button cta-secondary" onclick="continueChat()">
                        Adicionar mais detalhes
                    </button>
                </div>
            `;

            messagesContainer.appendChild(summaryDiv);
            scrollToBottom();
        }

        // Continuar conversando
        function continueChat() {
            const input = document.getElementById('chatInput');
            input.focus();
            input.placeholder = 'Conte mais detalhes sobre seu projeto...';
        }

        // Indicador de digita√ß√£o
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Scroll para o final
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>
