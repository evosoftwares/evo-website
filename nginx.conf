# nginx.conf - Configuração para Nginx
# Cole estas configurações no seu bloco server {}

# ========================================
# COMPRESSÃO GZIP
# ========================================

gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/x-javascript
    application/xml
    application/xml+rss
    application/xhtml+xml
    application/x-font-ttf
    application/x-font-opentype
    application/vnd.ms-fontobject
    image/svg+xml
    image/x-icon
    font/woff
    font/woff2
    font/ttf
    font/otf;

# ========================================
# BROTLI (se disponível)
# ========================================

# brotli on;
# brotli_comp_level 6;
# brotli_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss image/svg+xml;

# ========================================
# CACHE HEADERS
# ========================================

# HTML - revalidar frequentemente
location ~* \.html?$ {
    expires 1h;
    add_header Cache-Control "public, max-age=3600, must-revalidate";
}

# CSS e JavaScript - cache longo
location ~* \.(css|js)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Imagens - cache longo
location ~* \.(jpg|jpeg|png|gif|svg|webp|avif|ico)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Fontes - cache longo
location ~* \.(ttf|otf|woff|woff2|eot)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Access-Control-Allow-Origin "*";
}

# ========================================
# SEGURANÇA HEADERS
# ========================================

add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Content Security Policy
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://unpkg.com https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com https://cdn-uicons.flaticon.com; img-src 'self' data: https: http:; font-src 'self' https://fonts.gstatic.com https://cdn-uicons.flaticon.com; connect-src 'self';" always;

# Permissions Policy
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

# ========================================
# REDIRECTS
# ========================================

# Forçar HTTPS (descomente quando tiver SSL)
# if ($scheme != "https") {
#     return 301 https://$server_name$request_uri;
# }

# Forçar www (ou remover www)
# if ($host !~* ^www\.) {
#     return 301 https://www.$host$request_uri;
# }

# Remover trailing slash
rewrite ^/(.*)/$ /$1 permanent;

# ========================================
# OTIMIZAÇÕES
# ========================================

# Desabilitar ETags
etag off;

# Aumentar tamanho do buffer
client_body_buffer_size 128k;
client_max_body_size 10m;

# Timeouts otimizados
client_body_timeout 12;
client_header_timeout 12;
keepalive_timeout 65;
send_timeout 10;

# ========================================
# BLOQUEAR ARQUIVOS SENSÍVEIS
# ========================================

location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

location ~ \.(env|log|htaccess|htpasswd|ini|sh|sql)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# ========================================
# MIME TYPES MODERNOS
# ========================================

types {
    image/webp webp;
    image/avif avif;
    font/woff2 woff2;
    application/manifest+json webmanifest;
}

# ========================================
# PÁGINA 404 CUSTOMIZADA
# ========================================

error_page 404 /index.html;
location = /index.html {
    internal;
}
